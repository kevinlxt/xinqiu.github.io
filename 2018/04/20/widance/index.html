<!DOCTYPE html>
<html lang="en">
    <head>
    <!-- 
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.0 -->

    <!-- Title -->
    
    <title>
        
            WiDance论文学习 | 
        
        一人Code
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Meta & Info -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Xin Qiu">
    <meta name="description" content="写给自己的Blog">
    <meta name="keywords" content="一人Code|写给自己的Blog,csi">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="一人Code">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://xinqiu.me">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="WiDance论文学习 | 一人Code">
    <meta property="og:description" content="写给自己的Blog">
    <meta property="og:article:tag" content="csi"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }
</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>



    <script src="/js/jquery.min.js"></script>
    <script src="/js/queue.js"></script>

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    
    <!-- Google Analytics -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-57881840-1', 'auto');ga('send', 'pageview');
    </script>
    

    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
        
            <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-57881840-1', 'auto'); ga('send', 'pageview'); </script>
        
    
<link rel="stylesheet" href="/css/prism-coy.css" type="text/css"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u7B80_u4ECB"><span class="post-toc-number">1.</span> <span class="post-toc-text">简介</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u6570_u636E_u63D0_u53D6"><span class="post-toc-number">2.</span> <span class="post-toc-text">数据提取</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u8BBE_u7F6E_u6EE4_u6CE2_u5668"><span class="post-toc-number">3.</span> <span class="post-toc-text">设置滤波器</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u5929_u7EBF_u9009_u62E9"><span class="post-toc-number">4.</span> <span class="post-toc-text">天线选择</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u6EE4_u6CE2_u4EE5_u53CA_u65F6_u9891_u5206_u6790"><span class="post-toc-number">5.</span> <span class="post-toc-text">滤波以及时频分析</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u52A8_u4F5C_u68C0_u6D4B"><span class="post-toc-number">6.</span> <span class="post-toc-text">动作检测</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u52A8_u4F5C_u5206_u7247"><span class="post-toc-number">7.</span> <span class="post-toc-text">动作分片</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u52A8_u4F5C_u8BC6_u522B"><span class="post-toc-number">8.</span> <span class="post-toc-text">动作识别</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u603B_u7ED3"><span class="post-toc-number">9.</span> <span class="post-toc-text">总结</span></a></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').css('background-image', 'url(' + '/img/random/material-' + randomNum + '.png' + ')');
</script>

        
    
            <p class="article-headline-p">
                WiDance论文学习
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Xin Qiu</strong>
        <span>Apr 20, 2018</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
            <i class="material-icons" role="presentation">devices other</i>
            <span class="visuallyhidden">devices other</span>
        </button>
        <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
            <li class="mdl-menu__item">Read this article on other device</li>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACZklEQVR42u3aUW6sQAwEQO5/6eQAEWzbhhmyKr5WeoQ3xQe22j5+vvo68PDw8PDw8PDwXsY74uv0cZd35k/7+6+9s+Hh4eGt4X341Ab3JAdKSPOz4eHh4a3knR3o7J7koHnZuD56cjY8PDy8N/OS3zlp8kw8PDy8/8iblJMPzTEeHh7e63nJf9wrAMnRr38vylrw8PDwYl4+ZFr/e+l8Dw8PDy/glVeagg930kBXR2vNpSs8PDy8B3j5h3iyNJAXmMkiAh4eHt4aXhIcTO6/jiGSF50Pz/Dw8PDW8HpDppwxiYCreDw8PLxdvB6gN8Sqlo0bCgMeHh7emNeLA6qM/HNfLVd4eHh4e3nVBdM8CO6VhGqRwMPDw9vFS2KFXrCbvMT8ZUVhBB4eHt5jvOpRkgP1VhN6xQAPDw9vJS8pBlVAL9Sohg6FlBoPDw/vVl4++M/XApLAYrJ8cMMADA8PD+8xXu9zP8Hn5ylnLXh4eHi37nNWR1bV2Lc6TktafDw8PLy9vLzZrbbOvfXT/FXi4eHh7eLlTW0e4PYa5bw83JBS4+Hh4Q141Vb4KF7VwpC84mZLjYeHh3crbx4o9ErFfJELDw8PbxevOaovlo3eX+XLDXh4eHhP86rXJOqtFoA8tsDDw8NbyZsECr0guFqWyi8CDw8PbwkvLwbXQ/1eYNFb+SpvRuDh4eE9wOuFqnnzPQ8yosYdDw8P75W8aoucr1tNnoOHh4f3fl6vJBRGWXExwMPDw9vFmzTHPUx1pTUKO/Dw8PCW8HoRQHU8Vo1rqwM2PDw8vDW877vw8PDw8PDw8PBecP0CEvErJrt7vRAAAAAASUVORK5CYII=">
        </ul>
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/csi/">csi</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    <!-- Leancloud Views -->
        <a class="post_share-link" href="#">
            <li class="mdl-menu__item">
                <span id="/2018/04/20/widance/" class="leancloud-views_num" data-flag-title="WiDance论文学习">
     &nbsp;Views
</span>

            </li>
        </a>
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=WiDance论文学习&url=http://xinqiu.me//2018/04/20/widance/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                Share to Weibo
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=WiDance论文学习&url=http://xinqiu.me//2018/04/20/widance/index.html&via=Xin Qiu" target="_blank">
            <li class="mdl-menu__item">
                Share to Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://xinqiu.me//2018/04/20/widance/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://xinqiu.me//2018/04/20/widance/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <blockquote>
<p>毕设自己挖坑选择了以前科研的方向，所以继续开始看CSI。这次也是去复现清华的钱堃大佬论文，不同于之前的PADS，WiDance这篇论文要难上好几个数量级。</p>
</blockquote>
<h2 id="u7B80_u4ECB"><a href="#u7B80_u4ECB" class="headerlink" title="简介"></a>简介</h2><p>这里我也就不细细介绍分析论文每一段都写了什么，我主要是想以我的理解，以及部分源码的思路来重新看这一篇论文。论文里的 Figure 4 算是前期操作的一个主要过程了，这部分都是为了选取出合适的数据并提取出多普勒频移。Figure 6 则是利用多普勒频移进行建模，从而做到动作识别。整个论文的实现可以分为上述说到的这两大部分。本文的数据格式以及环境设置和论文里相同。</p>
<h2 id="u6570_u636E_u63D0_u53D6"><a href="#u6570_u636E_u63D0_u53D6" class="headerlink" title="数据提取"></a>数据提取</h2><p>按照论文里的设置，采样率是1024Hz，使用 <code>csi_get_all</code> 函数从原始的CSI中提取出振幅和时间戳进行后期工作。以前认为CSI就是用 <code>read_bf_file</code> 读取到的CSI矩阵，但实际上需要用 <code>get_scaled_csi</code> 处理一下。PADS中相位变换就需要这一步操作，没有这一步操作，会有一定的区别。</p>
<pre class=" language-matlab"><code class="language-matlab"><span class="token keyword">function</span> <span class="token punctuation">[</span>cfr_array<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> rssi_array<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">csi_get_all</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
csi_trace <span class="token operator">=</span> <span class="token function">read_bf_file</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
timestamp <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>csi_trace<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cfr_array <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>csi_trace<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rssi_array <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>csi_trace<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> k <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>csi_trace<span class="token punctuation">)</span>
    csi_entry <span class="token operator">=</span> csi_trace<span class="token punctuation">{</span>k<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">% for the k_{th} packet</span>

    csi_all <span class="token operator">=</span> <span class="token function">squeeze</span><span class="token punctuation">(</span><span class="token function">get_scaled_csi</span><span class="token punctuation">(</span>csi_entry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">% estimate channel matrix Hexp-figu</span>
    csi <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">csi_all</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">csi_all</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">csi_all</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">.'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">% select CSI for one antenna pair</span>

    <span class="token function">timestamp</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> csi_entry<span class="token punctuation">.</span>timestamp_low<span class="token punctuation">;</span>
    <span class="token function">cfr_array</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span> <span class="token operator">=</span> csi<span class="token punctuation">;</span>
    <span class="token function">rssi_array</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">[</span>csi_entry<span class="token punctuation">.</span>rssi_a<span class="token punctuation">,</span> csi_entry<span class="token punctuation">.</span>rssi_b<span class="token punctuation">,</span> csi_entry<span class="token punctuation">.</span>rssi_c<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">end</span>
</code></pre>
<h2 id="u8BBE_u7F6E_u6EE4_u6CE2_u5668"><a href="#u8BBE_u7F6E_u6EE4_u6CE2_u5668" class="headerlink" title="设置滤波器"></a>设置滤波器</h2><p>论文里虽然首先进行天线选择，但实际上先完成的是Butterworth滤波器的构造。滤波是为了将高频和低频的信号过滤掉。</p>
<pre class=" language-matlab"><code class="language-matlab">half_rate <span class="token operator">=</span> samp_rate <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
uppe_orde <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
uppe_stop <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
lowe_orde <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
lowe_stop <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>lu<span class="token punctuation">,</span>ld<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">butter</span><span class="token punctuation">(</span>uppe_orde<span class="token punctuation">,</span>uppe_stop<span class="token operator">/</span>half_rate<span class="token punctuation">,</span><span class="token string">'low'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>hu<span class="token punctuation">,</span>hd<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">butter</span><span class="token punctuation">(</span>lowe_orde<span class="token punctuation">,</span>lowe_stop<span class="token operator">/</span>half_rate<span class="token punctuation">,</span><span class="token string">'high'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data_wind <span class="token operator">=</span> samp_rate <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
iter_star <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>samp_rate<span class="token operator">:</span>n_data<span class="token operator">-</span>data_wind<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
freq_bins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">:</span>samp_rate<span class="token operator">/</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span>samp_rate<span class="token operator">/</span><span class="token number">2</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">'</span><span class="token operator">/</span>samp_rate<span class="token punctuation">;</span>
time_bins <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>iter_star<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0.5</span><span class="token operator">*</span>data_wind<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> samp_rate<span class="token punctuation">;</span>
freq_sele <span class="token operator">=</span> freq_bins <span class="token operator">&lt;=</span> uppe_stop <span class="token operator">/</span> samp_rate <span class="token operator">&amp;</span> freq_bins <span class="token operator">>=</span> <span class="token operator">-</span>uppe_stop <span class="token operator">/</span> samp_rate<span class="token punctuation">;</span>
freq_bins <span class="token operator">=</span> <span class="token function">freq_bins</span><span class="token punctuation">(</span>freq_sele<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
freq_time_prof <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>freq_bins<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">length</span><span class="token punctuation">(</span>time_bins<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">length</span><span class="token punctuation">(</span>file_path_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>关于滤波器的设置，这里面的tricks就非常多了。首先是定义了一个数据窗口(采样率的两倍)，接着就是定义了频域选择器，之后定义的 <code>freq_time_prof</code> 用于后面时频分析。<code>iter_star</code> 是迭代生成器，按照此预设的迭代生成器从原始数据中选取部分数据来进行操作。</p>
<h2 id="u5929_u7EBF_u9009_u62E9"><a href="#u5929_u7EBF_u9009_u62E9" class="headerlink" title="天线选择"></a>天线选择</h2><p>在天线选择之前，先计算出信道能量，这里信道能量就是CSI的共轭乘积。</p>
<pre class=" language-matlab"><code class="language-matlab">chan_data <span class="token operator">=</span> chan_data_list<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
chan_powe <span class="token operator">=</span> chan_data <span class="token operator">.*</span> <span class="token function">conj</span><span class="token punctuation">(</span>chan_data<span class="token punctuation">)</span><span class="token punctuation">;</span>
ante_pairs <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">length</span><span class="token punctuation">(</span>iter_star<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>之后按照论文的思路，选取出振幅最大方差最小和振幅最小方差最大的两个天线。这两根天线的数据进行计算共轭乘积。仔细想一下会发现这个地方非常的巧妙，一个动作的完整过程就是执行动作以及复原，会发现动作方向是一个相反方向，也就是说，多普勒频移应该是相反数的存在关系，通过共轭乘积，可以将这个动作看做成向同一个方向进行了一个更大的动作，这样将微弱的多普勒频移进行放大，这样在频谱图上，多普勒效应就会更加明显。</p>
<pre class=" language-matlab"><code class="language-matlab"><span class="token comment" spellcheck="true">%% Select antenna pair.</span>
                part_data <span class="token operator">=</span> <span class="token function">chan_data</span><span class="token punctuation">(</span><span class="token function">iter_star</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">iter_star</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token operator">+</span>data_wind<span class="token number">-1</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_powe <span class="token operator">=</span> <span class="token function">chan_powe</span><span class="token punctuation">(</span><span class="token function">iter_star</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">iter_star</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token operator">+</span>data_wind<span class="token number">-1</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_vari <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>part_powe<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_mean <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span>part_powe<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_vari_ante <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span><span class="token function">reshape</span><span class="token punctuation">(</span>part_vari<span class="token operator">.'</span><span class="token punctuation">,</span> n_subc<span class="token punctuation">,</span> n_ante<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_mean_ante <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span><span class="token function">reshape</span><span class="token punctuation">(</span>part_mean<span class="token operator">.'</span><span class="token punctuation">,</span> n_subc<span class="token punctuation">,</span> n_ante<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_indi_ante <span class="token operator">=</span> part_mean_ante <span class="token operator">./</span> part_vari_ante<span class="token punctuation">;</span>
                <span class="token punctuation">[</span><span class="token operator">~</span><span class="token punctuation">,</span> maxi<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>part_indi_ante<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">[</span><span class="token operator">~</span><span class="token punctuation">,</span> mini<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>part_indi_ante<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ante_pair <span class="token operator">=</span> <span class="token punctuation">[</span>mini<span class="token punctuation">,</span> maxi<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token function">ante_pairs</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> ante_pair<span class="token operator">.'</span><span class="token punctuation">;</span>
                part_diff <span class="token operator">=</span> <span class="token function">part_data</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">ante_pair</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>n_subc<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token function">ante_pair</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>n_subc<span class="token punctuation">)</span> <span class="token punctuation">...</span>
                    <span class="token operator">.*</span> <span class="token function">conj</span><span class="token punctuation">(</span><span class="token function">part_data</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">ante_pair</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>n_subc<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token function">ante_pair</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span>n_subc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="u6EE4_u6CE2_u4EE5_u53CA_u65F6_u9891_u5206_u6790"><a href="#u6EE4_u6CE2_u4EE5_u53CA_u65F6_u9891_u5206_u6790" class="headerlink" title="滤波以及时频分析"></a>滤波以及时频分析</h2><p>在选择完天线以后才会用之前定义好的滤波器进行滤波，接着用PCA进行数据压缩，之后用 <code>tftb</code> 时频分析工具箱进行时频分析。</p>
<pre class=" language-matlab"><code class="language-matlab"><span class="token comment" spellcheck="true">%% Filter out noises and interferences.</span>
                <span class="token keyword">for</span> jj <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>n_subc<span class="token punctuation">,</span>
                    <span class="token function">part_diff</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>jj<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>lu<span class="token punctuation">,</span> ld<span class="token punctuation">,</span> <span class="token function">part_diff</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>jj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">part_diff</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>jj<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>hu<span class="token punctuation">,</span> hd<span class="token punctuation">,</span> <span class="token function">part_diff</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>jj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">end</span>

                pca_coef <span class="token operator">=</span> <span class="token function">pca</span><span class="token punctuation">(</span>part_diff<span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_diff <span class="token operator">=</span> part_diff <span class="token operator">*</span> <span class="token function">pca_coef</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_wind <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token operator">*</span>samp_rate<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">1.5</span><span class="token operator">*</span>samp_rate<span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_spec <span class="token operator">=</span> <span class="token function">tfrsp</span><span class="token punctuation">(</span>part_diff<span class="token punctuation">,</span> part_wind<span class="token punctuation">,</span> samp_rate<span class="token punctuation">,</span> <span class="token function">tftb_window</span><span class="token punctuation">(</span>samp_rate<span class="token operator">/</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'gauss'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token punctuation">(</span>ii<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">*</span>samp_rate<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span>ii<span class="token operator">*</span>samp_rate<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">part_spec</span><span class="token punctuation">(</span>freq_sele<span class="token punctuation">,</span> <span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>使用 <code>mesh(time_bins, freq_bins, freq_time_prof)</code> 可以画出频谱图。</p>
<h2 id="u52A8_u4F5C_u68C0_u6D4B"><a href="#u52A8_u4F5C_u68C0_u6D4B" class="headerlink" title="动作检测"></a>动作检测</h2><p>在动作检测事情，先通过 <code>smooth</code> 进行数据光滑操作。</p>
<pre class=" language-matlab"><code class="language-matlab">prof_cent <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>time_bins<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">length</span><span class="token punctuation">(</span>file_path_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prof_vari <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>time_bins<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">length</span><span class="token punctuation">(</span>file_path_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prof_ener <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>time_bins<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">length</span><span class="token punctuation">(</span>file_path_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%     powe_cent = zeros(length(time_bins),length(file_path_list));</span>
    norm_freq_time_prof <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>freq_time_prof<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%     norm_powe_freq_time_prof = zeros(size(powe_freq_time_prof));</span>

    <span class="token keyword">for</span> kk <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>file_path_list<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">norm_freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">./</span> <span class="token function">repmat</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token function">freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         norm_powe_freq_time_prof(:,:,kk) = abs(powe_freq_time_prof(:,:,kk)) ./ repmat(sum(abs(powe_freq_time_prof(:,:,kk)),1), size(powe_freq_time_prof(:,:,kk),1), 1);</span>
        <span class="token function">prof_cent</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> freq_bins<span class="token operator">.'</span> <span class="token operator">*</span> <span class="token function">norm_freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         powe_cent(:,kk) = powe_freq_bins.' * norm_powe_freq_time_prof(:,:,kk);</span>

        <span class="token function">prof_vari</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">repmat</span><span class="token punctuation">(</span>freq_bins<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">length</span><span class="token punctuation">(</span>time_bins<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">repmat</span><span class="token punctuation">(</span><span class="token function">prof_cent</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token operator">.'</span><span class="token punctuation">,</span> <span class="token function">length</span><span class="token punctuation">(</span>freq_bins<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.^</span><span class="token number">2</span> <span class="token punctuation">...</span>
            <span class="token operator">.*</span> <span class="token function">norm_freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">prof_ener</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">smooth</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> samp_rate<span class="token operator">/</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'moving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
</code></pre>
<p>动作检测里设定了阈值，正如论文所说的，一个动作在一对波峰或波谷之中。</p>
<pre class=" language-matlab"><code class="language-matlab"><span class="token comment" spellcheck="true">%% Motion Detection...</span>
    moti_indi <span class="token operator">=</span> <span class="token function">smooth</span><span class="token punctuation">(</span><span class="token function">mean</span><span class="token punctuation">(</span>prof_vari<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>samp_rate<span class="token operator">/</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'moving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dete_thre <span class="token operator">=</span> <span class="token number">0.015</span><span class="token punctuation">;</span>
    time_thre <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    moti_valu <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    moti_inde <span class="token operator">=</span> moti_indi <span class="token operator">&lt;</span> dete_thre<span class="token punctuation">;</span>

    <span class="token keyword">for</span> jj <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>time_thre<span class="token punctuation">)</span><span class="token punctuation">,</span>
        curr_thre <span class="token operator">=</span> <span class="token function">time_thre</span><span class="token punctuation">(</span>jj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        curr_valu <span class="token operator">=</span> <span class="token function">moti_valu</span><span class="token punctuation">(</span>jj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ii <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> ii <span class="token operator">&lt;=</span> <span class="token function">length</span><span class="token punctuation">(</span>moti_inde<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">while</span> ii <span class="token operator">&lt;=</span> <span class="token function">length</span><span class="token punctuation">(</span>moti_inde<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">moti_inde</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">~=</span> curr_valu<span class="token punctuation">,</span>
                ii <span class="token operator">=</span> ii <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            <span class="token keyword">if</span> ii <span class="token operator">></span> <span class="token function">length</span><span class="token punctuation">(</span>moti_inde<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            kk <span class="token operator">=</span> ii <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> kk <span class="token operator">&lt;=</span> <span class="token function">length</span><span class="token punctuation">(</span>moti_inde<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">moti_inde</span><span class="token punctuation">(</span>kk<span class="token punctuation">)</span> <span class="token operator">==</span> curr_valu<span class="token punctuation">,</span>
                kk <span class="token operator">=</span> kk <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            <span class="token keyword">if</span> kk <span class="token operator">-</span> ii <span class="token operator">&lt;</span> curr_thre <span class="token operator">*</span> samp_rate<span class="token punctuation">,</span>
                <span class="token function">moti_inde</span><span class="token punctuation">(</span>ii<span class="token operator">:</span>kk<span class="token number">-1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">~</span>curr_valu<span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            ii <span class="token operator">=</span> kk<span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    moti_indx <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>moti_inde<span class="token punctuation">)</span><span class="token punctuation">;</span>
    note_inte <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span>note_inte <span class="token operator">*</span> samp_rate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    note_indx <span class="token operator">=</span> <span class="token function">moti_indx</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">%note_indx = indx_list(ll);</span>
    note_end <span class="token operator">=</span> <span class="token function">moti_indx</span><span class="token punctuation">(</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    note_segm <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span>n_note<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="u52A8_u4F5C_u5206_u7247"><a href="#u52A8_u4F5C_u5206_u7247" class="headerlink" title="动作分片"></a>动作分片</h2><p>动作分片其实可以和动作检测看成一个整体，就是将所有包含动作的数据包进行切片出来，然后拼接在一起。</p>
<pre class=" language-matlab"><code class="language-matlab"><span class="token comment" spellcheck="true">%% Segmentation...</span>
    segm_lowb <span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">;</span>
    segm_higb <span class="token operator">=</span> <span class="token number">1.2</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> ii <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>n_note<span class="token punctuation">,</span>
        <span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> note_indx<span class="token punctuation">;</span>
        <span class="token keyword">if</span> ii <span class="token operator">&lt;</span> n_note<span class="token punctuation">,</span>
            curr_ener <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span><span class="token function">prof_ener</span><span class="token punctuation">(</span>note_indx<span class="token operator">:</span><span class="token function">min</span><span class="token punctuation">(</span>note_indx<span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>note_inte<span class="token number">-1</span><span class="token punctuation">,</span><span class="token function">size</span><span class="token punctuation">(</span>prof_ener<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">[</span><span class="token operator">~</span><span class="token punctuation">,</span> segm_poin<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">curr_ener</span><span class="token punctuation">(</span><span class="token function">floor</span><span class="token punctuation">(</span>note_inte<span class="token operator">*</span>segm_lowb<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token function">floor</span><span class="token punctuation">(</span>note_inte<span class="token operator">*</span>segm_higb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> note_indx<span class="token operator">+</span><span class="token function">floor</span><span class="token punctuation">(</span>note_inte<span class="token operator">*</span>segm_lowb<span class="token punctuation">)</span><span class="token operator">+</span>segm_poin<span class="token number">-1</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%             plot(time_bins(note_indx:min(note_indx+2*note_inte-1,size(prof_ener,1))), curr_ener);</span>
<span class="token comment" spellcheck="true">%             hold on;</span>
<span class="token comment" spellcheck="true">%             plot(time_bins(note_indx-1+floor(note_inte*segm_lowb)+segm_poin), curr_ener(floor(note_inte*segm_lowb)+segm_poin), </span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%             hold off;</span>
            note_indx <span class="token operator">=</span> note_indx<span class="token operator">+</span><span class="token function">floor</span><span class="token punctuation">(</span>note_inte<span class="token operator">*</span>segm_lowb<span class="token punctuation">)</span><span class="token operator">+</span>segm_poin<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            curr_ener <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span><span class="token function">prof_ener</span><span class="token punctuation">(</span>note_indx<span class="token operator">:</span>note_end<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> note_end<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%             plot(time_bins(note_indx:note_end), curr_ener);</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
</code></pre>
<h2 id="u52A8_u4F5C_u8BC6_u522B"><a href="#u52A8_u4F5C_u8BC6_u522B" class="headerlink" title="动作识别"></a>动作识别</h2><p>动作识别是整个论文最关键的地方，准确的说，应该是方向识别。引入两个接收端，来同时计算出多普勒频移，通过比对动作对两个接收端的多普勒频移，来进行动作识别。这种方法无需训练，可以即时的计算出方向。</p>
<pre class=" language-matlab"><code class="language-matlab"><span class="token comment" spellcheck="true">%% Recognition..</span>
    <span class="token keyword">for</span> kk <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">size</span><span class="token punctuation">(</span>prof_cent<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">prof_cent</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">smooth</span><span class="token punctuation">(</span><span class="token function">prof_cent</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">,</span> samp_rate<span class="token operator">/</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'moving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         powe_cent(:,kk) = smooth(powe_cent(:,kk), samp_rate/4+1, </span><span class="token string">'moving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token function">prof_cent</span><span class="token punctuation">(</span><span class="token operator">~</span>moti_inde<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    prof_cent_tota <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>prof_cent<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
    prof_cent_tota <span class="token operator">=</span> <span class="token function">smooth</span><span class="token punctuation">(</span>prof_cent_tota<span class="token punctuation">,</span> samp_rate<span class="token operator">/</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'moving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%     powe_cent(~moti_inde,:) = 0;</span>
<span class="token comment" spellcheck="true">%     powe_cent_tota = sum(abs(powe_cent),2)/2;</span>
<span class="token comment" spellcheck="true">%     powe_cent_tota = smooth(powe_cent_tota, samp_rate/8+1, </span><span class="token string">'moving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    note_list <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>n_note<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tx <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1.6</span><span class="token punctuation">,</span><span class="token number">1.6</span><span class="token punctuation">]</span><span class="token operator">.'</span><span class="token punctuation">;</span>
    rx <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1.6</span><span class="token punctuation">;</span><span class="token number">1.6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">.'</span><span class="token punctuation">;</span>
    init_loc <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.8</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">]</span><span class="token operator">.'</span><span class="token punctuation">;</span>
    tant_valu <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>n_note<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dire_valu <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>n_note<span class="token punctuation">)</span><span class="token punctuation">;</span>
    peak_dist <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> ii <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>n_note<span class="token punctuation">,</span>
        curr_cent <span class="token operator">=</span> <span class="token function">prof_cent</span><span class="token punctuation">(</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        curr_cent_tota <span class="token operator">=</span> <span class="token function">prof_cent_tota</span><span class="token punctuation">(</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         curr_powe_cent = powe_cent(note_segm(ii,1):note_segm(ii,2),:);</span>
<span class="token comment" spellcheck="true">%         curr_powe_cent_tota = powe_cent_tota(note_segm(ii,1):note_segm(ii,2),:);</span>
        curr_cent <span class="token operator">=</span> <span class="token function">curr_cent</span><span class="token punctuation">(</span><span class="token function">moti_inde</span><span class="token punctuation">(</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        curr_cent_tota <span class="token operator">=</span> <span class="token function">curr_cent_tota</span><span class="token punctuation">(</span><span class="token function">moti_inde</span><span class="token punctuation">(</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        midd_poin <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>curr_cent_tota<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        firs_half <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>midd_poin<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        seco_half <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span>midd_poin<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> kk <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>file_path_list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token function">firs_half</span><span class="token punctuation">(</span>kk<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token function">seco_half</span><span class="token punctuation">(</span>kk<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">curr_cent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>midd_poin<span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>midd_poin<span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">curr_cent</span><span class="token punctuation">(</span>midd_poin<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span>midd_poin<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token function">curr_cent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>midd_poin<span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>midd_poin<span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">curr_cent</span><span class="token punctuation">(</span>midd_poin<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span>midd_poin<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
        curr_cent <span class="token operator">=</span> curr_cent <span class="token operator">-</span> <span class="token function">repmat</span><span class="token punctuation">(</span><span class="token function">mean</span><span class="token punctuation">(</span>curr_cent<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">size</span><span class="token punctuation">(</span>curr_cent<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        firs_half <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>midd_poin<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        seco_half <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span>midd_poin<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         if (mark_list(ii) >= 1 &amp;&amp; mark_list(ii) &lt;= 2) || (mark_list(ii) == 8),</span>
<span class="token comment" spellcheck="true">%             firs_half(2) = firs_half(2);</span>
<span class="token comment" spellcheck="true">%             seco_half(2) = seco_half(2);</span>
<span class="token comment" spellcheck="true">%         elseif (mark_list(ii) >= 4 &amp;&amp; mark_list(ii) &lt;= 6),</span>
<span class="token comment" spellcheck="true">%             firs_half(1) = firs_half(1);</span>
<span class="token comment" spellcheck="true">%             seco_half(1) = seco_half(1);</span>
<span class="token comment" spellcheck="true">%         end</span>
        <span class="token function">tant_valu</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">atan2</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">firs_half</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">seco_half</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">firs_half</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">seco_half</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">pi</span> <span class="token operator">*</span> <span class="token number">180</span><span class="token punctuation">;</span>        
        <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> firs_half <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token function">tant_valu</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">60</span><span class="token punctuation">,</span>
            <span class="token keyword">if</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
        <span class="token keyword">elseif</span> <span class="token function">tant_valu</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">,</span>
            <span class="token keyword">if</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
        <span class="token keyword">else</span>
            <span class="token keyword">if</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
            <span class="token keyword">elseif</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
            <span class="token keyword">elseif</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
        <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         if tant_valu(ii) > 45,</span>
<span class="token comment" spellcheck="true">%             if dire_valu(1,ii) == 1,</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 8;</span>
<span class="token comment" spellcheck="true">%             else</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 4;</span>
<span class="token comment" spellcheck="true">%             end</span>
<span class="token comment" spellcheck="true">%         else</span>
<span class="token comment" spellcheck="true">%             if dire_valu(2,ii) == 1,</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 6;</span>
<span class="token comment" spellcheck="true">%             else</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 2;</span>
<span class="token comment" spellcheck="true">%             end</span>
<span class="token comment" spellcheck="true">%         end</span>

<span class="token comment" spellcheck="true">%             if dire_valu(1,ii) == 1 &amp;&amp; dire_valu(2,ii) == 1,</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 7;</span>
<span class="token comment" spellcheck="true">%             elseif dire_valu(1,ii) == 1 &amp;&amp; dire_valu(2,ii) == 0,</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 1;</span>
<span class="token comment" spellcheck="true">%             elseif dire_valu(1,ii) == 0 &amp;&amp; dire_valu(2,ii) == 1,</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 5;</span>
<span class="token comment" spellcheck="true">%             else</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 3;</span>
<span class="token comment" spellcheck="true">%             end</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token string">'index:%d... tant:%f... dire: %d,%d... mark: %d... pred: %d\n'</span><span class="token punctuation">,</span> ii<span class="token punctuation">,</span> <span class="token function">tant_valu</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mark_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="总结"></a>总结</h2><p>上述简单分析了整个实验的流程和代码，有些地方没有细细讲解，也有部分没有看懂，欢迎指正。以下是完整的代码。当然这个完整代码依赖一些其他的函数，考虑到完整的数据太大，打包了包含部分数据的完整代码上传至百度云。</p>
<pre class=" language-matlab"><code class="language-matlab"><span class="token comment" spellcheck="true">%% Load CSI data.</span>
data_path <span class="token operator">=</span> <span class="token string">'data/final/'</span><span class="token punctuation">;</span>
resu_path <span class="token operator">=</span> <span class="token string">'experiment/all_2.mat'</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">%% Total Training</span>
training_list <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'P1-A1-I2-G1'</span><span class="token punctuation">,</span><span class="token string">'P1-A1-I2-G2'</span><span class="token punctuation">,</span><span class="token string">'P2-A1-I2-G1'</span><span class="token punctuation">,</span><span class="token string">'P2-A1-I2-G2'</span><span class="token punctuation">,</span><span class="token punctuation">...</span>
    <span class="token string">'P3-A1-I2-G1'</span><span class="token punctuation">,</span><span class="token string">'P3-A1-I2-G2'</span><span class="token punctuation">,</span> <span class="token string">'P4-A1-I2-G1'</span><span class="token punctuation">,</span><span class="token string">'P4-A1-I2-G2'</span><span class="token punctuation">,</span><span class="token punctuation">...</span>
    <span class="token string">'P5-A1-I2-G1'</span><span class="token punctuation">,</span><span class="token string">'P5-A1-I2-G2'</span><span class="token punctuation">,</span><span class="token string">'P1-A2-I2-G1'</span><span class="token punctuation">,</span><span class="token string">'P1-A2-I2-G2'</span><span class="token punctuation">,</span><span class="token punctuation">...</span>
    <span class="token string">'P1-A3-I2-G2'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
training_inde <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2540</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token number">2300</span><span class="token punctuation">,</span><span class="token number">2150</span><span class="token punctuation">,</span><span class="token punctuation">...</span>
    <span class="token number">2890</span><span class="token punctuation">,</span><span class="token number">2800</span><span class="token punctuation">,</span><span class="token number">2500</span><span class="token punctuation">,</span><span class="token number">2400</span><span class="token punctuation">,</span><span class="token punctuation">...</span>
    <span class="token number">3400</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token number">2300</span><span class="token punctuation">,</span><span class="token number">1150</span><span class="token punctuation">,</span><span class="token punctuation">...</span>
    <span class="token number">2050</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">%% Total Testing</span>
testing_list <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'P1-A1-I2-G3'</span><span class="token punctuation">,</span><span class="token string">'P1-A1-I2-G4'</span><span class="token punctuation">,</span> <span class="token string">'P2-A1-I2-G3'</span><span class="token punctuation">,</span><span class="token string">'P2-A1-I2-G4'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
    <span class="token string">'P3-A1-I2-G3'</span><span class="token punctuation">,</span><span class="token string">'P3-A1-I2-G4'</span><span class="token punctuation">,</span> <span class="token string">'P4-A1-I2-G3'</span><span class="token punctuation">,</span><span class="token string">'P4-A1-I2-G4'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
    <span class="token string">'P5-A1-I2-G3'</span><span class="token punctuation">,</span><span class="token string">'P5-A1-I2-G4'</span><span class="token punctuation">,</span> <span class="token string">'P1-A2-I2-G3'</span><span class="token punctuation">,</span><span class="token string">'P1-A2-I2-G4'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
    <span class="token string">'P1-A3-I2-G3'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
indx_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3200</span><span class="token punctuation">,</span><span class="token number">3230</span><span class="token punctuation">,</span> <span class="token number">2250</span><span class="token punctuation">,</span><span class="token number">2900</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
    <span class="token number">3000</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token number">2350</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
    <span class="token number">2550</span><span class="token punctuation">,</span><span class="token number">1850</span><span class="token punctuation">,</span> <span class="token number">2500</span><span class="token punctuation">,</span><span class="token number">2100</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
    <span class="token number">1900</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

prefix_list <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'P1-A1-I2-G1'</span><span class="token punctuation">,</span><span class="token string">'P1-A1-I2-G2'</span><span class="token punctuation">,</span><span class="token string">'P1-A1-I2-G3'</span><span class="token punctuation">,</span><span class="token string">'P1-A1-I2-G4'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
    <span class="token string">'P2-A1-I2-G1'</span><span class="token punctuation">,</span><span class="token string">'P2-A1-I2-G2'</span><span class="token punctuation">,</span><span class="token string">'P2-A1-I2-G3'</span><span class="token punctuation">,</span><span class="token string">'P2-A1-I2-G4'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
    <span class="token string">'P3-A1-I2-G1'</span><span class="token punctuation">,</span><span class="token string">'P3-A1-I2-G2'</span><span class="token punctuation">,</span><span class="token string">'P3-A1-I2-G3'</span><span class="token punctuation">,</span><span class="token string">'P3-A1-I2-G4'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
    <span class="token string">'P4-A1-I2-G1'</span><span class="token punctuation">,</span><span class="token string">'P4-A1-I2-G2'</span><span class="token punctuation">,</span><span class="token string">'P4-A1-I2-G3'</span><span class="token punctuation">,</span><span class="token string">'P4-A1-I2-G4'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
    <span class="token string">'P5-A1-I2-G1'</span><span class="token punctuation">,</span><span class="token string">'P5-A1-I2-G2'</span><span class="token punctuation">,</span><span class="token string">'P5-A1-I2-G3'</span><span class="token punctuation">,</span><span class="token string">'P5-A1-I2-G4'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
    <span class="token string">'P1-A2-I2-G1'</span><span class="token punctuation">,</span><span class="token string">'P1-A2-I2-G2'</span><span class="token punctuation">,</span><span class="token string">'P1-A2-I2-G3'</span><span class="token punctuation">,</span><span class="token string">'P1-A2-I2-G4'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
    <span class="token string">'P1-A3-I2-G2'</span><span class="token punctuation">,</span><span class="token string">'P1-A3-I2-G3'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">%% Data Processing.</span>
carr_freq <span class="token operator">=</span> <span class="token number">5.825e9</span><span class="token punctuation">;</span>
wave_spee <span class="token operator">=</span> <span class="token number">299792458</span><span class="token punctuation">;</span>
n_subc <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
n_ante <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
wave_leng <span class="token operator">=</span> wave_spee <span class="token operator">/</span> carr_freq<span class="token punctuation">;</span>
n_note <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
all_tant <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
all_mark <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
all_dire <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
all_resu <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
confusion <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
type_summ <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> ll <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>prefix_list<span class="token punctuation">)</span><span class="token punctuation">,</span>
    note_inte <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    prefix <span class="token operator">=</span> prefix_list<span class="token punctuation">{</span>ll<span class="token punctuation">}</span><span class="token punctuation">;</span>

    file_path_list <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">[</span>data_path<span class="token punctuation">,</span> <span class="token string">'R1-'</span><span class="token punctuation">,</span>prefix<span class="token punctuation">,</span><span class="token string">'.dat'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>data_path<span class="token punctuation">,</span> <span class="token string">'R2-'</span><span class="token punctuation">,</span>prefix<span class="token punctuation">,</span><span class="token string">'.dat'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    ground_truth_path <span class="token operator">=</span> <span class="token punctuation">[</span>data_path<span class="token punctuation">,</span> prefix<span class="token punctuation">,</span> <span class="token string">'.mat'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    save_path <span class="token operator">=</span> <span class="token punctuation">[</span>data_path<span class="token punctuation">,</span> <span class="token string">'MED-'</span><span class="token punctuation">,</span> prefix<span class="token punctuation">,</span> <span class="token string">'.mat'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    ground_truth <span class="token operator">=</span> <span class="token function">load</span><span class="token punctuation">(</span>ground_truth_path<span class="token punctuation">,</span> <span class="token string">'mark_list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mark_list <span class="token operator">=</span> ground_truth<span class="token punctuation">.</span>mark_list<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token operator">~</span><span class="token function">exist</span><span class="token punctuation">(</span>save_path<span class="token punctuation">)</span><span class="token punctuation">,</span>
        chan_data_list <span class="token operator">=</span> <span class="token function">cell</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">length</span><span class="token punctuation">(</span>file_path_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> kk <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>file_path_list<span class="token punctuation">)</span><span class="token punctuation">,</span>
            file_path <span class="token operator">=</span> file_path_list<span class="token punctuation">{</span>kk<span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">[</span>chan_data<span class="token punctuation">,</span> time_stam<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">csi_get_all</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> kk <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token comment" spellcheck="true">%                 samp_rate = length(time_stam) / (time_stam(end)-time_stam(1)) * 1e6;</span>
<span class="token comment" spellcheck="true">%                 samp_rate = 2^(round(log2(samp_rate)));</span>
                samp_rate <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
                n_data <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>chan_data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">elseif</span> n_data <span class="token operator">></span> <span class="token function">size</span><span class="token punctuation">(</span>chan_data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                n_data <span class="token operator">=</span> <span class="token function">size</span><span class="token punctuation">(</span>chan_data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            chan_data_list<span class="token punctuation">{</span>kk<span class="token punctuation">}</span> <span class="token operator">=</span> chan_data<span class="token punctuation">;</span>
        <span class="token keyword">end</span>

        <span class="token comment" spellcheck="true">%% Set up filters.</span>
        half_rate <span class="token operator">=</span> samp_rate <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        uppe_orde <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
        uppe_stop <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
        lowe_orde <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        lowe_stop <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>lu<span class="token punctuation">,</span>ld<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">butter</span><span class="token punctuation">(</span>uppe_orde<span class="token punctuation">,</span>uppe_stop<span class="token operator">/</span>half_rate<span class="token punctuation">,</span><span class="token string">'low'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>hu<span class="token punctuation">,</span>hd<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">butter</span><span class="token punctuation">(</span>lowe_orde<span class="token punctuation">,</span>lowe_stop<span class="token operator">/</span>half_rate<span class="token punctuation">,</span><span class="token string">'high'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        data_wind <span class="token operator">=</span> samp_rate <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
        iter_star <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>samp_rate<span class="token operator">:</span>n_data<span class="token operator">-</span>data_wind<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
        freq_bins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">:</span>samp_rate<span class="token operator">/</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span>samp_rate<span class="token operator">/</span><span class="token number">2</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">'</span><span class="token operator">/</span>samp_rate<span class="token punctuation">;</span>
        time_bins <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>iter_star<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0.5</span><span class="token operator">*</span>data_wind<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> samp_rate<span class="token punctuation">;</span>
        freq_sele <span class="token operator">=</span> freq_bins <span class="token operator">&lt;=</span> uppe_stop <span class="token operator">/</span> samp_rate <span class="token operator">&amp;</span> freq_bins <span class="token operator">>=</span> <span class="token operator">-</span>uppe_stop <span class="token operator">/</span> samp_rate<span class="token punctuation">;</span>
        freq_bins <span class="token operator">=</span> <span class="token function">freq_bins</span><span class="token punctuation">(</span>freq_sele<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         powe_freq_sele = freq_bins >= 0 &amp; freq_bins &lt;= uppe_stop / samp_rate;</span>
<span class="token comment" spellcheck="true">%         powe_freq_bins = freq_bins(powe_freq_sele,:);</span>
        freq_time_prof <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>freq_bins<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">length</span><span class="token punctuation">(</span>time_bins<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">length</span><span class="token punctuation">(</span>file_path_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         powe_freq_time_prof = zeros(length(powe_freq_bins), length(time_bins),length(file_path_list));</span>

        <span class="token keyword">for</span> kk <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>file_path_list<span class="token punctuation">)</span><span class="token punctuation">,</span>
           <span class="token comment" spellcheck="true">%% Processing data streams.</span>
            chan_data <span class="token operator">=</span> chan_data_list<span class="token punctuation">{</span>kk<span class="token punctuation">}</span><span class="token punctuation">;</span>
            chan_powe <span class="token operator">=</span> chan_data <span class="token operator">.*</span> <span class="token function">conj</span><span class="token punctuation">(</span>chan_data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ante_pairs <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">length</span><span class="token punctuation">(</span>iter_star<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> ii <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>iter_star<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment" spellcheck="true">%% Select antenna pair.</span>
                part_data <span class="token operator">=</span> <span class="token function">chan_data</span><span class="token punctuation">(</span><span class="token function">iter_star</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">iter_star</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token operator">+</span>data_wind<span class="token number">-1</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_powe <span class="token operator">=</span> <span class="token function">chan_powe</span><span class="token punctuation">(</span><span class="token function">iter_star</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">iter_star</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token operator">+</span>data_wind<span class="token number">-1</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_vari <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>part_powe<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_mean <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span>part_powe<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_vari_ante <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span><span class="token function">reshape</span><span class="token punctuation">(</span>part_vari<span class="token operator">.'</span><span class="token punctuation">,</span> n_subc<span class="token punctuation">,</span> n_ante<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_mean_ante <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span><span class="token function">reshape</span><span class="token punctuation">(</span>part_mean<span class="token operator">.'</span><span class="token punctuation">,</span> n_subc<span class="token punctuation">,</span> n_ante<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_indi_ante <span class="token operator">=</span> part_mean_ante <span class="token operator">./</span> part_vari_ante<span class="token punctuation">;</span>
                <span class="token punctuation">[</span><span class="token operator">~</span><span class="token punctuation">,</span> maxi<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>part_indi_ante<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">[</span><span class="token operator">~</span><span class="token punctuation">,</span> mini<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>part_indi_ante<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ante_pair <span class="token operator">=</span> <span class="token punctuation">[</span>mini<span class="token punctuation">,</span> maxi<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token function">ante_pairs</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> ante_pair<span class="token operator">.'</span><span class="token punctuation">;</span>
                part_diff <span class="token operator">=</span> <span class="token function">part_data</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">ante_pair</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>n_subc<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token function">ante_pair</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>n_subc<span class="token punctuation">)</span> <span class="token punctuation">...</span>
                    <span class="token operator">.*</span> <span class="token function">conj</span><span class="token punctuation">(</span><span class="token function">part_data</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">ante_pair</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>n_subc<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token function">ante_pair</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">*</span>n_subc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment" spellcheck="true">%% Filter out noises and interferences.</span>
                <span class="token keyword">for</span> jj <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>n_subc<span class="token punctuation">,</span>
                    <span class="token function">part_diff</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>jj<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>lu<span class="token punctuation">,</span> ld<span class="token punctuation">,</span> <span class="token function">part_diff</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>jj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">part_diff</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>jj<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>hu<span class="token punctuation">,</span> hd<span class="token punctuation">,</span> <span class="token function">part_diff</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>jj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">end</span>
<span class="token comment" spellcheck="true">%                 for jj = 1:n_subc*3,</span>
<span class="token comment" spellcheck="true">%                     part_powe(:,jj) = filter(lu, ld, part_powe(:,jj));</span>
<span class="token comment" spellcheck="true">%                     part_powe(:,jj) = filter(hu, hd, part_powe(:,jj));</span>
<span class="token comment" spellcheck="true">%                 end</span>

               <span class="token comment" spellcheck="true">%% PCA analysis.</span>
                pca_coef <span class="token operator">=</span> <span class="token function">pca</span><span class="token punctuation">(</span>part_diff<span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_diff <span class="token operator">=</span> part_diff <span class="token operator">*</span> <span class="token function">pca_coef</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_wind <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token operator">*</span>samp_rate<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">1.5</span><span class="token operator">*</span>samp_rate<span class="token punctuation">)</span><span class="token punctuation">;</span>
                part_spec <span class="token operator">=</span> <span class="token function">tfrsp</span><span class="token punctuation">(</span>part_diff<span class="token punctuation">,</span> part_wind<span class="token punctuation">,</span> samp_rate<span class="token punctuation">,</span> <span class="token function">tftb_window</span><span class="token punctuation">(</span>samp_rate<span class="token operator">/</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'gauss'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token punctuation">(</span>ii<span class="token number">-1</span><span class="token punctuation">)</span><span class="token operator">*</span>samp_rate<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span>ii<span class="token operator">*</span>samp_rate<span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">part_spec</span><span class="token punctuation">(</span>freq_sele<span class="token punctuation">,</span> <span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">%                 powe_pca_coef = pca(part_powe);</span>
<span class="token comment" spellcheck="true">%                 part_powe = part_powe * powe_pca_coef(:,1);</span>
<span class="token comment" spellcheck="true">%                 powe_part_spec = tfrsp(part_powe, part_wind, samp_rate, tftb_window(samp_rate/8+1, </span><span class="token string">'gauss'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%                 powe_freq_time_prof(:,(ii-1)*samp_rate+1:ii*samp_rate,kk) = powe_part_spec(powe_freq_sele, :);</span>
            <span class="token keyword">end</span>
            <span class="token function">freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%             powe_freq_time_prof(:,:,kk) = abs(powe_freq_time_prof(:,:,kk));</span>
        <span class="token keyword">end</span>
        <span class="token function">save</span><span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> <span class="token string">'freq_time_prof'</span><span class="token punctuation">,</span> <span class="token string">'powe_freq_time_prof'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">load</span><span class="token punctuation">(</span>save_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        samp_rate <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
        uppe_stop <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
        freq_bins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">:</span>samp_rate<span class="token operator">/</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span>samp_rate<span class="token operator">/</span><span class="token number">2</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">'</span><span class="token operator">/</span>samp_rate<span class="token punctuation">;</span>
        freq_sele <span class="token operator">=</span> freq_bins <span class="token operator">&lt;=</span> uppe_stop <span class="token operator">/</span> samp_rate <span class="token operator">&amp;</span> freq_bins <span class="token operator">>=</span> <span class="token operator">-</span>uppe_stop <span class="token operator">/</span> samp_rate<span class="token punctuation">;</span>
        freq_bins <span class="token operator">=</span> <span class="token function">freq_bins</span><span class="token punctuation">(</span>freq_sele<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         powe_freq_sele = freq_bins &lt;= uppe_stop / samp_rate &amp; freq_bins >= 0;</span>
<span class="token comment" spellcheck="true">%         powe_freq_bins = freq_bins(powe_freq_sele);</span>
        time_bins <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">:</span><span class="token function">size</span><span class="token punctuation">(</span>freq_time_prof<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span>samp_rate<span class="token punctuation">;</span>
    <span class="token keyword">end</span>

    prof_cent <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>time_bins<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">length</span><span class="token punctuation">(</span>file_path_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prof_vari <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>time_bins<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">length</span><span class="token punctuation">(</span>file_path_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prof_ener <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>time_bins<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">length</span><span class="token punctuation">(</span>file_path_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%     powe_cent = zeros(length(time_bins),length(file_path_list));</span>
    norm_freq_time_prof <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">size</span><span class="token punctuation">(</span>freq_time_prof<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%     norm_powe_freq_time_prof = zeros(size(powe_freq_time_prof));</span>

    <span class="token keyword">for</span> kk <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>file_path_list<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">norm_freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">./</span> <span class="token function">repmat</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token function">freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         norm_powe_freq_time_prof(:,:,kk) = abs(powe_freq_time_prof(:,:,kk)) ./ repmat(sum(abs(powe_freq_time_prof(:,:,kk)),1), size(powe_freq_time_prof(:,:,kk),1), 1);</span>
        <span class="token function">prof_cent</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> freq_bins<span class="token operator">.'</span> <span class="token operator">*</span> <span class="token function">norm_freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         powe_cent(:,kk) = powe_freq_bins.' * norm_powe_freq_time_prof(:,:,kk);</span>

        <span class="token function">prof_vari</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">repmat</span><span class="token punctuation">(</span>freq_bins<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">length</span><span class="token punctuation">(</span>time_bins<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">repmat</span><span class="token punctuation">(</span><span class="token function">prof_cent</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token operator">.'</span><span class="token punctuation">,</span> <span class="token function">length</span><span class="token punctuation">(</span>freq_bins<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.^</span><span class="token number">2</span> <span class="token punctuation">...</span>
            <span class="token operator">.*</span> <span class="token function">norm_freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">prof_ener</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">smooth</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">freq_time_prof</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> samp_rate<span class="token operator">/</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'moving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>

    <span class="token comment" spellcheck="true">%% Motion Detection...</span>
    moti_indi <span class="token operator">=</span> <span class="token function">smooth</span><span class="token punctuation">(</span><span class="token function">mean</span><span class="token punctuation">(</span>prof_vari<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>samp_rate<span class="token operator">/</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'moving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dete_thre <span class="token operator">=</span> <span class="token number">0.015</span><span class="token punctuation">;</span>
    time_thre <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    moti_valu <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    moti_inde <span class="token operator">=</span> moti_indi <span class="token operator">&lt;</span> dete_thre<span class="token punctuation">;</span>

    <span class="token keyword">for</span> jj <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>time_thre<span class="token punctuation">)</span><span class="token punctuation">,</span>
        curr_thre <span class="token operator">=</span> <span class="token function">time_thre</span><span class="token punctuation">(</span>jj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        curr_valu <span class="token operator">=</span> <span class="token function">moti_valu</span><span class="token punctuation">(</span>jj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ii <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> ii <span class="token operator">&lt;=</span> <span class="token function">length</span><span class="token punctuation">(</span>moti_inde<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">while</span> ii <span class="token operator">&lt;=</span> <span class="token function">length</span><span class="token punctuation">(</span>moti_inde<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">moti_inde</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">~=</span> curr_valu<span class="token punctuation">,</span>
                ii <span class="token operator">=</span> ii <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            <span class="token keyword">if</span> ii <span class="token operator">></span> <span class="token function">length</span><span class="token punctuation">(</span>moti_inde<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            kk <span class="token operator">=</span> ii <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> kk <span class="token operator">&lt;=</span> <span class="token function">length</span><span class="token punctuation">(</span>moti_inde<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">moti_inde</span><span class="token punctuation">(</span>kk<span class="token punctuation">)</span> <span class="token operator">==</span> curr_valu<span class="token punctuation">,</span>
                kk <span class="token operator">=</span> kk <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            <span class="token keyword">if</span> kk <span class="token operator">-</span> ii <span class="token operator">&lt;</span> curr_thre <span class="token operator">*</span> samp_rate<span class="token punctuation">,</span>
                <span class="token function">moti_inde</span><span class="token punctuation">(</span>ii<span class="token operator">:</span>kk<span class="token number">-1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">~</span>curr_valu<span class="token punctuation">;</span>
            <span class="token keyword">end</span>
            ii <span class="token operator">=</span> kk<span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
    moti_indx <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>moti_inde<span class="token punctuation">)</span><span class="token punctuation">;</span>
    note_inte <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span>note_inte <span class="token operator">*</span> samp_rate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    note_indx <span class="token operator">=</span> <span class="token function">moti_indx</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">%note_indx = indx_list(ll);</span>
    note_end <span class="token operator">=</span> <span class="token function">moti_indx</span><span class="token punctuation">(</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    note_segm <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span>n_note<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">%% Segmentation...</span>
    segm_lowb <span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">;</span>
    segm_higb <span class="token operator">=</span> <span class="token number">1.2</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> ii <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>n_note<span class="token punctuation">,</span>
        <span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> note_indx<span class="token punctuation">;</span>
        <span class="token keyword">if</span> ii <span class="token operator">&lt;</span> n_note<span class="token punctuation">,</span>
            curr_ener <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span><span class="token function">prof_ener</span><span class="token punctuation">(</span>note_indx<span class="token operator">:</span><span class="token function">min</span><span class="token punctuation">(</span>note_indx<span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>note_inte<span class="token number">-1</span><span class="token punctuation">,</span><span class="token function">size</span><span class="token punctuation">(</span>prof_ener<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">[</span><span class="token operator">~</span><span class="token punctuation">,</span> segm_poin<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">curr_ener</span><span class="token punctuation">(</span><span class="token function">floor</span><span class="token punctuation">(</span>note_inte<span class="token operator">*</span>segm_lowb<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token function">floor</span><span class="token punctuation">(</span>note_inte<span class="token operator">*</span>segm_higb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> note_indx<span class="token operator">+</span><span class="token function">floor</span><span class="token punctuation">(</span>note_inte<span class="token operator">*</span>segm_lowb<span class="token punctuation">)</span><span class="token operator">+</span>segm_poin<span class="token number">-1</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%             plot(time_bins(note_indx:min(note_indx+2*note_inte-1,size(prof_ener,1))), curr_ener);</span>
<span class="token comment" spellcheck="true">%             hold on;</span>
<span class="token comment" spellcheck="true">%             plot(time_bins(note_indx-1+floor(note_inte*segm_lowb)+segm_poin), curr_ener(floor(note_inte*segm_lowb)+segm_poin), </span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%             hold off;</span>
            note_indx <span class="token operator">=</span> note_indx<span class="token operator">+</span><span class="token function">floor</span><span class="token punctuation">(</span>note_inte<span class="token operator">*</span>segm_lowb<span class="token punctuation">)</span><span class="token operator">+</span>segm_poin<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            curr_ener <span class="token operator">=</span> <span class="token function">mean</span><span class="token punctuation">(</span><span class="token function">prof_ener</span><span class="token punctuation">(</span>note_indx<span class="token operator">:</span>note_end<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> note_end<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%             plot(time_bins(note_indx:note_end), curr_ener);</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>

    <span class="token comment" spellcheck="true">%% Recognition..</span>
    <span class="token keyword">for</span> kk <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">size</span><span class="token punctuation">(</span>prof_cent<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">prof_cent</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">smooth</span><span class="token punctuation">(</span><span class="token function">prof_cent</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">,</span> samp_rate<span class="token operator">/</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'moving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         powe_cent(:,kk) = smooth(powe_cent(:,kk), samp_rate/4+1, </span><span class="token string">'moving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token function">prof_cent</span><span class="token punctuation">(</span><span class="token operator">~</span>moti_inde<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    prof_cent_tota <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>prof_cent<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
    prof_cent_tota <span class="token operator">=</span> <span class="token function">smooth</span><span class="token punctuation">(</span>prof_cent_tota<span class="token punctuation">,</span> samp_rate<span class="token operator">/</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'moving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%     powe_cent(~moti_inde,:) = 0;</span>
<span class="token comment" spellcheck="true">%     powe_cent_tota = sum(abs(powe_cent),2)/2;</span>
<span class="token comment" spellcheck="true">%     powe_cent_tota = smooth(powe_cent_tota, samp_rate/8+1, </span><span class="token string">'moving'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    note_list <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>n_note<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tx <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1.6</span><span class="token punctuation">,</span><span class="token number">1.6</span><span class="token punctuation">]</span><span class="token operator">.'</span><span class="token punctuation">;</span>
    rx <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1.6</span><span class="token punctuation">;</span><span class="token number">1.6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">.'</span><span class="token punctuation">;</span>
    init_loc <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.8</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">]</span><span class="token operator">.'</span><span class="token punctuation">;</span>
    tant_valu <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>n_note<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dire_valu <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>n_note<span class="token punctuation">)</span><span class="token punctuation">;</span>
    peak_dist <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> ii <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>n_note<span class="token punctuation">,</span>
        curr_cent <span class="token operator">=</span> <span class="token function">prof_cent</span><span class="token punctuation">(</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        curr_cent_tota <span class="token operator">=</span> <span class="token function">prof_cent_tota</span><span class="token punctuation">(</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         curr_powe_cent = powe_cent(note_segm(ii,1):note_segm(ii,2),:);</span>
<span class="token comment" spellcheck="true">%         curr_powe_cent_tota = powe_cent_tota(note_segm(ii,1):note_segm(ii,2),:);</span>
        curr_cent <span class="token operator">=</span> <span class="token function">curr_cent</span><span class="token punctuation">(</span><span class="token function">moti_inde</span><span class="token punctuation">(</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        curr_cent_tota <span class="token operator">=</span> <span class="token function">curr_cent_tota</span><span class="token punctuation">(</span><span class="token function">moti_inde</span><span class="token punctuation">(</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">note_segm</span><span class="token punctuation">(</span>ii<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        midd_poin <span class="token operator">=</span> <span class="token function">floor</span><span class="token punctuation">(</span><span class="token function">length</span><span class="token punctuation">(</span>curr_cent_tota<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        firs_half <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>midd_poin<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        seco_half <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span>midd_poin<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> kk <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">length</span><span class="token punctuation">(</span>file_path_list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token function">firs_half</span><span class="token punctuation">(</span>kk<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token function">seco_half</span><span class="token punctuation">(</span>kk<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">curr_cent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>midd_poin<span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>midd_poin<span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">curr_cent</span><span class="token punctuation">(</span>midd_poin<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span>midd_poin<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token function">curr_cent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>midd_poin<span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>midd_poin<span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">curr_cent</span><span class="token punctuation">(</span>midd_poin<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span>midd_poin<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">,</span>kk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
        curr_cent <span class="token operator">=</span> curr_cent <span class="token operator">-</span> <span class="token function">repmat</span><span class="token punctuation">(</span><span class="token function">mean</span><span class="token punctuation">(</span>curr_cent<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">size</span><span class="token punctuation">(</span>curr_cent<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        firs_half <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span>midd_poin<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        seco_half <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">curr_cent</span><span class="token punctuation">(</span>midd_poin<span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span><span class="token keyword">end</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         if (mark_list(ii) >= 1 &amp;&amp; mark_list(ii) &lt;= 2) || (mark_list(ii) == 8),</span>
<span class="token comment" spellcheck="true">%             firs_half(2) = firs_half(2);</span>
<span class="token comment" spellcheck="true">%             seco_half(2) = seco_half(2);</span>
<span class="token comment" spellcheck="true">%         elseif (mark_list(ii) >= 4 &amp;&amp; mark_list(ii) &lt;= 6),</span>
<span class="token comment" spellcheck="true">%             firs_half(1) = firs_half(1);</span>
<span class="token comment" spellcheck="true">%             seco_half(1) = seco_half(1);</span>
<span class="token comment" spellcheck="true">%         end</span>
        <span class="token function">tant_valu</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">atan2</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">firs_half</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">seco_half</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">firs_half</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">seco_half</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">pi</span> <span class="token operator">*</span> <span class="token number">180</span><span class="token punctuation">;</span>        
        <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> firs_half <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token function">tant_valu</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">60</span><span class="token punctuation">,</span>
            <span class="token keyword">if</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
        <span class="token keyword">elseif</span> <span class="token function">tant_valu</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">,</span>
            <span class="token keyword">if</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
        <span class="token keyword">else</span>
            <span class="token keyword">if</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
            <span class="token keyword">elseif</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
            <span class="token keyword">elseif</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token keyword">end</span>
        <span class="token keyword">end</span>
        <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         if tant_valu(ii) > 45,</span>
<span class="token comment" spellcheck="true">%             if dire_valu(1,ii) == 1,</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 8;</span>
<span class="token comment" spellcheck="true">%             else</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 4;</span>
<span class="token comment" spellcheck="true">%             end</span>
<span class="token comment" spellcheck="true">%         else</span>
<span class="token comment" spellcheck="true">%             if dire_valu(2,ii) == 1,</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 6;</span>
<span class="token comment" spellcheck="true">%             else</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 2;</span>
<span class="token comment" spellcheck="true">%             end</span>
<span class="token comment" spellcheck="true">%         end</span>

<span class="token comment" spellcheck="true">%             if dire_valu(1,ii) == 1 &amp;&amp; dire_valu(2,ii) == 1,</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 7;</span>
<span class="token comment" spellcheck="true">%             elseif dire_valu(1,ii) == 1 &amp;&amp; dire_valu(2,ii) == 0,</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 1;</span>
<span class="token comment" spellcheck="true">%             elseif dire_valu(1,ii) == 0 &amp;&amp; dire_valu(2,ii) == 1,</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 5;</span>
<span class="token comment" spellcheck="true">%             else</span>
<span class="token comment" spellcheck="true">%                 note_list(ii) = 3;</span>
<span class="token comment" spellcheck="true">%             end</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token string">'index:%d... tant:%f... dire: %d,%d... mark: %d... pred: %d\n'</span><span class="token punctuation">,</span> ii<span class="token punctuation">,</span> <span class="token function">tant_valu</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">dire_valu</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span>ii<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mark_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">note_list</span><span class="token punctuation">(</span>ii<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">%         [peas,locs,wids,pros] = findpeaks(curr_cent_tota, </span><span class="token string">'SortStr'</span><span class="token punctuation">,</span> <span class="token string">'descend'</span><span class="token punctuation">,</span> <span class="token string">'MinPeakDistance'</span><span class="token punctuation">,</span> peak_dist <span class="token operator">*</span> samp_rate<span class="token punctuation">,</span> <span class="token string">'WidthReference'</span><span class="token punctuation">,</span> <span class="token string">'halfheight'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         if length(locs) == 1,</span>
<span class="token comment" spellcheck="true">%             if curr_cent_tota(1) > curr_cent_tota(end),</span>
<span class="token comment" spellcheck="true">%                 locs = [locs; 1];</span>
<span class="token comment" spellcheck="true">%                 peas = [peas; curr_cent_tota(1)];</span>
<span class="token comment" spellcheck="true">%             else</span>
<span class="token comment" spellcheck="true">%                 locs = [locs; length(curr_cent_tota)];</span>
<span class="token comment" spellcheck="true">%                 peas = [peas; curr_cent_tota(end)];</span>
<span class="token comment" spellcheck="true">%             end</span>
<span class="token comment" spellcheck="true">%         elseif length(locs) == 0,</span>
<span class="token comment" spellcheck="true">%             locs = [1; length(curr_cent_tota)];</span>
<span class="token comment" spellcheck="true">%             peas = [curr_cent_tota(1); curr_cent_tota(end)];</span>
<span class="token comment" spellcheck="true">%         end</span>
<span class="token comment" spellcheck="true">%        </span>
<span class="token comment" spellcheck="true">%         subplot(4,1,1);</span>
<span class="token comment" spellcheck="true">%         mesh(time_bins(note_segm(ii,1):note_segm(ii,2)), freq_bins, norm_freq_time_prof(:,note_segm(ii,1):note_segm(ii,2),1));view(0,90)</span>
<span class="token comment" spellcheck="true">%         ylim([-0.04,0.04]);</span>
<span class="token comment" spellcheck="true">%         subplot(4,1,3);</span>
<span class="token comment" spellcheck="true">%         mesh(time_bins(note_segm(ii,1):note_segm(ii,2)), freq_bins, norm_freq_time_prof(:,note_segm(ii,1):note_segm(ii,2),2));view(0,90)</span>
<span class="token comment" spellcheck="true">%         ylim([-0.04,0.04]);</span>
<span class="token comment" spellcheck="true">%         subplot(4,1,2);</span>
<span class="token comment" spellcheck="true">%         plot(time_bins(note_segm(ii,1):note_segm(ii,2)),curr_cent(:,1)); hold on; plot(time_bins(locs(1:2)+note_segm(ii,1)-1), curr_cent(locs(1:2),1), </span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>hold off<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">%         subplot(4,1,4);</span>
<span class="token comment" spellcheck="true">%         plot(time_bins(note_segm(ii,1):note_segm(ii,2)),curr_cent(:,2)); hold on; plot(time_bins(locs(1:2)+note_segm(ii,1)-1), curr_cent(locs(1:2),2), </span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>hold off<span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    all_tant <span class="token operator">=</span> <span class="token punctuation">[</span>all_tant<span class="token punctuation">,</span> tant_valu<span class="token punctuation">]</span><span class="token punctuation">;</span>
    all_mark <span class="token operator">=</span> <span class="token punctuation">[</span>all_mark<span class="token punctuation">,</span> mark_list<span class="token punctuation">]</span><span class="token punctuation">;</span>
    all_dire <span class="token operator">=</span> <span class="token punctuation">[</span>all_dire<span class="token punctuation">,</span> dire_valu<span class="token punctuation">]</span><span class="token punctuation">;</span>
    all_resu <span class="token operator">=</span> <span class="token punctuation">[</span>all_resu<span class="token punctuation">,</span> note_list<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> uu <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">,</span>
        <span class="token function">type_summ</span><span class="token punctuation">(</span>uu<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">type_summ</span><span class="token punctuation">(</span>uu<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">sum</span><span class="token punctuation">(</span>mark_list <span class="token operator">==</span> uu<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> vv <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">,</span>
            <span class="token function">confusion</span><span class="token punctuation">(</span>uu<span class="token punctuation">,</span>vv<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">confusion</span><span class="token punctuation">(</span>uu<span class="token punctuation">,</span>vv<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">sum</span><span class="token punctuation">(</span>mark_list <span class="token operator">==</span> uu <span class="token operator">&amp;</span> note_list <span class="token operator">==</span> vv<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">for</span> uu <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token keyword">for</span> vv <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">,</span>
        <span class="token function">confusion</span><span class="token punctuation">(</span>uu<span class="token punctuation">,</span>vv<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">confusion</span><span class="token punctuation">(</span>uu<span class="token punctuation">,</span>vv<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">type_summ</span><span class="token punctuation">(</span>uu<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span>
accuracy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token function">diag</span><span class="token punctuation">(</span>confusion<span class="token punctuation">)</span><span class="token operator">.'</span> <span class="token operator">.*</span> type_summ<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">sum</span><span class="token punctuation">(</span>type_summ<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">boxplot</span><span class="token punctuation">(</span>all_tant<span class="token punctuation">,</span> all_mark<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">% save(resu_path, </span><span class="token string">'all_tant'</span><span class="token punctuation">,</span> <span class="token string">'all_mark'</span><span class="token punctuation">,</span> <span class="token string">'all_resu'</span><span class="token punctuation">,</span> <span class="token string">'all_dire'</span><span class="token punctuation">,</span> <span class="token string">'accuracy'</span><span class="token punctuation">,</span> <span class="token string">'confusion'</span><span class="token punctuation">,</span> <span class="token string">'type_summ'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>最后，祝我本科毕业快乐，希望今年下半年读研也能一帆风顺。</p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    


    <!-- 使用 DISQUS -->
    <div id="disqus-comment">
        <div id="disqus_thread"></div>
<script>
    queue.offer(function() {
            var disqus_config = function () {
                this.page.url = 'http://xinqiu.me/2018/04/20/widance/index.html';  // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
            };

            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document;
                var s = d.createElement('script');
                s.src = '//xinqiu.disqus.com/embed.js';
                s.setAttribute('data-timestamp', + new Date());
                (d.head || d.body).appendChild(s);
            })();
        });
</script>

    </div>
    <style>
        #disqus-comment{
            background-color: #eee;
            padding: 2pc;
        }
    </style>



                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2018/01/25/csi-data/" id="post_nav-older" class="next-content">
            Older
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/snow_square.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Xin Qiu's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        xinqiu.94@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                Home
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    Archives
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2018/04/">April 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/01/">January 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">May 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">March 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">February 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">January 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">December 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">October 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">August 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">July 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">June 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">May 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">April 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">March 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/02/">February 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">January 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/12/">December 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/11/">November 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/10/">October 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/09/">September 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/08/">August 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/07/">July 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">June 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/05/">May 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/03/">March 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/02/">February 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/12/">December 2014<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
    
        <li>
            <a href="/projects" title="Projects">
                
                    <i class="material-icons sidebar-material-icons">build</i>
                
                Projects
            </a>
        </li>
        
    
        <li>
            <a href="/reading-list" title="Reading">
                
                    <i class="material-icons sidebar-material-icons">book</i>
                
                Reading
            </a>
        </li>
        
    
        <li>
            <a href="/timeline" title="Timeline">
                
                    <i class="material-icons sidebar-material-icons">timeline</i>
                
                Timeline
            </a>
        </li>
        
    
        <li>
            <a href="/tags" title="Tags">
                
                    <i class="material-icons sidebar-material-icons">bookmark border</i>
                
                Tags
            </a>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                Number of articles
                <span class="sidebar-badge">39</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/xinqiu" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;一人Code
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->
<script src="/js/lazyload.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>





    <!-- Leancloud -->
    <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
    <script>
        AV.initialize('wNFmCWTd6GAdUBwK4C35gD2G-gzGzoHsz', 'fkjBgbCuEaEEKpksFNIkGYsk');
    </script>
    <script>
    function showTime(Counter) {
        var query = new AV.Query(Counter);
        $('.leancloud-views_num').each(function() {
            var url = $(this).attr('id').trim();
            query.equalTo('url', url);
            query.find({
                success: function(results) {
                    if (results.length === 0) {
                        var content = '0 ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                        return;
                    }
                    for (var i = 0; i < results.length; i++) {
                        var object = results[i];
                        var content = object.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    }
                },
                error: function(object, error) {
                    console.log('Error: ' + error.code + ' ' + error.message);
                }
            });
        });
    }

    function addCount(Counter) {
      var Counter = AV.Object.extend('Counter');
      url = $('.leancloud-views_num').attr('id').trim();
      title = $('.leancloud-views_num').attr('data-flag-title').trim();
      var query = new AV.Query(Counter);
      query.equalTo('url', url);
      query.find({
          success: function(results) {
            if (results.length > 0) {
                var counter = results[0];
                counter.fetchWhenSave(true);
                counter.increment('time');
                counter.save(null, {
                    success: function(counter) {
                        var content =  counter.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    },
                    error: function(counter, error) {
                        console.log('Failed to save Visitor num, with error message: ' + error.message);
                    }
                });
            } else {
              var newcounter = new Counter();
              newcounter.set('title', title);
              newcounter.set('url', url);
              newcounter.set('time', 1);
              newcounter.save(null, {
                  success: function(newcounter) {
                      console.log('newcounter.get(\'time\')='+newcounter.get('time'));
                      var content = newcounter.get('time') + ' ' + $(document.getElementById(url)).text();
                      $(document.getElementById(url)).text(content);
                  },
                  error: function(newcounter, error) {
                      console.log('Failed to create');
                  }
              });
            }
        },
        error: function(error) {
            console.log('Error:' + error.code + ' ' + error.message);
        }
      });
    }
    $(function() {
        var Counter = AV.Object.extend('Counter');
        if ($('.leancloud-views_num').length === 1) {
            addCount(Counter);
        } else if ($('.post-title-link').length > 1) {
            showTime(Counter);
        }
    });
</script>








    <!-- 使用 DISQUS js 代码 -->
    <script id="dsq-count-scr" src="//xinqiu.disqus.com/count.js" async></script>



<!-- Swiftye -->


<!-- Local Search-->

    <script>
    var searchFunc = function(path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: 'xml',
            success: function( xmlResponse ) {
                // get the contents from search data
                var datas = $( 'entry', xmlResponse ).map(function() {
                    return {
                        title: $( 'title', this ).text(),
                        content: $('content',this).text(),
                        url: $( 'url' , this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function() {
                    var str='<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = '';
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function(data) {
                        var isMatch = true;
                        var content_index = [];
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g,'').toLowerCase();
                        var data_url = data.url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if(data_title !== '' && data_content !== '') {
                            keywords.forEach(function(keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if( index_title < 0 && index_content < 0 ) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += '<li><a href="'+ data_url +'" class="search-result-title" target="_blank">'+ data_title;
                            var content = data.content.trim().replace(/<[^>]+>/g, '');
                            if (first_occur >= 0) {
                                // cut out characters
                                var start = first_occur - 6;
                                var end = first_occur + 6;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 10;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, 'gi');
                                    match_content = match_content.replace(regS, '<em class="search-keyword">'+keyword+'</em>');
                                })
                                str += '<p class="search-result">' + match_content + '...</p>' +'</a>';
                            }
                        }
                    });
                    $resultContent.innerHTML = str;
                });
            }
        });
    }
</script>


    <script>
        var inputArea = document.querySelector('#search');
        var getSearchFile = function() {
            var path = 'search.xml';
            searchFunc(path, 'search', 'local-search-result');
        }

        if(inputArea) {
            inputArea.onfocus = function() {
                getSearchFile();
            }
        }
    </script>


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->


                </main>
            </div>
        </body>
    
</html>
