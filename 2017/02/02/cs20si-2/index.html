<!DOCTYPE html>
<html lang="en">
    <head>
    <!-- 
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.0 -->

    <!-- Title -->
    
    <title>
        
            Tensorflow for Deep Learning 2 | 
        
        一人Code
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Meta & Info -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Xin Qiu">
    <meta name="description" content="写给自己的Blog">
    <meta name="keywords" content="一人Code|写给自己的Blog,deep-learning">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="一人Code">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://xinqiu.me">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Tensorflow for Deep Learning 2 | 一人Code">
    <meta property="og:description" content="写给自己的Blog">
    <meta property="og:article:tag" content="deep-learning"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }
</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>



    <script src="/js/jquery.min.js"></script>
    <script src="/js/queue.js"></script>

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    
    <!-- Google Analytics -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-57881840-1', 'auto');ga('send', 'pageview');
    </script>
    

    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
        
            <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-57881840-1', 'auto'); ga('send', 'pageview'); </script>
        
    
<link rel="stylesheet" href="/css/prism-coy.css" type="text/css"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u4F7F_u7528_TensorBoard"><span class="post-toc-number">1.</span> <span class="post-toc-text">使用 TensorBoard</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u5E38_u91CF"><span class="post-toc-number">2.</span> <span class="post-toc-text">常量</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u6570_u5B66_u8FD0_u7B97"><span class="post-toc-number">3.</span> <span class="post-toc-text">数学运算</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u6570_u636E_u7C7B_u578B"><span class="post-toc-number">4.</span> <span class="post-toc-text">数据类型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Python__u539F_u751F_u7C7B_u578B"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">Python 原生类型</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#TensorFlow__u539F_u751F_u7C7B_u578B"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">TensorFlow 原生类型</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#NumPy__u6570_u636E_u7C7B_u578B"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">NumPy 数据类型</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u53D8_u91CF"><span class="post-toc-number">5.</span> <span class="post-toc-text">变量</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#u58F0_u660E_u53D8_u91CF"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">声明变量</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#u6C42_u53D8_u91CF_u7684_u503C"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">求变量的值</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#u8D4B_u503C"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">赋值</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#InteractiveSession_28_u4EA4_u4E92_u5F0F_u4F1A_u8BDD_29"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">InteractiveSession(交互式会话)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Control_Dependencies"><span class="post-toc-number">5.5.</span> <span class="post-toc-text">Control Dependencies</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Placeholders_28_u5360_u4F4D_u7B26_29__u548C_feed_dict"><span class="post-toc-number">5.6.</span> <span class="post-toc-text">Placeholders(占位符) 和 feed_dict</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#u61D2_u52A0_u8F7D"><span class="post-toc-number">5.7.</span> <span class="post-toc-text">懒加载</span></a></li></ol></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        <!-- Custom Thumbnail -->
        <div class="post_thumbnail-custom mdl-card__media mdl-color-text--grey-50" style="background-image:url(img/tf.jpg)">
    
            <p class="article-headline-p">
                Tensorflow for Deep Learning 2
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Xin Qiu</strong>
        <span>Feb 02, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
            <i class="material-icons" role="presentation">devices other</i>
            <span class="visuallyhidden">devices other</span>
        </button>
        <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
            <li class="mdl-menu__item">Read this article on other device</li>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACZklEQVR42u3ay27CMBQEUP7/p9ttJUSY8YsUnawQcYlPFr7u+D5+vvp64OHh4eHh4eHh3Yz3iK+/41/97asxz+Pzu/nc8PDw8E7y3iy1l5NYNf4anzwLDw8P7zwvf0xeKvKC0f4yHh4e3n/hXVPfLNnxSDw8PLxv4iXgfORMycHDw8O7Ay//hz+HvYlc41dzKGvBw8PDi3kzB2C7P3/4fA8PDw/viVe3NL1Y3K+/v55QXgaiGeLh4eFt5rVtT8mRf3v3+pu2KQEPDw9vNy9Z4pNI4noLnsS+0dTbGBcPDw9vAy8hjTWb5kdl+QsarHt4eHh423hjG9wWlh9rtZtsPDw8vE/xFizNExvoNhCJYlw8PDy8pbz8CGpqsS6PzfIXgYeHh3ee1y7KLWxVwLG47uHh4eEt4o0t7u3xVR5ntEdoeHh4eCd5+cZ3vjDkL3csksDDw8M7w2tbVNutcF4YZiJjPDw8vDO8tZMei3dnwtwopcbDw8Pbxls1uWRCa6MKPDw8vPvwZrbIM40FbfsCHh4e3kleC1hbNlYVDzw8PLyTvGTZrQ/vp2Fjh2R4eHh4J3ljBaC9O7ONzu/i4eHh7eblAUTenNqGGvnTo2YCPDw8vM289mobTNsott2IRyk1Hh4e3lLe2HKclIc2Js6fhYeHh3cHXh4HjMUNeftU3sJVhxF4eHh4G3jzDQTzsJnihIeHh3dPXhutzmyjB2MRPDw8vBvzrmOCPK5t26resPHw8PAO8tq2p+I4fygOzn8ZDw8P7zxvptUpjxuSJ+ab6aIw4OHh4S3lfd+Fh4eHh4eHh4d3g+sXc43jX4HURI8AAAAASUVORK5CYII=">
        </ul>
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/deep-learning/">deep-learning</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    <!-- Leancloud Views -->
        <a class="post_share-link" href="#">
            <li class="mdl-menu__item">
                <span id="/2017/02/02/cs20si-2/" class="leancloud-views_num" data-flag-title="Tensorflow for Deep Learning 2">
     &nbsp;Views
</span>

            </li>
        </a>
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Tensorflow for Deep Learning 2&url=http://xinqiu.me//2017/02/02/cs20si-2/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                Share to Weibo
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Tensorflow for Deep Learning 2&url=http://xinqiu.me//2017/02/02/cs20si-2/index.html&via=Xin Qiu" target="_blank">
            <li class="mdl-menu__item">
                Share to Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://xinqiu.me//2017/02/02/cs20si-2/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://xinqiu.me//2017/02/02/cs20si-2/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <blockquote>
<p>笔记2: TensorFlow Ops</p>
</blockquote>
<h3 id="u4F7F_u7528_TensorBoard"><a href="#u4F7F_u7528_TensorBoard" class="headerlink" title="使用 TensorBoard"></a>使用 TensorBoard</h3><p>TensorFlow 中将常量(constants),变量(variables),运算符(operators)合称为操作(ops)。TensorFlow 是由TensorFlow, TensorBoard, TensorServing 构成。首先介绍 TensorBoard。</p>
<p>TensorBoard 是图可视化软件。</p>
<p><img src="https://www.tensorflow.org/versions/master/images/mnist_tensorboard.png" alt=""></p>
<p>当用户运行开启 TensorBoard 的 TensorFlow 程序，所有操作会输出到一个事件文件。TensorBoard 能将这些文件转为图，使模型更直观。</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
a <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> tf<span class="token punctuation">.</span>add<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    <span class="token keyword">print</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
</code></pre>
<p>开启 TensorBoard 只需要在运行程序的代码前添加 </p>
<p><code>writer = tf.summary.FileWriter(logs_dir,sess.graph)</code></p>
<p>其中 logs_dir 是事件文件的存放位置，比如’./graphs’。</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
a <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> tf<span class="token punctuation">.</span>add<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    writer <span class="token operator">=</span> tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>FileWriter<span class="token punctuation">(</span><span class="token string">'./graphs'</span><span class="token punctuation">,</span> sess<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>
    <span class="token keyword">print</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># close the writer when you’re done using it</span>
writer<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>在执行完上述代码以后，使用 <code>tensorboard --logdir=&quot;./graphs&quot;</code>，之后打开浏览器访问 h  ttp://localhost:6006/ 就能看到以下页面。 建议使用 Chrome 访问。</p>
<p><img src="1.png" alt=""></p>
<p>点击导航上的 Graphs 可以看到</p>
<center><img src="2.png" alt=""></center>

<p>“Const” 和 “Const_1” 对应代码中的 a 和 b， “Add” 对应 x。这样很不直观，所以为了让 TensorBoard 显示 操作(ops) 的名字，可以准确定义每个变量。</p>
<pre class=" language-python"><code class="language-python">a <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"a"</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"b"</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> tf<span class="token punctuation">.</span>add<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"add"</span><span class="token punctuation">)</span>
</code></pre>
<p>这时候 TensorBoard 中的图就是这样：</p>
<center><img src="3.png" alt=""></center>

<p>图本身只定义了操作和操作来源，但不显示值。只有在运行session时才会去获取值。</p>
<p><code>tf.Session.run(fetches, feed_dict=None, options=None, run_metadata=None)</code></p>
<h3 id="u5E38_u91CF"><a href="#u5E38_u91CF" class="headerlink" title="常量"></a>常量</h3><p>创建标量或者张量(tensor)类型的常量。</p>
<pre class=" language-python"><code class="language-python">tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span>value<span class="token punctuation">,</span> dtype<span class="token operator">=</span>None<span class="token punctuation">,</span> shape<span class="token operator">=</span>None<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'Const'</span><span class="token punctuation">,</span> verify_shape<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># constant of 1d tensor (vector)</span>
a <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"vector"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># constant of 2x2 tensor (matrix)</span>
b <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"b"</span><span class="token punctuation">)</span>
</code></pre>
<p>创建由特定值构成的张量。</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># create a tensor of shape and all elements are zeros</span>
tf<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>shape<span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> name<span class="token operator">=</span>None<span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>int32<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">></span>  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># create a tensor of shape and type (unless type is specified) as the input_tensor but all elements are zeros.</span>
tf<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>input_tensor<span class="token punctuation">,</span> dtype<span class="token operator">=</span>None<span class="token punctuation">,</span> name<span class="token operator">=</span>None<span class="token punctuation">,</span> optimize<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># input_tensor is [0, 1], [2, 3], [4, 5]]</span>
tf<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>input_tensor<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># create a tensor of shape and all elements are ones</span>
tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>shape<span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> name<span class="token operator">=</span>None<span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>int32<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">></span>  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># create a tensor of shape and type (unless type is specified) as the input_tensor but all elements are ones.</span>
tf<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>input_tensor<span class="token punctuation">,</span> dtype<span class="token operator">=</span>None<span class="token punctuation">,</span> name<span class="token operator">=</span>None<span class="token punctuation">,</span> optimize<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># input_tensor is [0, 1], [2, 3], [4, 5]]</span>
tf<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>input_tensor<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># create a tensor filled with a scalar value.</span>
tf<span class="token punctuation">.</span>fill<span class="token punctuation">(</span>dims<span class="token punctuation">,</span> value<span class="token punctuation">,</span> name<span class="token operator">=</span>None<span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre>
<p>创建常数序列</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># create a sequence of  num evenlyspaced values are generated beginning at  start. If num > 1, the values in the sequence increase by stop - start / num - 1, so that the last one is exactly  stop.</span>
<span class="token comment" spellcheck="true"># start, stop, num must be scalars</span>
<span class="token comment" spellcheck="true"># comparable to but slightly different from numpy.linspace</span>
<span class="token comment" spellcheck="true"># numpy.linspace(start, stop, num=50, endpoint=True, retstep=False, dtype=None)</span>
tf<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>start<span class="token punctuation">,</span> stop<span class="token punctuation">,</span> num<span class="token punctuation">,</span> name<span class="token operator">=</span>None<span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">13.0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"linspace"</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">></span> <span class="token punctuation">[</span> <span class="token number">10</span><span class="token punctuation">.</span>  <span class="token number">11</span><span class="token punctuation">.</span>  <span class="token number">12</span><span class="token punctuation">.</span>  <span class="token number">13</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># create a sequence of numbers that begins at start and extends by increments of delta up to but not including limit</span>
<span class="token comment" spellcheck="true"># slight different from range in Python</span>
tf<span class="token punctuation">.</span>range<span class="token punctuation">(</span>start<span class="token punctuation">,</span> limit<span class="token operator">=</span>None<span class="token punctuation">,</span> delta<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>None<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'range'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 'start' is 3, 'limit' is 18, 'delta' is 3</span>

tf<span class="token punctuation">.</span>range<span class="token punctuation">(</span>start<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> delta<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">></span> <span class="token punctuation">[</span> <span class="token number">3</span>  <span class="token number">6</span>  <span class="token number">9</span> <span class="token number">12</span> <span class="token number">15</span><span class="token punctuation">]</span>

<span class="token comment" spellcheck="true"># 'start' is 3, 'limit' is 1, 'delta' is -0.5</span>

tf<span class="token punctuation">.</span>range<span class="token punctuation">(</span>start<span class="token punctuation">,</span> limit<span class="token punctuation">,</span> delta<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">></span> <span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">.</span>   <span class="token number">2.5</span>  <span class="token number">2</span><span class="token punctuation">.</span>   <span class="token number">1.5</span><span class="token punctuation">]</span>



<span class="token comment" spellcheck="true"># 'limit' is 5</span>
tf<span class="token punctuation">.</span>range<span class="token punctuation">(</span>limit<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span><span class="token punctuation">]</span>
</code></pre>
<p>值得注意的是，不像NumPy，TensorFlow的序列是不可迭代的</p>
<p>tf也提供了生成确定分布的随机常量的函数。</p>
<pre class=" language-python"><code class="language-python">tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token punctuation">,</span> mean<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> stddev<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>dtypes<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> seed<span class="token operator">=</span>None<span class="token punctuation">,</span> name<span class="token operator">=</span>None<span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>truncated_normal<span class="token punctuation">(</span>shape<span class="token punctuation">,</span> mean<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> stddev<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>dtypes<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> seed<span class="token operator">=</span>None<span class="token punctuation">,</span> name<span class="token operator">=</span>None<span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>random_uniform<span class="token punctuation">(</span>shape<span class="token punctuation">,</span> minval<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> maxval<span class="token operator">=</span>None<span class="token punctuation">,</span> dtype<span class="token operator">=</span>dtypes<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> seed<span class="token operator">=</span>None<span class="token punctuation">,</span> name<span class="token operator">=</span>None<span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>random_shuffle<span class="token punctuation">(</span>value<span class="token punctuation">,</span> seed<span class="token operator">=</span>None<span class="token punctuation">,</span> name<span class="token operator">=</span>None<span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>random_crop<span class="token punctuation">(</span>value<span class="token punctuation">,</span> size<span class="token punctuation">,</span>seed<span class="token operator">=</span>None<span class="token punctuation">,</span> name<span class="token operator">=</span>None<span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>multinomial<span class="token punctuation">(</span>logits<span class="token punctuation">,</span> num_samples<span class="token punctuation">,</span> seed<span class="token operator">=</span>None<span class="token punctuation">,</span> name<span class="token operator">=</span>None<span class="token punctuation">)</span>

tf<span class="token punctuation">.</span>random_gamma<span class="token punctuation">(</span>shape<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> beta<span class="token operator">=</span>None<span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> seed<span class="token operator">=</span>None<span class="token punctuation">,</span> name<span class="token operator">=</span>None<span class="token punctuation">)</span>
</code></pre>
<h3 id="u6570_u5B66_u8FD0_u7B97"><a href="#u6570_u5B66_u8FD0_u7B97" class="headerlink" title="数学运算"></a>数学运算</h3><p>TensorFlow 的数学运算和 NumPy 非常类似。直接看 <a href="https://www.tensorflow.org/api_docs/python/math_ops/" target="_blank" rel="external">Math API</a> 吧。</p>
<h3 id="u6570_u636E_u7C7B_u578B"><a href="#u6570_u636E_u7C7B_u578B" class="headerlink" title="数据类型"></a>数据类型</h3><h4 id="Python__u539F_u751F_u7C7B_u578B"><a href="#Python__u539F_u751F_u7C7B_u578B" class="headerlink" title="Python 原生类型"></a>Python 原生类型</h4><p>看下面的例子就能懂了。</p>
<pre class=" language-python"><code class="language-python">t_0 <span class="token operator">=</span> <span class="token number">19</span>  <span class="token comment" spellcheck="true"># Treated as a 0-d tensor, or "scalar" </span>
tf<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>t_0<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ==> 0</span>
tf<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>t_0<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ==> 1</span>

t_1 <span class="token operator">=</span> <span class="token punctuation">[</span>b<span class="token string">"apple"</span><span class="token punctuation">,</span> b<span class="token string">"peach"</span><span class="token punctuation">,</span> b<span class="token string">"grape"</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># treated as a 1-d tensor, or "vector" </span>
tf<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>t_1<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ==> ['' '' '']</span>
tf<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>t_1<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ==> TypeError: Expected string, got 1 of type 'int' instead.</span>

t_2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true"># treated as a 2-d tensor, or "matrix"</span>
tf<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>t_2<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ==> 2x2 tensor, all elements are False</span>
tf<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>t_2<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ==> 2x2 tensor, all elements are True</span>
</code></pre>
<h4 id="TensorFlow__u539F_u751F_u7C7B_u578B"><a href="#TensorFlow__u539F_u751F_u7C7B_u578B" class="headerlink" title="TensorFlow 原生类型"></a>TensorFlow 原生类型</h4><p>TensorFlow 有自己的数据类型，比如tf.int32, tf.float32。更多详情<a href="https://www.tensorflow.org/versions/r0.11/resources/dims_types#data_types" target="_blank" rel="external">Data types</a></p>
<h4 id="NumPy__u6570_u636E_u7C7B_u578B"><a href="#NumPy__u6570_u636E_u7C7B_u578B" class="headerlink" title="NumPy 数据类型"></a>NumPy 数据类型</h4><p>TensorFlow 被设计成与 Numpy 兼容，所以 TensorFlow 的数据类型是基于 NumPy 的，甚至 np.int32 == tf.int32 返回 True。所以可以</p>
<pre class=" language-python"><code class="language-python">tf<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1.0</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1.0</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre>
<p>长话短说，TensorFlow 类型和 NumPy 类型可以互相转换，但 TensorFlow 优点更多。</p>
<h3 id="u53D8_u91CF"><a href="#u53D8_u91CF" class="headerlink" title="变量"></a>变量</h3><p>变量被赋值以后还是可以改变，与值储存在 图 中的常量不同，变量是分开的，可能存在参数服务器上。</p>
<p>关于 图 的定义和 图 所包含的内容可以靠打印 图 的 protobuf(Protocol Buffers，是Google公司开发的一种数据描述语言)。</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf

my_const <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"my_const"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> tf<span class="token punctuation">.</span>get_default_graph<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>as_graph_def<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>输出就 protobuf。</p>
<h4 id="u58F0_u660E_u53D8_u91CF"><a href="#u58F0_u660E_u53D8_u91CF" class="headerlink" title="声明变量"></a>声明变量</h4><p>声明变量需要通过实例化 tf.Variable。</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># create variable a with scalar value</span>
a <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"scalar"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># create variable b as a vector</span>
b <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"vector"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># create variable c as a 2x2 matrix</span>
c <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"matrix"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># create variable W as 784 x 10 tensor, filled with zeros</span>
W <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">784</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>tf.Variable 支持以下几个操作:</p>
<pre class=" language-python"><code class="language-python">x <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
x<span class="token punctuation">.</span>initializer <span class="token comment" spellcheck="true"># init </span>
x<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># read op </span>
x<span class="token punctuation">.</span>assign<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># write op </span>
x<span class="token punctuation">.</span>assign_add<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># and more</span>
</code></pre>
<p><strong>在使用变量之前必须初始化</strong>。使用 tf.global_variables_initializer() 可以非常简单的初始化所有变量。</p>
<pre class=" language-python"><code class="language-python">init <span class="token operator">=</span> tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>init<span class="token punctuation">)</span>
</code></pre>
<p>也可以使用 tf.Variable.initializer 初始化每个变量。</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># create variable W as 784 x 10 tensor, filled with zeros</span>
W <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">784</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    tf<span class="token punctuation">.</span>run<span class="token punctuation">(</span>W<span class="token punctuation">.</span>initializer<span class="token punctuation">)</span>
</code></pre>
<h4 id="u6C42_u53D8_u91CF_u7684_u503C"><a href="#u6C42_u53D8_u91CF_u7684_u503C" class="headerlink" title="求变量的值"></a>求变量的值</h4><p>如果仅打印初始化的变量，得到的是 tensor 对象。</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># W is a random 700 x 100 variable object</span>
W <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>truncated_normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">700</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>W<span class="token punctuation">.</span>initializer<span class="token punctuation">)</span>
    <span class="token keyword">print</span> W
</code></pre>
<p>为了得到变量的值，需要用求值函数eval()。</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># W is a random 700 x 100 variable object</span>
W <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>truncated_normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">700</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>W<span class="token punctuation">.</span>initializer<span class="token punctuation">)</span>
    <span class="token keyword">print</span> W<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="u8D4B_u503C"><a href="#u8D4B_u503C" class="headerlink" title="赋值"></a>赋值</h4><p>使用 tf.Variable.assign() 来给变量分配值。</p>
<pre class=" language-python"><code class="language-python">W <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
W<span class="token punctuation">.</span>assign<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>W<span class="token punctuation">.</span>initializer<span class="token punctuation">)</span>
    <span class="token keyword">print</span> W<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>然而上面代码的结果还是10，为什么呢？</p>
<p>因为上面的 assign 只是一个操作，并没有去执行。需要在 session 里运行这个操作才能让其有作用。</p>
<pre class=" language-python"><code class="language-python">W <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
assign_op <span class="token operator">=</span> W<span class="token punctuation">.</span>assign<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>assign_op<span class="token punctuation">)</span>
    <span class="token keyword">print</span> W<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>这里没进行初始化，是因为 assgin 替我们完成了初始化的操作。其实初始化操作也是一种赋值操作。</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># create a variable whose original value is 2</span>
a <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"scalar"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># assign a * 2 to a and call that op a_times_two</span>
a_times_two <span class="token operator">=</span> a<span class="token punctuation">.</span>assign<span class="token punctuation">(</span>a <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
init <span class="token operator">=</span> tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>init<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># have to initialize a, because a_times_two op depends on the value of a</span>
    <span class="token keyword">print</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>a_times_two<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># >> 4</span>
    <span class="token keyword">print</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>a_times_two<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># >> 8</span>
    <span class="token keyword">print</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>a_times_two<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># >> 16</span>
</code></pre>
<p>TensorFlow 每次 a_times_two 都会将 a 乘 2。</p>
<p>对于简单的加减，TensorFlow 提供了 tf.Variable.assign_add() 和 tf.Variable.assign_sub() 方法。要注意的是，这两个方法不会初始化变量。</p>
<pre class=" language-python"><code class="language-python">W <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>W<span class="token punctuation">.</span>initializer<span class="token punctuation">)</span>
    <span class="token keyword">print</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>W<span class="token punctuation">.</span>assign_add<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>W<span class="token punctuation">.</span>assign_sub<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>TensorFlow 的每个 session 维护各自的值。</p>
<p>当然 变量 可以基于其他 变量 。 比如声明 U = W * 2。</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># W is a random 700 x 100 tensor</span>
W <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>truncated_normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">700</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
U <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>W <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre>
<p>当然这里最好确保W要先初始化。</p>
<pre class=" language-python"><code class="language-python">U <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>W<span class="token punctuation">.</span>initial_value<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="InteractiveSession_28_u4EA4_u4E92_u5F0F_u4F1A_u8BDD_29"><a href="#InteractiveSession_28_u4EA4_u4E92_u5F0F_u4F1A_u8BDD_29" class="headerlink" title="InteractiveSession(交互式会话)"></a>InteractiveSession(交互式会话)</h4><p>InteractiveSession 与 Session 不同的地方在于前者会将其本身作为默认的会话，所以之后调用 run() 或 eval() 可以不用指明会话。虽然很方便，但如果有多个会话就很麻烦。</p>
<pre class=" language-python"><code class="language-python">sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>InteractiveSession<span class="token punctuation">(</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">6.0</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> a <span class="token operator">*</span> b
<span class="token comment" spellcheck="true"># We can just use 'c.eval()' without passing 'sess'</span>
<span class="token keyword">print</span> c<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span>
sess<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>tf.get_default_session() 返回当前线程的默认会话。</p>
<h4 id="Control_Dependencies"><a href="#Control_Dependencies" class="headerlink" title="Control Dependencies"></a>Control Dependencies</h4><p>如果有两个独立操作，想指明哪个操作先执行，可以使用 tf.Graph.control_dependencies(control_inputs)</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># your graph g have 5 ops: a, b, c, d, e </span>
<span class="token keyword">with</span> g<span class="token punctuation">.</span>control_dependencies<span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># `d` and `e` will only run after `a`, `b`, and `c` have executed. </span>
    d <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    e <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre>
<h4 id="Placeholders_28_u5360_u4F4D_u7B26_29__u548C_feed_dict"><a href="#Placeholders_28_u5360_u4F4D_u7B26_29__u548C_feed_dict" class="headerlink" title="Placeholders(占位符) 和 feed_dict"></a>Placeholders(占位符) 和 feed_dict</h4><p>TensorFlow 程序通常有两个时期：</p>
<ol>
<li>构造一个 图</li>
<li>在 图 里使用 会话 执行 操作</li>
</ol>
<p>所以在构造 图 的时候，可以不需要知道计算的具体值，类似于定义一个函数。比如 f(x, y) = x*2 + y，x,y 就是 Placeholders(占位符) 。</p>
<p>定义占位符</p>
<pre class=" language-python"><code class="language-python">tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>dtype<span class="token punctuation">,</span> shape<span class="token operator">=</span>None<span class="token punctuation">,</span> name<span class="token operator">=</span>None<span class="token punctuation">)</span>
</code></pre>
<p>Dtype 是必须的参数指明了占位符的数据类型。</p>
<p>Shape 规定了占位符能接受的张量的维度。shape=None 表示任何维度都可以接受。坏处就是不好debug。</p>
<p>只定义了占位符还没用，需要通过获取值来进行计算。placeholder 获取的值通过一个字典。</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># create a placeholder of type float 32-bit, shape is a vector of 3 elements</span>
a <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># create a constant of type float 32-bit, shape is a vector of 3 elements</span>
b <span class="token operator">=</span> tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># use the placeholder as you would a constant or a variable</span>
c <span class="token operator">=</span> a <span class="token operator">+</span> b  <span class="token comment" spellcheck="true"># Short for tf.add(a, b)</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
      <span class="token comment" spellcheck="true"># feed [1, 2, 3] to placeholder a via the dict {a: [1, 2, 3]}</span>
      <span class="token comment" spellcheck="true"># fetch value of c</span>
      <span class="token keyword">print</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># the tensor a is the key, not the string ‘a’</span>
</code></pre>
<p>获取值不仅仅是占位符可以，任何可获取值的张量都可以。使用一下方法可以确定张量是否可获取值:</p>
<pre class=" language-python"><code class="language-python">tf<span class="token punctuation">.</span>Graph<span class="token punctuation">.</span>is_feedable<span class="token punctuation">(</span>tensor<span class="token punctuation">)</span>
</code></pre>
<p>比如</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># create Operations, Tensors, etc (using the default graph)</span>
a <span class="token operator">=</span> tf<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> tf<span class="token punctuation">.</span>mul<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># start up a `Session` using the default graph</span>
sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># define a dictionary that says to replace the value of `a` with 15</span>
replace_dict <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">}</span>
<span class="token comment" spellcheck="true"># Run the session, passing in `replace_dict` as the value to `feed_dict`</span>
sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>b<span class="token punctuation">,</span> feed_dict<span class="token operator">=</span>replace_dict<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># returns 45</span>
</code></pre>
<h4 id="u61D2_u52A0_u8F7D"><a href="#u61D2_u52A0_u8F7D" class="headerlink" title="懒加载"></a>懒加载</h4><p>懒加载是一种编程模式，表示直到加载的时候才声明或者初始化。在 TensorFlow 中，表示直到进行计算的时候才创建这个操作。</p>
<p>比如正常情况下，</p>
<pre class=" language-python"><code class="language-python">x <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">)</span>
z <span class="token operator">=</span> tf<span class="token punctuation">.</span>add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    writer <span class="token operator">=</span> tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>FileWriter<span class="token punctuation">(</span><span class="token string">'./my_graph/l2'</span><span class="token punctuation">,</span> sess<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>z<span class="token punctuation">)</span>
        writer<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>而懒加载的代码</p>
<pre class=" language-python"><code class="language-python">x <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'x'</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
     sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     writer <span class="token operator">=</span> tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>FileWriter<span class="token punctuation">(</span><span class="token string">'./my_graph/l2'</span><span class="token punctuation">,</span> sess<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>
     <span class="token keyword">for</span> _ <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
           sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># someone decides to be clever to save one line of code</span>
     writer<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>通过查看 TensorBoard ，可以发现不同之处。</p>
<p>当然，也可以通过查看 图 定义，使用</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">print</span> tf<span class="token punctuation">.</span>get_default_graph<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>as_graph_def<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>发现后者，也就是懒加载中，节点 里多了9个 Add 操作的拷贝。明明同样的操作，却会造成很大的开销。为了避免这个情况，尽量分开定义操作和执行。另一种就是使用 Python property装饰器。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               </p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    


    <!-- 使用 DISQUS -->
    <div id="disqus-comment">
        <div id="disqus_thread"></div>
<script>
    queue.offer(function() {
            var disqus_config = function () {
                this.page.url = 'http://xinqiu.me/2017/02/02/cs20si-2/index.html';  // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
            };

            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document;
                var s = d.createElement('script');
                s.src = '//xinqiu.disqus.com/embed.js';
                s.setAttribute('data-timestamp', + new Date());
                (d.head || d.body).appendChild(s);
            })();
        });
</script>

    </div>
    <style>
        #disqus-comment{
            background-color: #eee;
            padding: 2pc;
        }
    </style>



                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2017/02/10/CS231n-1/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            Newer
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/01/20/cs20si-1/" id="post_nav-older" class="next-content">
            Older
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/snow_square.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Xin Qiu's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        xinqiu.94@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                Home
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    Archives
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/03/">March 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">February 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">January 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">December 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">October 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">August 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">July 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">June 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">May 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">April 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">March 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/02/">February 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">January 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/12/">December 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/11/">November 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/10/">October 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/09/">September 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/08/">August 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/07/">July 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">June 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/05/">May 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/03/">March 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/02/">February 2015<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/01/">January 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/12/">December 2014<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
    
        <li>
            <a href="/projects" title="Projects">
                
                    <i class="material-icons sidebar-material-icons">build</i>
                
                Projects
            </a>
        </li>
        
    
        <li>
            <a href="/reading-list" title="Reading">
                
                    <i class="material-icons sidebar-material-icons">book</i>
                
                Reading
            </a>
        </li>
        
    
        <li>
            <a href="/timeline" title="Timeline">
                
                    <i class="material-icons sidebar-material-icons">timeline</i>
                
                Timeline
            </a>
        </li>
        
    
        <li>
            <a href="/tags" title="Tags">
                
                    <i class="material-icons sidebar-material-icons">bookmark border</i>
                
                Tags
            </a>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                Number of articles
                <span class="sidebar-badge">44</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/xinqiu" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;一人Code
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->
<script src="/js/lazyload.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>





    <!-- Leancloud -->
    <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
    <script>
        AV.initialize('wNFmCWTd6GAdUBwK4C35gD2G-gzGzoHsz', 'fkjBgbCuEaEEKpksFNIkGYsk');
    </script>
    <script>
    function showTime(Counter) {
        var query = new AV.Query(Counter);
        $('.leancloud-views_num').each(function() {
            var url = $(this).attr('id').trim();
            query.equalTo('url', url);
            query.find({
                success: function(results) {
                    if (results.length === 0) {
                        var content = '0 ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                        return;
                    }
                    for (var i = 0; i < results.length; i++) {
                        var object = results[i];
                        var content = object.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    }
                },
                error: function(object, error) {
                    console.log('Error: ' + error.code + ' ' + error.message);
                }
            });
        });
    }

    function addCount(Counter) {
      var Counter = AV.Object.extend('Counter');
      url = $('.leancloud-views_num').attr('id').trim();
      title = $('.leancloud-views_num').attr('data-flag-title').trim();
      var query = new AV.Query(Counter);
      query.equalTo('url', url);
      query.find({
          success: function(results) {
            if (results.length > 0) {
                var counter = results[0];
                counter.fetchWhenSave(true);
                counter.increment('time');
                counter.save(null, {
                    success: function(counter) {
                        var content =  counter.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    },
                    error: function(counter, error) {
                        console.log('Failed to save Visitor num, with error message: ' + error.message);
                    }
                });
            } else {
              var newcounter = new Counter();
              newcounter.set('title', title);
              newcounter.set('url', url);
              newcounter.set('time', 1);
              newcounter.save(null, {
                  success: function(newcounter) {
                      console.log('newcounter.get(\'time\')='+newcounter.get('time'));
                      var content = newcounter.get('time') + ' ' + $(document.getElementById(url)).text();
                      $(document.getElementById(url)).text(content);
                  },
                  error: function(newcounter, error) {
                      console.log('Failed to create');
                  }
              });
            }
        },
        error: function(error) {
            console.log('Error:' + error.code + ' ' + error.message);
        }
      });
    }
    $(function() {
        var Counter = AV.Object.extend('Counter');
        if ($('.leancloud-views_num').length === 1) {
            addCount(Counter);
        } else if ($('.post-title-link').length > 1) {
            showTime(Counter);
        }
    });
</script>








    <!-- 使用 DISQUS js 代码 -->
    <script id="dsq-count-scr" src="//xinqiu.disqus.com/count.js" async></script>



<!-- Swiftye -->


<!-- Local Search-->

    <script>
    var searchFunc = function(path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: 'xml',
            success: function( xmlResponse ) {
                // get the contents from search data
                var datas = $( 'entry', xmlResponse ).map(function() {
                    return {
                        title: $( 'title', this ).text(),
                        content: $('content',this).text(),
                        url: $( 'url' , this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function() {
                    var str='<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = '';
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function(data) {
                        var isMatch = true;
                        var content_index = [];
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g,'').toLowerCase();
                        var data_url = data.url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if(data_title !== '' && data_content !== '') {
                            keywords.forEach(function(keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if( index_title < 0 && index_content < 0 ) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += '<li><a href="'+ data_url +'" class="search-result-title" target="_blank">'+ data_title;
                            var content = data.content.trim().replace(/<[^>]+>/g, '');
                            if (first_occur >= 0) {
                                // cut out characters
                                var start = first_occur - 6;
                                var end = first_occur + 6;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 10;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, 'gi');
                                    match_content = match_content.replace(regS, '<em class="search-keyword">'+keyword+'</em>');
                                })
                                str += '<p class="search-result">' + match_content + '...</p>' +'</a>';
                            }
                        }
                    });
                    $resultContent.innerHTML = str;
                });
            }
        });
    }
</script>


    <script>
        var inputArea = document.querySelector('#search');
        var getSearchFile = function() {
            var path = 'search.xml';
            searchFunc(path, 'search', 'local-search-result');
        }

        if(inputArea) {
            inputArea.onfocus = function() {
                getSearchFile();
            }
        }
    </script>


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->


                </main>
            </div>
        </body>
    
</html>
