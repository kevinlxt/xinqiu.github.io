<!DOCTYPE html>
<html>
    <head>
    <!-- Title -->
    
    <title>
        &lt;&lt;深入理解C指针&gt;&gt;读书笔记 | 一人Code
    </title>
    
    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">
    
    <!-- Meta & INfo -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Xin Qiu">
    <meta name="description" content="写给自己的Blog">
    <meta name="keywords" content="null">
    
    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">
    
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="一人Code">
    
    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://xinqiu.me">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="&lt;&lt;深入理解C指针&gt;&gt;读书笔记 | 一人Code">
    <meta property="og:description" content="写给自己的Blog">
    
     <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">
        
        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->
    
    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
	body, html{
		font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
	}
	
    a{
        color: #00838F
    }
    
    .mdl-card__media,
    #search-label,
    #search-form-label:after,
    #scheme-Paradox .hot_tags-count,
    #scheme-Paradox .sidebar_archives-count,
    #scheme-Paradox .sidebar-colored .sidebar-header,
    #scheme-Paradox .sidebar-colored .sidebar-badge{
        background-color: #0097A7 !important
    }
    
	/* Sidebar User Drop Down Menu Text Color */
	#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
    #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus{
        color: #0097A7 !important
    }
    
    #post_entry-right-info,
    .sidebar-colored .sidebar-nav li:hover > a,
    .sidebar-colored .sidebar-nav li:hover > a i,
    .sidebar-colored .sidebar-nav li > a:hover,
    .sidebar-colored .sidebar-nav li > a:hover i,
    .sidebar-colored .sidebar-nav li > a:focus i,
    .sidebar-colored .sidebar-nav > .open > a,
    .sidebar-colored .sidebar-nav > .open > a:hover,
    .sidebar-colored .sidebar-nav > .open > a:focus,
    #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a{
        color: #0097A7 !important
    }
    
    .toTop{
        background: #757575 !important
    }
		
	.material-layout .material-post>.material-nav,
	.material-layout .material-index>.material-nav,
	.material-nav a{
		color: #757575;
	}
		
	#scheme-Paradox .MD-burger-layer {
		background-color: #757575;
	}

	#scheme-Paradox #post-toc-trigger-btn{
		color: #757575;
	}
	
	.post-toc a:hover{
		color: #00838F;
		text-decoration: underline;
	}
</style>


<!-- Theme Background Related-->

    <style>
        body{
            background-color: #F5F5F5
        }
		
		/* blog_info bottom background */
        #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
            background-color: #fff;
        }
    </style>




<!-- Fade Effect -->

    <style>
        .fade {
            transition: all 800ms linear;
            -webkit-transform: translate3d(0,0,0);
            -moz-transform: translate3d(0,0,0);
            -ms-transform: translate3d(0,0,0);
            -o-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
            opacity: 1;
        }

        .fade.out{
            opacity: 0;
        }
    </style>

	<script src="/js/jquery.min.js"></script>
	
	<!-- UC Browser Compatible-->
	<script>
		var agent = navigator.userAgent.toLowerCase();
		if(agent.indexOf('ucbrowser')>0) {
			document.write('<link rel="stylesheet" href="/css/uc.css">');
		   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
		}
	</script>
    
    <!-- Custom Head -->
    
</head>
	
	

    <body id="scheme-Paradox">

		
        <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
				
			
			
            <!-- Main Container -->
            <main class="material-layout__content" id="main">
				
                <!-- Top Anchor -->
                <div id="top"></div>
				
				
                <!-- Hamburger Button -->
                <button class="MD-burger-icon sidebar-toggle">
                    <span class="MD-burger-layer"></span>
                </button>
				
				
                
	<!-- Back Button -->
<!--
	<div class="material-back" id="backhome-div" tabindex="0">
		<a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" href="#" onclick="window.history.back();return false;" target="_self" role="button" data-upgraded=",MaterialButton,MaterialRipple">
			<i class="material-icons" role="presentation">arrow_back</i>
			<span class="mdl-button__ripple-container">
				<span class="mdl-ripple"></span>
			</span>
		</a>
	</div>			
-->
	<!-- Left aligned menu below button -->
	<button id="post-toc-trigger-btn"
			class="mdl-button mdl-js-button mdl-button--icon">
	  <i class="material-icons">format_list_numbered</i>
	</button>

	<ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect"
		for="post-toc-trigger-btn">
			
			<ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u9605_u8BFB_u58F0_u660E"><span class="post-toc-number">1.</span> <span class="post-toc-text">阅读声明</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u5E38_u91CF_u4E0E_u6307_u9488"><span class="post-toc-number">2.</span> <span class="post-toc-text">常量与指针</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u6307_u5411_u5E38_u91CF_u7684_u6307_u9488"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">指向常量的指针</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u6307_u5411_u975E_u5E38_u91CF_u7684_u5E38_u91CF_u6307_u9488"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">指向非常量的常量指针</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u6307_u5411_u5E38_u91CF_u7684_u5E38_u91CF_u6307_u9488"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">指向常量的常量指针</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u6307_u5411_u300E_u6307_u5411_u5E38_u91CF_u7684_u5E38_u91CF_u6307_u9488_u300F_u7684_u6307_u9488"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">指向『指向常量的常量指针』的指针</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u52A8_u6001_u5185_u5B58_u5206_u914D"><span class="post-toc-number">3.</span> <span class="post-toc-text">动态内存分配</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u53D8_u957F_u6570_u7EC4"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">变长数组</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#u6808_u5E27"><span class="post-toc-number">3.1.1.</span> <span class="post-toc-text">栈帧</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u52A8_u6001_u5206_u914D_u4E8C_u7EF4_u6570_u7EC4"><span class="post-toc-number">4.</span> <span class="post-toc-text">动态分配二维数组</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u52A8_u6001_u5206_u914D_u53EF_u80FD_u4E0D_u8FDE_u7EED_u7684_u5185_u5B58"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">动态分配可能不连续的内存</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u52A8_u6001_u5206_u914D_u8FDE_u7EED_u5185_u5B58"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">动态分配连续内存</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u7ED3_u6784_u4F53_u5185_u5B58_u5927_u5C0F"><span class="post-toc-number">5.</span> <span class="post-toc-text">结构体内存大小</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u907F_u514Dmalloc/free_u5F00_u9500"><span class="post-toc-number">6.</span> <span class="post-toc-text">避免malloc/free开销</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u5904_u7406_u672A_u521D_u59CB_u5316_u6307_u9488"><span class="post-toc-number">7.</span> <span class="post-toc-text">处理未初始化指针</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u51FD_u6570_u6307_u9488"><span class="post-toc-number">8.</span> <span class="post-toc-text">函数指针</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u58F0_u660E_u51FD_u6570_u6307_u9488"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">声明函数指针</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u4F20_u9012_u51FD_u6570_u6307_u9488"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">传递函数指针</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u8FD4_u56DE_u51FD_u6570_u6307_u9488"><span class="post-toc-number">8.3.</span> <span class="post-toc-text">返回函数指针</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u51FD_u6570_u6307_u9488_u6570_u7EC4"><span class="post-toc-number">8.4.</span> <span class="post-toc-text">函数指针数组</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u6307_u9488_u5B89_u5168_u65B9_u9762"><span class="post-toc-number">9.</span> <span class="post-toc-text">指针安全方面</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#u6E05_u9664_u654F_u611F_u6570_u636E"><span class="post-toc-number">9.1.</span> <span class="post-toc-text">清除敏感数据</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#u5176_u4ED6_u91CD_u8981_u5185_u5BB9"><span class="post-toc-number">10.</span> <span class="post-toc-text">其他重要内容</span></a></li></ol>
		
<!--			<li class="mdl-menu__item">Some Action</li>-->
	</ul>


<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">
		
        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
	<!-- Paradox Post Header -->
	
		
			<!-- Random Thumbnail -->
			<div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
				<script>
    
    var randomNum;
    randomNum = Math.floor(Math.random() * 5 + 1);
    
    $(".post_thumbnail-random").css('background-image', 'url(' + '/img/random/' + randomNum + '.png' + ')');
    
</script>

		
	
        <p class="article-headline-p">
            <<深入理解C指针>>读书笔记
        </p>
    </div>

	

				
				
					<!-- Paradox Post Info -->
					<div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
    
    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Xin Qiu</strong>
        <span>Jun 09, 2015</span>
    </div>
    
    <div class="section-spacer"></div>
	
    <!-- Favorite -->
<!--
    <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
        <i class="material-icons" role="presentation">favorite</i>
        <span class="visuallyhidden">favorites</span>
    </button>
-->
    
    <!-- Tags (bookmark) -->
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/Notes/">Notes</a>
    </ul>
    
    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    
    <!-- Leancloud Views -->
    <a class="post_share-link" href="#">
        <li class="mdl-menu__item">
            <span id="/2015/06/09/C-Pointers/" class="leancloud-views_num" data-flag-title="&lt;&lt;深入理解C指针&gt;&gt;读书笔记">
     &nbsp;Views
</span>
        </li>
    </a>
    
    
    
    
    <!-- Share Twitter -->
    <a class="post_share-link" href="https://twitter.com/intent/tweet?text=&lt;&lt;深入理解C指针&gt;&gt;读书笔记&url=http://xinqiu.me//2015/06/09/C-Pointers/index.html&via=Xin Qiu" target="_blank">
        <li class="mdl-menu__item">
            Share to Twitter
        </li>
    </a>
    
    <!-- Share Google+ -->
    <a class="post_share-link" href="https://plus.google.com/share?url=http://xinqiu.me//2015/06/09/C-Pointers/index.html" target="_blank">
        <li class="mdl-menu__item">
            Share to Google+
        </li>
    </a>
    
    <!-- Share Weibo -->
    <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=&lt;&lt;深入理解C指针&gt;&gt;读书笔记&url=http://xinqiu.me//2015/06/09/C-Pointers/index.html&pic=&searchPic=false&style=simple" target="_blank">
        <li class="mdl-menu__item">
            Share to Weibo
        </li>
    </a>
</ul>
</div>
				

                <!-- Post Content -->
                <div id="post-content" class="markdown-Github mdl-color-text--grey-700 mdl-card__supporting-text fade out">
	
		<blockquote>
<p>指针可以说是C的灵魂，C语言入门很容易，但想精通，就必须要对指针有很透彻的理解。大一上学期学了一遍C语言，然而指针这个最重要的地方，却没有好好的深入研究。这本&lt;&lt;深入理解C指针&gt;&gt;虽然谈不上讲到多少指针的奇巧淫技，但作为复习指针的相关知识，还是可以稍微读读。</p>
</blockquote>
<a id="more"></a>
<h2 id="u9605_u8BFB_u58F0_u660E"><a href="#u9605_u8BFB_u58F0_u660E" class="headerlink" title="阅读声明"></a>阅读声明</h2><p>倒过来读会让指针更容易理解。<br>￼￼￼<br>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">const int *pci;</div></pre></td></tr></table></figure>
<hr>
<table>
<thead>
<tr>
<th>Explanation</th>
<th style="text-align:center">Declaration</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.pci is a variable</td>
<td style="text-align:center">const int *<strong>pci</strong></td>
</tr>
<tr>
<td>2.pci is a pointer variable</td>
<td style="text-align:center">const int <strong> *pci</strong></td>
</tr>
<tr>
<td>3.pci is a pointer variable to an integer</td>
<td style="text-align:center">const <strong> int *pci</strong></td>
</tr>
<tr>
<td>4.pci is a pointer variable to a constant integer</td>
<td style="text-align:center"><strong>const int *pci </strong></td>
</tr>
</tbody>
</table>
<hr>
<h2 id="u5E38_u91CF_u4E0E_u6307_u9488"><a href="#u5E38_u91CF_u4E0E_u6307_u9488" class="headerlink" title="常量与指针"></a>常量与指针</h2><p>和&lt;<c专家编程>&gt;一样，&lt;&lt;深入理解C指针&gt;&gt;也讲到了常量与指针。</c专家编程></p>
<h3 id="u6307_u5411_u5E38_u91CF_u7684_u6307_u9488"><a href="#u6307_u5411_u5E38_u91CF_u7684_u6307_u9488" class="headerlink" title="指向常量的指针"></a>指向常量的指针</h3><p>指针定义为指向常量，不能通过指针修改它所引用的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">const int *ptr;</div><div class="line">int const *ptr;</div></pre></td></tr></table></figure>
<h3 id="u6307_u5411_u975E_u5E38_u91CF_u7684_u5E38_u91CF_u6307_u9488"><a href="#u6307_u5411_u975E_u5E38_u91CF_u7684_u5E38_u91CF_u6307_u9488" class="headerlink" title="指向非常量的常量指针"></a>指向非常量的常量指针</h3><p>指针不可变，但所指向的数据可变。指针必须被初始化为指向非常量变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">int *const ptr;</div></pre></td></tr></table></figure>
<h3 id="u6307_u5411_u5E38_u91CF_u7684_u5E38_u91CF_u6307_u9488"><a href="#u6307_u5411_u5E38_u91CF_u7684_u5E38_u91CF_u6307_u9488" class="headerlink" title="指向常量的常量指针"></a>指向常量的常量指针</h3><p>指针本身不能修改，指向的数据也不能通过它来修改。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">const int *const ptr;</div></pre></td></tr></table></figure>
<h3 id="u6307_u5411_u300E_u6307_u5411_u5E38_u91CF_u7684_u5E38_u91CF_u6307_u9488_u300F_u7684_u6307_u9488"><a href="#u6307_u5411_u300E_u6307_u5411_u5E38_u91CF_u7684_u5E38_u91CF_u6307_u9488_u300F_u7684_u6307_u9488" class="headerlink" title="指向『指向常量的常量指针』的指针"></a>指向『指向常量的常量指针』的指针</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">const int * const * ptr;</div></pre></td></tr></table></figure>
<h2 id="u52A8_u6001_u5185_u5B58_u5206_u914D"><a href="#u52A8_u6001_u5185_u5B58_u5206_u914D" class="headerlink" title="动态内存分配"></a>动态内存分配</h2><ul>
<li>malloc</li>
<li>realloc</li>
<li>calloc</li>
</ul>
<hr>
<table>
<thead>
<tr>
<th>Function</th>
<th style="text-align:center">Declaration</th>
</tr>
</thead>
<tbody>
<tr>
<td>malloc</td>
<td style="text-align:center">从堆上分配内存</td>
</tr>
<tr>
<td>realloc</td>
<td style="text-align:center">在之前分配的内存块基础上，将内存重新分配为更大或者更小的部分</td>
</tr>
<tr>
<td>calloc</td>
<td style="text-align:center">从堆上分配内存并清零</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="u53D8_u957F_u6570_u7EC4"><a href="#u53D8_u957F_u6570_u7EC4" class="headerlink" title="变长数组"></a>变长数组</h3><p>使用alloca函数(微软为malloca)在函数的栈帧上分配内存。函数返回后自动释放内存。</p>
<h4 id="u6808_u5E27"><a href="#u6808_u5E27" class="headerlink" title="栈帧"></a>栈帧</h4><p>栈帧由以下几种元素组成</p>
<ul>
<li>返回地址</li>
<li>局部数据存储</li>
<li>参数存储</li>
<li>栈指针和基指针</li>
</ul>
<h2 id="u52A8_u6001_u5206_u914D_u4E8C_u7EF4_u6570_u7EC4"><a href="#u52A8_u6001_u5206_u914D_u4E8C_u7EF4_u6570_u7EC4" class="headerlink" title="动态分配二维数组"></a>动态分配二维数组</h2><h3 id="u52A8_u6001_u5206_u914D_u53EF_u80FD_u4E0D_u8FDE_u7EED_u7684_u5185_u5B58"><a href="#u52A8_u6001_u5206_u914D_u53EF_u80FD_u4E0D_u8FDE_u7EED_u7684_u5185_u5B58" class="headerlink" title="动态分配可能不连续的内存"></a>动态分配可能不连续的内存</h3><p>以下代码演示了如何创建一个内存可能不连续的二维数组。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> rows = <span class="number">2</span>;</div><div class="line"><span class="keyword">int</span> columns = <span class="number">5</span>;</div><div class="line"></div><div class="line"><span class="keyword">int</span> **matrix = (<span class="keyword">int</span> **) <span class="built_in">malloc</span>(rows * <span class="keyword">sizeof</span>(<span class="keyword">int</span> *));</div><div class="line"></div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rows; i++)&#123;</div><div class="line">	matrix[i] = (<span class="keyword">int</span> *) <span class="built_in">malloc</span>(columns * <span class="keyword">sizeof</span>(<span class="keyword">int</span>))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="u52A8_u6001_u5206_u914D_u8FDE_u7EED_u5185_u5B58"><a href="#u52A8_u6001_u5206_u914D_u8FDE_u7EED_u5185_u5B58" class="headerlink" title="动态分配连续内存"></a>动态分配连续内存</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> rows = <span class="number">2</span>;</div><div class="line"><span class="keyword">int</span> columns = <span class="number">5</span>;</div><div class="line"></div><div class="line"><span class="keyword">int</span> **matrix = (<span class="keyword">int</span> **) <span class="built_in">malloc</span>(rows * <span class="keyword">sizeof</span>(<span class="keyword">int</span> *));</div><div class="line">matrix[<span class="number">0</span>] = (<span class="keyword">int</span> *) <span class="built_in">malloc</span>(rows * columns * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rows; i++)&#123;</div><div class="line">	matrix[i] = matrix[<span class="number">0</span>] + i * columns;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上代码演示了第一种技术，第一个malloc分配了一个整数指针数组，一个元素用来存储一行的指针。第二个malloc在存储每行第一个元素的地址。</p>
<p>第二种技术是一次性分配数组所需的所有内存。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> *matrix = (<span class="keyword">int</span> *) <span class="built_in">malloc</span>(rows * columns * <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</div></pre></td></tr></table></figure></p>
<h2 id="u7ED3_u6784_u4F53_u5185_u5B58_u5927_u5C0F"><a href="#u7ED3_u6784_u4F53_u5185_u5B58_u5927_u5C0F" class="headerlink" title="结构体内存大小"></a>结构体内存大小</h2><p>为结构体分配内存时，分配的内存至少是各个字段的长度和。实际长度通常大于这个和。某些数据类型需要对齐到特定边界。比如说，短整数通常对齐到能被2整除的地址上，而整数对齐到能被4整除的地址上。</p>
<h2 id="u907F_u514Dmalloc/free_u5F00_u9500"><a href="#u907F_u514Dmalloc/free_u5F00_u9500" class="headerlink" title="避免malloc/free开销"></a>避免malloc/free开销</h2><p>重复分配然后释放结构体会尝试一些开销，可能导致巨大的性能瓶颈。解决这问题的一种办法是为分配的结构体单独维护一个表。当用户不再需要某个结构体实例时，将其返回结构体池中。当需要某个实例，则从结构体池中获取一个对象。如果没有可用的元素，就动态分配一个实例。但表的长度则成为了一个问题。但这个问题是可以解决。</p>
<h2 id="u5904_u7406_u672A_u521D_u59CB_u5316_u6307_u9488"><a href="#u5904_u7406_u672A_u521D_u59CB_u5316_u6307_u9488" class="headerlink" title="处理未初始化指针"></a>处理未初始化指针</h2><p>有三种方法可以用来处理未初始化的指针:</p>
<ul>
<li>总是用NULL来初始化指针</li>
<li>用assert函数</li>
<li>用第三方工具</li>
</ul>
<p>assert函数判断表达式是否为真，表达式为假，程序会终止。</p>
<h2 id="u51FD_u6570_u6307_u9488"><a href="#u51FD_u6570_u6307_u9488" class="headerlink" title="函数指针"></a>函数指针</h2><h3 id="u58F0_u660E_u51FD_u6570_u6307_u9488"><a href="#u58F0_u660E_u51FD_u6570_u6307_u9488" class="headerlink" title="声明函数指针"></a>声明函数指针</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> (*foo)();</div></pre></td></tr></table></figure>
<p>foo为函数指针。要注意的是，如果声明是</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> *<span class="title">foo</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure>
<p>意义就变了，代表foo函数返回一个int型指针。</p>
<p>为函数指针声明一个类型定义会比较方便，但类型定义看起来有点奇怪，通常，类型定义的名字是声明的最后一个元素。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*funcptr)</span><span class="params">(<span class="keyword">int</span>)</span></span>;</div></pre></td></tr></table></figure>
<p>举个栗子</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*funcptr)</span><span class="params">(<span class="keyword">int</span>)</span></span>;</div><div class="line">funcptr fptr2;</div><div class="line">fptr2 = foo; <span class="comment">// 	foo为函数名</span></div><div class="line">fptr(n);	<span class="comment">// 调用foo函数</span></div></pre></td></tr></table></figure>
<h3 id="u4F20_u9012_u51FD_u6570_u6307_u9488"><a href="#u4F20_u9012_u51FD_u6570_u6307_u9488" class="headerlink" title="传递函数指针"></a>传递函数指针</h3><p>只要把函数指针声明最为函数参数即可。</p>
<p>举个栗子</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> num1 + num2;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">substract</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> num1 - num2;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*fptrOperation)</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">compute</span><span class="params">(fptrOperation operation, <span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> operation(num1, num2);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="u8FD4_u56DE_u51FD_u6570_u6307_u9488"><a href="#u8FD4_u56DE_u51FD_u6570_u6307_u9488" class="headerlink" title="返回函数指针"></a>返回函数指针</h3><p>返回函数指针需要把函数的返回类型声明为函数指针。</p>
<p>接着上一个的例子</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function">fptrOperation <span class="title">select</span><span class="params">(<span class="keyword">char</span> opcode)</span></span>&#123;</div><div class="line">    <span class="keyword">switch</span>(opcode)&#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'+'</span>: <span class="keyword">return</span> add;</div><div class="line">        <span class="keyword">case</span> <span class="string">'-'</span>: <span class="keyword">return</span> substract;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// evaluate函数整合了其他函数。该函数接受两个整数和一个字符，</span></div><div class="line"><span class="comment">// 字符代表要做的操作，它会把opcode传递给select函数，</span></div><div class="line"><span class="comment">// 后者返回要执行的函数指针。</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">evaluate</span><span class="params">(<span class="keyword">char</span> opcode, <span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span></span></div><div class="line">&#123;</div><div class="line">    fptrOperation operation = select(opcode);</div><div class="line">    <span class="keyword">return</span> operation(num1, num2);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="u51FD_u6570_u6307_u9488_u6570_u7EC4"><a href="#u51FD_u6570_u6307_u9488_u6570_u7EC4" class="headerlink" title="函数指针数组"></a>函数指针数组</h3><p>把函数指针声明为数组的类型。<br>接着上面的例子</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*opertation)</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</div><div class="line">operation operations[<span class="number">128</span>] = &#123;<span class="literal">NULL</span>&#125;;</div><div class="line"><span class="comment">// 或者 int(*operations[128])(int, int) = &#123;NULL&#125;;</span></div><div class="line"><span class="comment">// 用指针数组来避免使用switch</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">initializeOperationsArray</span><span class="params">()</span></span>&#123;</div><div class="line">	operations[<span class="string">'+'</span>] = add;</div><div class="line">	operations[<span class="string">'-'</span>] = subtract;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 所以evaluate需要改写为evaluateArray.</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">evaluateArray</span><span class="params">(<span class="keyword">char</span> opcode, <span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span></span>&#123;</div><div class="line">	fptrOperation operation;</div><div class="line">	operation = operations[opcode];</div><div class="line">	<span class="keyword">return</span> operation(num1, num2);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="u6307_u9488_u5B89_u5168_u65B9_u9762"><a href="#u6307_u9488_u5B89_u5168_u65B9_u9762" class="headerlink" title="指针安全方面"></a>指针安全方面</h2><h3 id="u6E05_u9664_u654F_u611F_u6570_u636E"><a href="#u6E05_u9664_u654F_u611F_u6570_u636E" class="headerlink" title="清除敏感数据"></a>清除敏感数据</h3><p>复写敏感数据可以使用<code>memset</code>函数。</p>
<h2 id="u5176_u4ED6_u91CD_u8981_u5185_u5BB9"><a href="#u5176_u4ED6_u91CD_u8981_u5185_u5BB9" class="headerlink" title="其他重要内容"></a>其他重要内容</h2><ul>
<li>指针的类型转换</li>
<li>访问硬件设备</li>
<li>别名和强别名</li>
<li>使用restrict关键字</li>
<li>线程</li>
<li>面向对象技术</li>
</ul>
<p>书中最后的部分简单的提及了一些高级技巧，这块知识，我觉得还是看其他详细的书比较好。</p>

	
	
	
	
</div>
				
				

                <!-- Post Comments -->
                


    <!-- 使用 DISQUS -->
	<div id="disqus-comment">
		<div id="disqus_thread"></div>
<script>
	var disqus_config = function () {
		this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
		this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
	};

	(function() { // DON'T EDIT BELOW THIS LINE
		var d = document, s = d.createElement('script');
		s.src = '//xinqiu.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
	})();
</script>
	</div>
	<style>
		#disqus-comment{
			background-color:#eee;
			padding:2pc;
		}
	</style>

            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    
    <!-- Prev Nav -->
    
        <a href="/2015/07/07/LeetCode-100/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            Newer
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2015/05/30/Dijkstra's-Algorithom/" id="post_nav-older" class="next-content">
            Older
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>
        </div>
    </div>

				
				
					<!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay "></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored  sidebar-fixed-left" role="navigation">
	<div id="sidebar-main">
	    <!-- Sidebar Header -->
		<div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
    <i class="material-icons">clear_all</i>
    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Xin Qiu's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        xinqiu.94@gmail.com
        <b class="caret"></b>
    </a>
</div>

		<!-- Sidebar Navigation  -->
		<ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
			
                <li>
                    <a href="mailto:xinqiu.94@mail.com" target="_blank" title="Email Me">
						<i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    <li id="sidebar-first-li">
        <a href="/" target="_self">
            <i class="material-icons sidebar-material-icons">home</i>
             Home
        </a>
    </li>

    <!-- I'm Feeling Lucky -->
<!--
    <li class="dropdown">
        <a href="" target="_self">
            <i class="material-icons sidebar-material-icons">explore</i>
             sidebar.imlucky
        </a>
    </li>
-->

	
    <!-- Archives  -->
    <li class="dropdown">
        <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
            <i class="material-icons sidebar-material-icons">inbox</i>
             Archives
            <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
            <li>
            <a class="sidebar_archives-link" href="/archives/2016/10/">October 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">August 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">July 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">June 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">May 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">April 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">March 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/02/">February 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">January 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/12/">December 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/11/">November 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/10/">October 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/09/">September 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/08/">August 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/07/">July 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">June 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/05/">May 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/03/">March 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/02/">February 2015<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/01/">January 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/12/">December 2014<span class="sidebar_archives-count">1</span></a>
        </ul>
    </li>

    <!-- Divider -->
    <li class="divider"></li>


    <!-- Pages  -->
	
		<li>
			<a href="/about" title="About">
				About
			</a>
		</li>
	
		<li>
			<a href="/projects" title="Projects">
				Projects
			</a>
		</li>
	
		<li>
			<a href="/reading-list" title="Reading">
				Reading
			</a>
		</li>
	
		<li>
			<a href="/timeline" title="Timeline">
				Timeline
			</a>
		</li>
	
		<li>
			<a href="/tags" title="Tags">
				Tags
			</a>
		</li>
	

    <!-- Article Numebr  -->
    <li>
        <a href="#">
             Article Number
             <span class="sidebar-badge">38</span>
        </a>
    </li>
</ul>

		<!-- Sidebar Divider -->
		<div class="sidebar-divider"></div>

	</div>
   

</aside>

				
				
				
					<!-- Footer Top Button -->
					<div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>
				
				
				<!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
	
	
		<!-- Paradox Footer Left Section -->
		<div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
    <a href="https://twitter.com/twitter" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.png);">
        <span class="visuallyhidden">Twitter</span>
    </button></a>
    
    
    <!-- Facebook -->
    
    <a href="https://www.facebook.com/facebook" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.png);">
        <span class="visuallyhidden">Facebook</span>
    </button></a>
    
    
    <!-- Google + -->
    
    <a href="https://www.google.com/" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-gplus.png);">
        <span class="visuallyhidden">Google Plus</span>
    </button></a>
    
    
    <!-- Weibo -->
    
    
    
    <!-- Instagram -->
    
    
    
    <!-- Tumblr -->
    
    
    
    <!-- Github -->
    
    <a href="https://github.com/xinqiu" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
        <span class="visuallyhidden">Github</span>
    </button></a>
    
</div>


		<!--Copyright-->
		<div id="copyright">Copyright&nbsp;©&nbsp;<script type="text/javascript">var fd = new Date();document.write(fd.getFullYear());</script>&nbsp;一人Code</div>

		<!-- Paradox Footer Right Section -->

		<!-- 
		I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright.
		It will not impact the appearance and can give developers a lot of support :)

		很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
		它不会影响美观并可以给开发者很大的支持。 :) 
		-->

		<div class="mdl-mini-footer--right-section">
			<div>
				<div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
				<div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
			</div>
		</div>
	
    
</footer>
                
				<!-- Import File -->
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    
    $('#nprogress .bar').css({
        'background': '#FF4081'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #FF4081, 0 0 15px #FF4081'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#FF4081',
        'border-left-color': '#FF4081'
    });
    
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>




    <!-- Leancloud -->
	<script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
	<script>
		AV.initialize("wNFmCWTd6GAdUBwK4C35gD2G-gzGzoHsz", "fkjBgbCuEaEEKpksFNIkGYsk");
	</script>
    <script>
	function showTime(Counter) {
		var query = new AV.Query(Counter);
		$(".leancloud-views_num").each(function() {
			var url = $(this).attr("id").trim();
			query.equalTo("url", url);
			query.find({
				success: function(results) {
					if (results.length == 0) {
						var content = '0 ' + $(document.getElementById(url)).text();
						$(document.getElementById(url)).text(content);
						return;
					}
					for (var i = 0; i < results.length; i++) {
						var object = results[i];
						var content = object.get('time') + ' ' + $(document.getElementById(url)).text();
						$(document.getElementById(url)).text(content);
					}
				},
				error: function(object, error) {
					console.log("Error: " + error.code + " " + error.message);
				}
			});

		});
	}

	function addCount(Counter) {
		var Counter = AV.Object.extend("Counter");
		url = $(".leancloud-views_num").attr('id').trim();
		title = $(".leancloud-views_num").attr('data-flag-title').trim();
		var query = new AV.Query(Counter);
		query.equalTo("url", url);
		query.find({
			success: function(results) {
				if (results.length > 0) {
					var counter = results[0];
					counter.fetchWhenSave(true);
					counter.increment("time");
					counter.save(null, {
						success: function(counter) {
							var content =  counter.get('time') + ' ' + $(document.getElementById(url)).text();
							$(document.getElementById(url)).text(content);
						},
						error: function(counter, error) {
							console.log('Failed to save Visitor num, with error message: ' + error.message);
						}
					});
				} else {
					var newcounter = new Counter();
					newcounter.set("title", title);
					newcounter.set("url", url);
					newcounter.set("time", 1);
					newcounter.save(null, {
						success: function(newcounter) {
							console.log("newcounter.get('time')="+newcounter.get('time'));
							var content = newcounter.get('time') + ' ' + $(document.getElementById(url)).text();
							$(document.getElementById(url)).text(content);
						},
						error: function(newcounter, error) {
							console.log('Failed to create');
						}
					});
				}
			},
			error: function(error) {
				console.log('Error:' + error.code + " " + error.message);
			}
		});
	}
	$(function() {
		var Counter = AV.Object.extend("Counter");
		if ($('.leancloud-views_num').length == 1) {
			addCount(Counter);
		} else if ($('.post-title-link').length > 1) {
			showTime(Counter);
		}
	}); 
</script>







    <!-- 使用 DISQUS js 代码 -->
	<script id="dsq-count-scr" src="//xinqiu.disqus.com/count.js" async></script>


<!-- Swiftye -->


<!-- Local Search-->

	<script>
	var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        success: function( xmlResponse ) {
            // get the contents from search data
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length <= 0) {
                    return;
                }
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        str += "<li><a href='"+ data_url +"' class='search-result-title' target='_blank'>"+ data_title;
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out characters
                            var start = first_occur - 6;
                            var end = first_occur + 6;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 10;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substr(start, end); 
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<em class=\"search-keyword\">"+keyword+"</em>");
                            })
                            str += "<p class=\"search-result\">" + match_content +"...</p>" +"</a>";
                        }
                    }
                })
                $resultContent.innerHTML = str;
            })
        }
    })
}
</script>

	<script>
		var search_path = "search.xml";
		if (search_path.length == 0) {
		search_path = "search.xml";
		}
		var path = "/" + search_path;
		searchFunc(path, 'search', 'local-search-result');
        
        
	</script>


<!-- Window Load-->
<script>
    // Post_Toc parent position fixed
    $(window).load(function() {
        $(".post-toc-wrap").parent(".mdl-menu__container").css("position", "fixed");
    });
</script>
            </main>
        </div>
		
    </body>
		
	
</html>
