<!DOCTYPE html>
<html lang="en">
    <head>
    <!-- 
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.0 -->

    <!-- Title -->
    
    <title>
        
            CSAPP Lab2 解题分析 | 
        
        一人Code
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Meta & Info -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Xin Qiu">
    <meta name="description" content="写给自己的Blog">
    <meta name="keywords" content="一人Code|写给自己的Blog,csapp">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="一人Code">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://xinqiu.me">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="CSAPP Lab2 解题分析 | 一人Code">
    <meta property="og:description" content="写给自己的Blog">
    <meta property="og:article:tag" content="csapp"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }
</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>



    <script src="/js/jquery.min.js"></script>
    <script src="/js/queue.js"></script>

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    
    <!-- Google Analytics -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-57881840-1', 'auto');ga('send', 'pageview');
    </script>
    

    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
        
            <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-57881840-1', 'auto'); ga('send', 'pageview'); </script>
        
    
<link rel="stylesheet" href="/css/prism-coy.css" type="text/css"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Phase1"><span class="post-toc-number">1.</span> <span class="post-toc-text">Phase1</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Phase2"><span class="post-toc-number">2.</span> <span class="post-toc-text">Phase2</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Phase3"><span class="post-toc-number">3.</span> <span class="post-toc-text">Phase3</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Phase4"><span class="post-toc-number">4.</span> <span class="post-toc-text">Phase4</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Phase5"><span class="post-toc-number">5.</span> <span class="post-toc-text">Phase5</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Phase6"><span class="post-toc-number">6.</span> <span class="post-toc-text">Phase6</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Secret_phase"><span class="post-toc-number">7.</span> <span class="post-toc-text">Secret phase</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#u6700_u540E"><span class="post-toc-number"></span> <span class="post-toc-text">最后</span></a>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').css('background-image', 'url(' + '/img/random/material-' + randomNum + '.png' + ')');
</script>

        
    
            <p class="article-headline-p">
                CSAPP Lab2 解题分析
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Xin Qiu</strong>
        <span>Feb 10, 2016</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
            <i class="material-icons" role="presentation">devices other</i>
            <span class="visuallyhidden">devices other</span>
        </button>
        <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
            <li class="mdl-menu__item">Read this article on other device</li>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACY0lEQVR42u3aQXKDMAwFUO5/6XbbRSFfEnZI5rHqtMTokRnZlXT8fPV14OHh4eHh4eHhPYx3xNff+5PPXt/zT1jxZ69Xw8PDw9vDe5FqT3hnQSR/vb6zFxseHh7efl4vlASWvKbrewqx4eHh4T2MlzOSY3RCwsPDw/t03iTp5y8LDw8P71N4hX/4W6k/f3Fvq7Xg4eHhxbxJA2z1z2/u7+Hh4eGNh66qifvsCJ4n+tHQFR4eHt4C3lkiTo7C1eQ+WTNZGQ8PD28nL3lYL5Xno1RR6L0yLh4eHt6tvGqISek22QbylZMV8PDw8HbykuSbbxVV/GTU4HR9PDw8vO28SaC9EvBkY8DDw8N7L686RJUk68lga6+dhoeHh7eTl7OToPPyQQ64ed/Dw8PDG/N6Ta/eFpIcpnsR4uHh4e3hJSWAall20h6blCTw8PDw9vCqG0MVmYDzYu6L5+Lh4eEt5lUfNhmcqhZke18DHh4e3mpeHlCepqvhTl5BtO/h4eHhLeDl1OhQGwc62RJum4zAw8PDa/GqSb835Fo9dle3Kzw8PLw9vF4pNj9ST9pgza8BDw8PbwsvOUDnQ1H58br6ezw8PLwn8HJYtSl1byOt8OLw8PDwFvOqV29AqtD4H5eA8fDw8FbzjviaNMnmgHyIFg8PD28Pb9K8r45eVVcrby14eHh4G3m9pn611FvdkMpDYHh4eHgP41WP2j12tTiCh4eH93xefoDOyxP5CNeL1fDw8PA28grJNx7A6m02k+EtPDw8vD28XiEgT/R5MaJHwsPDw9vJ+74LDw8PDw8PDw/vAdcv6BZy3tDN+S8AAAAASUVORK5CYII=">
        </ul>
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/csapp/">csapp</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    <!-- Leancloud Views -->
        <a class="post_share-link" href="#">
            <li class="mdl-menu__item">
                <span id="/2016/02/10/csapp-lab2-bomb/" class="leancloud-views_num" data-flag-title="CSAPP Lab2 解题分析">
     &nbsp;Views
</span>

            </li>
        </a>
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=CSAPP Lab2 解题分析&url=http://xinqiu.me//2016/02/10/csapp-lab2-bomb/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                Share to Weibo
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=CSAPP Lab2 解题分析&url=http://xinqiu.me//2016/02/10/csapp-lab2-bomb/index.html&via=Xin Qiu" target="_blank">
            <li class="mdl-menu__item">
                Share to Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://xinqiu.me//2016/02/10/csapp-lab2-bomb/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://xinqiu.me//2016/02/10/csapp-lab2-bomb/index.html" target="_blank">
            <li class="mdl-menu__item">
                Share to Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>Lab2 的 Bomb是个非常有意思的实验，比起之前耗脑的Lab1，这个Lab主要是学习反汇编。</p>
<p>这里我的环境是OS X EI Capitan，Lab2是[Updated 1/12/16].</p>
<!--toc-->
<h2 id="Phase1"><a href="#Phase1" class="headerlink" title="Phase1"></a>Phase1</h2><p>在Mac上是默认没有GDB的，可以使用LLDB来代替。</p>
<p>进入lldb</p>
<pre class=" language-bash"><code class="language-bash">lldb bomb
</code></pre>
<p>使用<code>disassemble</code>进行反汇编,参考<code>bomb.c</code>文件，可以知道主要的几个函数名。</p>
<p>首先是Phase_1</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">(</span>lldb<span class="token punctuation">)</span> disas -n phase_1
</code></pre>
<p>得到以下汇编代码</p>
<pre class=" language-html"><code class="language-html">bomb`phase_1:
bomb[0x400ee0] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+0</span><span class="token punctuation">></span></span>:  subq   $0x8, %rsp
bomb[0x400ee4] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+4</span><span class="token punctuation">></span></span>:  movl   $0x402400, %esi
bomb[0x400ee9] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+9</span><span class="token punctuation">></span></span>:  callq  0x401338                  ; strings_not_equal
bomb[0x400eee] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+14</span><span class="token punctuation">></span></span>: testl  %eax, %eax
bomb[0x400ef0] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+16</span><span class="token punctuation">></span></span>: je     0x400ef7                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+23</span><span class="token punctuation">></span></span>
bomb[0x400ef2] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+18</span><span class="token punctuation">></span></span>: callq  0x40143a                  ; explode_bomb
bomb[0x400ef7] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+23</span><span class="token punctuation">></span></span>: addq   $0x8, %rsp
bomb[0x400efb] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+27</span><span class="token punctuation">></span></span>: retq
</code></pre>
<p>这段代码还是挺好理解的，保存<code>Stack pointer</code>,将<code>$0x402400</code>传给<code>%esi</code>,调用位于<code>0x401338</code>的<code>strings_not_equal</code>函数，比较<code>%eax</code>是否为0，不为零则调用<code>explode_bomb</code>函数，为零则返回。</p>
<p>所以关键要找出字符串是什么。根据上述的汇编代码，可以发现字符串被保存在<code>0x402400</code>这个内存里，所以使用<code>x/s</code>来查看。</p>
<pre class=" language-html"><code class="language-html">(lldb) x/s 0x402400
</code></pre>
<p>得到</p>
<pre class=" language-html"><code class="language-html">0x00402400: "Border relations with Canada have never been better."
</code></pre>
<p>所以第一关的答案是<code>Strings_Not_Equal</code></p>
<a id="more"></a>
<h2 id="Phase2"><a href="#Phase2" class="headerlink" title="Phase2"></a>Phase2</h2><p>同样，还是先反汇编出代码</p>
<pre class=" language-html"><code class="language-html">bomb`phase_2:
bomb[0x400efc] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+0</span><span class="token punctuation">></span></span>:  pushq  %rbp
bomb[0x400efd] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+1</span><span class="token punctuation">></span></span>:  pushq  %rbx
bomb[0x400efe] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+2</span><span class="token punctuation">></span></span>:  subq   $0x28, %rsp
bomb[0x400f02] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+6</span><span class="token punctuation">></span></span>:  movq   %rsp, %rsi
bomb[0x400f05] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+9</span><span class="token punctuation">></span></span>:  callq  0x40145c                  ; read_six_numbers
bomb[0x400f0a] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+14</span><span class="token punctuation">></span></span>: cmpl   $0x1, (%rsp)
bomb[0x400f0e] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+18</span><span class="token punctuation">></span></span>: je     0x400f30                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+52</span><span class="token punctuation">></span></span>
bomb[0x400f10] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+20</span><span class="token punctuation">></span></span>: callq  0x40143a                  ; explode_bomb
bomb[0x400f15] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+25</span><span class="token punctuation">></span></span>: jmp    0x400f30                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+52</span><span class="token punctuation">></span></span>
bomb[0x400f17] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+27</span><span class="token punctuation">></span></span>: movl   -0x4(%rbx), %eax
bomb[0x400f1a] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+30</span><span class="token punctuation">></span></span>: addl   %eax, %eax
bomb[0x400f1c] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+32</span><span class="token punctuation">></span></span>: cmpl   %eax, (%rbx)
bomb[0x400f1e] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+34</span><span class="token punctuation">></span></span>: je     0x400f25                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+41</span><span class="token punctuation">></span></span>
bomb[0x400f20] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+36</span><span class="token punctuation">></span></span>: callq  0x40143a                  ; explode_bomb
bomb[0x400f25] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+41</span><span class="token punctuation">></span></span>: addq   $0x4, %rbx
bomb[0x400f29] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+45</span><span class="token punctuation">></span></span>: cmpq   %rbp, %rbx
bomb[0x400f2c] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+48</span><span class="token punctuation">></span></span>: jne    0x400f17                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+27</span><span class="token punctuation">></span></span>
bomb[0x400f2e] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+50</span><span class="token punctuation">></span></span>: jmp    0x400f3c                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+64</span><span class="token punctuation">></span></span>
bomb[0x400f30] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+52</span><span class="token punctuation">></span></span>: leaq   0x4(%rsp), %rbx
bomb[0x400f35] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+57</span><span class="token punctuation">></span></span>: leaq   0x18(%rsp), %rbp
bomb[0x400f3a] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+62</span><span class="token punctuation">></span></span>: jmp    0x400f17                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+27</span><span class="token punctuation">></span></span>
bomb[0x400f3c] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+64</span><span class="token punctuation">></span></span>: addq   $0x28, %rsp
bomb[0x400f40] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+68</span><span class="token punctuation">></span></span>: popq   %rbx
bomb[0x400f41] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+69</span><span class="token punctuation">></span></span>: popq   %rbp
bomb[0x400f42] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+70</span><span class="token punctuation">></span></span>: retq
</code></pre>
<p>从上述汇编中，可以发现从%rsp位置开始保存数字。</p>
<p>反汇编<code>read_six_numbers</code>得到</p>
<pre class=" language-html"><code class="language-html">bomb`read_six_numbers:
bomb[0x40145c] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+0</span><span class="token punctuation">></span></span>:  subq   $0x18, %rsp
bomb[0x401460] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+4</span><span class="token punctuation">></span></span>:  movq   %rsi, %rdx
bomb[0x401463] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+7</span><span class="token punctuation">></span></span>:  leaq   0x4(%rsi), %rcx
bomb[0x401467] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+11</span><span class="token punctuation">></span></span>: leaq   0x14(%rsi), %rax
bomb[0x40146b] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+15</span><span class="token punctuation">></span></span>: movq   %rax, 0x8(%rsp)
bomb[0x401470] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+20</span><span class="token punctuation">></span></span>: leaq   0x10(%rsi), %rax
bomb[0x401474] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+24</span><span class="token punctuation">></span></span>: movq   %rax, (%rsp)
bomb[0x401478] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+28</span><span class="token punctuation">></span></span>: leaq   0xc(%rsi), %r9
bomb[0x40147c] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+32</span><span class="token punctuation">></span></span>: leaq   0x8(%rsi), %r8
bomb[0x401480] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+36</span><span class="token punctuation">></span></span>: movl   $0x4025c3, %esi
bomb[0x401485] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+41</span><span class="token punctuation">></span></span>: movl   $0x0, %eax
bomb[0x40148a] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+46</span><span class="token punctuation">></span></span>: callq  0x400bf0                  ; symbol stub for: __isoc99_sscanf
bomb[0x40148f] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+51</span><span class="token punctuation">></span></span>: cmpl   $0x5, %eax
bomb[0x401492] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+54</span><span class="token punctuation">></span></span>: jg     0x401499                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+61</span><span class="token punctuation">></span></span>
bomb[0x401494] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+56</span><span class="token punctuation">></span></span>: callq  0x40143a                  ; explode_bomb
bomb[0x401499] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+61</span><span class="token punctuation">></span></span>: addq   $0x18, %rsp
bomb[0x40149d] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+65</span><span class="token punctuation">></span></span>: retq
</code></pre>
<p>根据Phase1,很敏感的会发现<code>movl   $0x4025c3, %esi</code>这行。通过之前一样的方法，得到<code>0x4025c3</code>内存里的字符串，</p>
<pre class=" language-html"><code class="language-html">0x004025c3: "%d %d %d %d %d %d"
</code></pre>
<p>再根据<code>bomb[0x40148a] &lt;+46&gt;: callq  0x400bf0                  ; symbol stub for: __isoc99_sscanf</code>这句，猜一下，立马就能联想到<code>scanf(&quot;%d %d %d %d %d %d&quot;,a,b,c,d,e,f);</code>，也就是说，输入的格式已经确定了。</p>
<p><code>bomb[0x40145c] &lt;+0&gt;:  subq   $0x18, %rsp</code>这行也暗示了之前<code>bomb[0x400f35] &lt;+57&gt;: leaq   0x18(%rsp), %rbp</code>为什么是0x18(%rsp)。</p>
<p>回到<code>phase_2</code>，根据<code>cmpl   $0x1, (%rsp)</code>和下一行汇编语句，很容易知道第一个数是1.<br>接着跳到了<code>&lt;+52&gt;</code>,将0x4(%rsp)指向内存里的值传给%rbx,将0x18(%rsp)指向内存里的值传给%rbp。</p>
<pre class=" language-html"><code class="language-html">bomb[0x400f17] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+27</span><span class="token punctuation">></span></span>: movl   -0x4(%rbx), %eax
bomb[0x400f1a] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+30</span><span class="token punctuation">></span></span>: addl   %eax, %eax
bomb[0x400f1c] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+32</span><span class="token punctuation">></span></span>: cmpl   %eax, (%rbx)
bomb[0x400f1e] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+34</span><span class="token punctuation">></span></span>: je     0x400f25
</code></pre>
<p>这段代码是循环里的部分</p>
<pre class=" language-html"><code class="language-html">bomb[0x400f25] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+41</span><span class="token punctuation">></span></span>: addq   $0x4, %rbx
bomb[0x400f29] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+45</span><span class="token punctuation">></span></span>: cmpq   %rbp, %rbx
bomb[0x400f2c] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+48</span><span class="token punctuation">></span></span>: jne    0x400f17                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+27</span><span class="token punctuation">></span></span>
bomb[0x400f2e] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+50</span><span class="token punctuation">></span></span>: jmp    0x400f3c                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+64</span><span class="token punctuation">></span></span>
</code></pre>
<p>这是循环条件</p>
<p>所以可以得出这6个数是等比数列<code>1 2 4 8 16 32</code></p>
<h2 id="Phase3"><a href="#Phase3" class="headerlink" title="Phase3"></a>Phase3</h2><pre class=" language-html"><code class="language-html">bomb`phase_3:
bomb[0x400f43] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+0</span><span class="token punctuation">></span></span>:   subq   $0x18, %rsp
bomb[0x400f47] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+4</span><span class="token punctuation">></span></span>:   leaq   0xc(%rsp), %rcx
bomb[0x400f4c] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+9</span><span class="token punctuation">></span></span>:   leaq   0x8(%rsp), %rdx
bomb[0x400f51] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+14</span><span class="token punctuation">></span></span>:  movl   $0x4025cf, %esi
bomb[0x400f56] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+19</span><span class="token punctuation">></span></span>:  movl   $0x0, %eax
bomb[0x400f5b] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+24</span><span class="token punctuation">></span></span>:  callq  0x400bf0                  ; symbol stub for: __isoc99_sscanf
bomb[0x400f60] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+29</span><span class="token punctuation">></span></span>:  cmpl   $0x1, %eax
bomb[0x400f63] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+32</span><span class="token punctuation">></span></span>:  jg     0x400f6a                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+39</span><span class="token punctuation">></span></span>
bomb[0x400f65] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+34</span><span class="token punctuation">></span></span>:  callq  0x40143a                  ; explode_bomb
bomb[0x400f6a] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+39</span><span class="token punctuation">></span></span>:  cmpl   $0x7, 0x8(%rsp)
bomb[0x400f6f] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+44</span><span class="token punctuation">></span></span>:  ja     0x400fad                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+106</span><span class="token punctuation">></span></span>
bomb[0x400f71] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+46</span><span class="token punctuation">></span></span>:  movl   0x8(%rsp), %eax
bomb[0x400f75] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+50</span><span class="token punctuation">></span></span>:  jmpq   *0x402470(,%rax,8)
bomb[0x400f7c] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+57</span><span class="token punctuation">></span></span>:  movl   $0xcf, %eax
bomb[0x400f81] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+62</span><span class="token punctuation">></span></span>:  jmp    0x400fbe                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+123</span><span class="token punctuation">></span></span>
bomb[0x400f83] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+64</span><span class="token punctuation">></span></span>:  movl   $0x2c3, %eax
bomb[0x400f88] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+69</span><span class="token punctuation">></span></span>:  jmp    0x400fbe                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+123</span><span class="token punctuation">></span></span>
bomb[0x400f8a] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+71</span><span class="token punctuation">></span></span>:  movl   $0x100, %eax
bomb[0x400f8f] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+76</span><span class="token punctuation">></span></span>:  jmp    0x400fbe                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+123</span><span class="token punctuation">></span></span>
bomb[0x400f91] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+78</span><span class="token punctuation">></span></span>:  movl   $0x185, %eax
bomb[0x400f96] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+83</span><span class="token punctuation">></span></span>:  jmp    0x400fbe                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+123</span><span class="token punctuation">></span></span>
bomb[0x400f98] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+85</span><span class="token punctuation">></span></span>:  movl   $0xce, %eax
bomb[0x400f9d] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+90</span><span class="token punctuation">></span></span>:  jmp    0x400fbe                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+123</span><span class="token punctuation">></span></span>
bomb[0x400f9f] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+92</span><span class="token punctuation">></span></span>:  movl   $0x2aa, %eax
bomb[0x400fa4] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+97</span><span class="token punctuation">></span></span>:  jmp    0x400fbe                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+123</span><span class="token punctuation">></span></span>
bomb[0x400fa6] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+99</span><span class="token punctuation">></span></span>:  movl   $0x147, %eax
bomb[0x400fab] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+104</span><span class="token punctuation">></span></span>: jmp    0x400fbe                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+123</span><span class="token punctuation">></span></span>
bomb[0x400fad] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+106</span><span class="token punctuation">></span></span>: callq  0x40143a                  ; explode_bomb
bomb[0x400fb2] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+111</span><span class="token punctuation">></span></span>: movl   $0x0, %eax
bomb[0x400fb7] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+116</span><span class="token punctuation">></span></span>: jmp    0x400fbe                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+123</span><span class="token punctuation">></span></span>
bomb[0x400fb9] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+118</span><span class="token punctuation">></span></span>: movl   $0x137, %eax
bomb[0x400fbe] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+123</span><span class="token punctuation">></span></span>: cmpl   0xc(%rsp), %eax
bomb[0x400fc2] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+127</span><span class="token punctuation">></span></span>: je     0x400fc9                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+134</span><span class="token punctuation">></span></span>
bomb[0x400fc4] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+129</span><span class="token punctuation">></span></span>: callq  0x40143a                  ; explode_bomb
bomb[0x400fc9] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+134</span><span class="token punctuation">></span></span>: addq   $0x18, %rsp
bomb[0x400fcd] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+138</span><span class="token punctuation">></span></span>: retq
</code></pre>
<p>代码还挺长。</p>
<p>同样，根据<code>bomb[0x400f51] &lt;+14&gt;:  movl   $0x4025cf, %esi</code>可以得到<code>%d %d</code>这个格式，代表要输入两个整数。</p>
<pre class=" language-html"><code class="language-html">bomb[0x400f47] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+4</span><span class="token punctuation">></span></span>:   leaq   0xc(%rsp), %rcx
bomb[0x400f4c] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+9</span><span class="token punctuation">></span></span>:   leaq   0x8(%rsp), %rdx
</code></pre>
<p>这两行代表了两个数存的位置。</p>
<pre class=" language-html"><code class="language-html">bomb[0x400f6a] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+39</span><span class="token punctuation">></span></span>:  cmpl   $0x7, 0x8(%rsp)
bomb[0x400f6f] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+44</span><span class="token punctuation">></span></span>:  ja     0x400fad                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+106</span><span class="token punctuation">></span></span>
</code></pre>
<p>由这两行，可知第一个数要不能大于7,<code>ja</code>是<code>unsigned &gt;</code>，所以第一个数还要是正数。</p>
<p>关键的一行是这个<code>bomb[0x400f75] &lt;+50&gt;:  jmpq   *0x402470(,%rax,8)</code>,这是一个switch跳转语句，跳转到<code>0x402470+ %rax * 8</code>的位置。使用<code>p/x</code>来确定跳转的目的地址。</p>
<pre class=" language-html"><code class="language-html">(gdb) p/x *(0x402470)
$1 = 0x400f7c
(gdb) p/x *(0x402470+8)
$2 = 0x400fb9
(gdb) p/x *(0x402470+16)
$3 = 0x400f83
(gdb) p/x *(0x402470+24)
$4 = 0x400f8a
(gdb) p/x *(0x402470+32)
$5 = 0x400f91
(gdb) p/x *(0x402470+40)
$6 = 0x400f98
(gdb) p/x *(0x402470+48)
$7 = 0x400f9f
(gdb) p/x *(0x402470+56)
$8 = 0x400fa6
</code></pre>
<p>通过这个跳转表，可得得到8个解</p>
<pre class=" language-html"><code class="language-html">0 207
1 311
2 707
3 256
4 389
5 206
6 682
7 327
</code></pre>
<h2 id="Phase4"><a href="#Phase4" class="headerlink" title="Phase4"></a>Phase4</h2><pre class=" language-html"><code class="language-html">bomb`phase_4:
bomb[0x40100c] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+0</span><span class="token punctuation">></span></span>:  subq   $0x18, %rsp
bomb[0x401010] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+4</span><span class="token punctuation">></span></span>:  leaq   0xc(%rsp), %rcx
bomb[0x401015] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+9</span><span class="token punctuation">></span></span>:  leaq   0x8(%rsp), %rdx
bomb[0x40101a] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+14</span><span class="token punctuation">></span></span>: movl   $0x4025cf, %esi
bomb[0x40101f] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+19</span><span class="token punctuation">></span></span>: movl   $0x0, %eax
bomb[0x401024] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+24</span><span class="token punctuation">></span></span>: callq  0x400bf0                  ; symbol stub for: __isoc99_sscanf
bomb[0x401029] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+29</span><span class="token punctuation">></span></span>: cmpl   $0x2, %eax
bomb[0x40102c] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+32</span><span class="token punctuation">></span></span>: jne    0x401035                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+41</span><span class="token punctuation">></span></span>
bomb[0x40102e] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+34</span><span class="token punctuation">></span></span>: cmpl   $0xe, 0x8(%rsp)
bomb[0x401033] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+39</span><span class="token punctuation">></span></span>: jbe    0x40103a                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+46</span><span class="token punctuation">></span></span>
bomb[0x401035] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+41</span><span class="token punctuation">></span></span>: callq  0x40143a                  ; explode_bomb
bomb[0x40103a] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+46</span><span class="token punctuation">></span></span>: movl   $0xe, %edx
bomb[0x40103f] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+51</span><span class="token punctuation">></span></span>: movl   $0x0, %esi
bomb[0x401044] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+56</span><span class="token punctuation">></span></span>: movl   0x8(%rsp), %edi
bomb[0x401048] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+60</span><span class="token punctuation">></span></span>: callq  0x400fce                  ; func4
bomb[0x40104d] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+65</span><span class="token punctuation">></span></span>: testl  %eax, %eax
bomb[0x40104f] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+67</span><span class="token punctuation">></span></span>: jne    0x401058                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+76</span><span class="token punctuation">></span></span>
bomb[0x401051] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+69</span><span class="token punctuation">></span></span>: cmpl   $0x0, 0xc(%rsp)
bomb[0x401056] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+74</span><span class="token punctuation">></span></span>: je     0x40105d                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+81</span><span class="token punctuation">></span></span>
bomb[0x401058] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+76</span><span class="token punctuation">></span></span>: callq  0x40143a                  ; explode_bomb
bomb[0x40105d] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+81</span><span class="token punctuation">></span></span>: addq   $0x18, %rsp
bomb[0x401061] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+85</span><span class="token punctuation">></span></span>: retq
</code></pre>
<p>同样的方式，可以确定第一个整数小于等于14，第二个数为0。</p>
<p>第一个数具体值，需要执行func4。</p>
<p>所以func4的代码</p>
<pre class=" language-html"><code class="language-html">bomb`func4:
bomb[0x400fce] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+0</span><span class="token punctuation">></span></span>:  subq   $0x8, %rsp
bomb[0x400fd2] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+4</span><span class="token punctuation">></span></span>:  movl   %edx, %eax
bomb[0x400fd4] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+6</span><span class="token punctuation">></span></span>:  subl   %esi, %eax
bomb[0x400fd6] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+8</span><span class="token punctuation">></span></span>:  movl   %eax, %ecx
bomb[0x400fd8] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+10</span><span class="token punctuation">></span></span>: shrl   $0x1f, %ecx
bomb[0x400fdb] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+13</span><span class="token punctuation">></span></span>: addl   %ecx, %eax
bomb[0x400fdd] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+15</span><span class="token punctuation">></span></span>: sarl   %eax
bomb[0x400fdf] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+17</span><span class="token punctuation">></span></span>: leal   (%rax,%rsi), %ecx
bomb[0x400fe2] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+20</span><span class="token punctuation">></span></span>: cmpl   %edi, %ecx
bomb[0x400fe4] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+22</span><span class="token punctuation">></span></span>: jle    0x400ff2                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+36</span><span class="token punctuation">></span></span>
bomb[0x400fe6] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+24</span><span class="token punctuation">></span></span>: leal   -0x1(%rcx), %edx
bomb[0x400fe9] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+27</span><span class="token punctuation">></span></span>: callq  0x400fce                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+0</span><span class="token punctuation">></span></span>
bomb[0x400fee] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+32</span><span class="token punctuation">></span></span>: addl   %eax, %eax
bomb[0x400ff0] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+34</span><span class="token punctuation">></span></span>: jmp    0x401007                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+57</span><span class="token punctuation">></span></span>
bomb[0x400ff2] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+36</span><span class="token punctuation">></span></span>: movl   $0x0, %eax
bomb[0x400ff7] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+41</span><span class="token punctuation">></span></span>: cmpl   %edi, %ecx
bomb[0x400ff9] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+43</span><span class="token punctuation">></span></span>: jge    0x401007                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+57</span><span class="token punctuation">></span></span>
bomb[0x400ffb] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+45</span><span class="token punctuation">></span></span>: leal   0x1(%rcx), %esi
bomb[0x400ffe] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+48</span><span class="token punctuation">></span></span>: callq  0x400fce                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+0</span><span class="token punctuation">></span></span>
bomb[0x401003] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+53</span><span class="token punctuation">></span></span>: leal   0x1(%rax,%rax), %eax
bomb[0x401007] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+57</span><span class="token punctuation">></span></span>: addq   $0x8, %rsp
bomb[0x40100b] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+61</span><span class="token punctuation">></span></span>: retq
</code></pre>
<p>仔细看会发现<code>&lt;+20&gt;</code>和<code>&lt;+41&gt;</code>是一样的，而他们的下一行判断正好相反。注意<code>&lt;+24&gt;</code>和<code>&lt;+45&gt;</code>,以及他们的下一行，都很类似。其实就是递归逼近答案。<br>好吧，随便带入一个0,结果发现正好就正确了。所以输入<code>0 0</code>。倒是测试了一下，发现输入<code>1 0</code>或者<code>3 0</code>或者<code>7 0</code>都正确，果然<code>func4</code>还要细看。只能带入func4慢慢推导，这里就不细写了。</p>
<h2 id="Phase5"><a href="#Phase5" class="headerlink" title="Phase5"></a>Phase5</h2><pre class=" language-html"><code class="language-html">bomb`phase_5:
bomb[0x401062] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+0</span><span class="token punctuation">></span></span>:   pushq  %rbx
bomb[0x401063] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+1</span><span class="token punctuation">></span></span>:   subq   $0x20, %rsp
bomb[0x401067] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+5</span><span class="token punctuation">></span></span>:   movq   %rdi, %rbx
bomb[0x40106a] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+8</span><span class="token punctuation">></span></span>:   movq   %fs:0x28, %rax
bomb[0x401073] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+17</span><span class="token punctuation">></span></span>:  movq   %rax, 0x18(%rsp)
bomb[0x401078] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+22</span><span class="token punctuation">></span></span>:  xorl   %eax, %eax
bomb[0x40107a] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+24</span><span class="token punctuation">></span></span>:  callq  0x40131b                  ; string_length
bomb[0x40107f] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+29</span><span class="token punctuation">></span></span>:  cmpl   $0x6, %eax
bomb[0x401082] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+32</span><span class="token punctuation">></span></span>:  je     0x4010d2                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+112</span><span class="token punctuation">></span></span>
bomb[0x401084] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+34</span><span class="token punctuation">></span></span>:  callq  0x40143a                  ; explode_bomb
bomb[0x401089] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+39</span><span class="token punctuation">></span></span>:  jmp    0x4010d2                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+112</span><span class="token punctuation">></span></span>
bomb[0x40108b] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+41</span><span class="token punctuation">></span></span>:  movzbl (%rbx,%rax), %ecx
bomb[0x40108f] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+45</span><span class="token punctuation">></span></span>:  movb   %cl, (%rsp)
bomb[0x401092] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+48</span><span class="token punctuation">></span></span>:  movq   (%rsp), %rdx
bomb[0x401096] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+52</span><span class="token punctuation">></span></span>:  andl   $0xf, %edx
bomb[0x401099] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+55</span><span class="token punctuation">></span></span>:  movzbl 0x4024b0(%rdx), %edx
bomb[0x4010a0] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+62</span><span class="token punctuation">></span></span>:  movb   %dl, 0x10(%rsp,%rax)
bomb[0x4010a4] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+66</span><span class="token punctuation">></span></span>:  addq   $0x1, %rax
bomb[0x4010a8] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+70</span><span class="token punctuation">></span></span>:  cmpq   $0x6, %rax
bomb[0x4010ac] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+74</span><span class="token punctuation">></span></span>:  jne    0x40108b                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+41</span><span class="token punctuation">></span></span>
bomb[0x4010ae] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+76</span><span class="token punctuation">></span></span>:  movb   $0x0, 0x16(%rsp)
bomb[0x4010b3] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+81</span><span class="token punctuation">></span></span>:  movl   $0x40245e, %esi
bomb[0x4010b8] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+86</span><span class="token punctuation">></span></span>:  leaq   0x10(%rsp), %rdi
bomb[0x4010bd] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+91</span><span class="token punctuation">></span></span>:  callq  0x401338                  ; strings_not_equal
bomb[0x4010c2] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+96</span><span class="token punctuation">></span></span>:  testl  %eax, %eax
bomb[0x4010c4] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+98</span><span class="token punctuation">></span></span>:  je     0x4010d9                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+119</span><span class="token punctuation">></span></span>
bomb[0x4010c6] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+100</span><span class="token punctuation">></span></span>: callq  0x40143a                  ; explode_bomb
bomb[0x4010cb] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+105</span><span class="token punctuation">></span></span>: nopl   (%rax,%rax)
bomb[0x4010d0] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+110</span><span class="token punctuation">></span></span>: jmp    0x4010d9                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+119</span><span class="token punctuation">></span></span>
bomb[0x4010d2] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+112</span><span class="token punctuation">></span></span>: movl   $0x0, %eax
bomb[0x4010d7] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+117</span><span class="token punctuation">></span></span>: jmp    0x40108b                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+41</span><span class="token punctuation">></span></span>
bomb[0x4010d9] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+119</span><span class="token punctuation">></span></span>: movq   0x18(%rsp), %rax
bomb[0x4010de] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+124</span><span class="token punctuation">></span></span>: xorq   %fs:0x28, %rax
bomb[0x4010e7] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+133</span><span class="token punctuation">></span></span>: je     0x4010ee                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+140</span><span class="token punctuation">></span></span>
bomb[0x4010e9] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+135</span><span class="token punctuation">></span></span>: callq  0x400b30                  ; symbol stub for: __stack_chk_fail
bomb[0x4010ee] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+140</span><span class="token punctuation">></span></span>: addq   $0x20, %rsp
bomb[0x4010f2] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+144</span><span class="token punctuation">></span></span>: popq   %rbx
bomb[0x4010f3] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+145</span><span class="token punctuation">></span></span>: retq
</code></pre>
<p>这道题挺让人头大的，只能参考一些资料。这里用到了一个逆向工具——radare2。</p>
<p><code>r2 bomb</code></p>
<p>进入radare2</p>
<p>首先执行<code>aaa</code>来初始化。</p>
<p><code>afl</code>是用来标示函数的， 所以使用<code>afl~phase</code>来寻找反汇编中的phase，得到</p>
<pre class=" language-html"><code class="language-html">[0x00400c90]> afl~phase
0x004015c4  149  8  sym.phase_defused
0x00401062  146  9  sym.phase_5
0x00400f43  139  8  sym.phase_3
0x00400ee0  28  3  sym.phase_1
0x004012f6  37  1  sym.invalid_phase
0x00401242  81  5  sym.secret_phase
0x0040100c  86  7  sym.phase_4
0x004010f4  272  26  sym.phase_6
0x00400efc  71  8  sym.phase_2
</code></pre>
<p>使用<code>seek</code>来选择函数,<code>pdf</code>来打印反汇编的函数:</p>
<pre class=" language-html"><code class="language-html">[0x00400c90]> s sym.phase_5
[0x00401062]> pdf
/ (fcn) sym.phase_5 146
|           ; CALL XREF from 0x00400eaa (sym.phase_5)
|           0x00401062      53             push rbx
|           0x00401063      4883ec20       sub rsp, 0x20
|           0x00401067      4889fb         mov rbx, rdi
|           0x0040106a      64488b042528.  mov rax, qword fs:[0x28]    ; [0x28:8]=0x48b8  ; '('
|           0x00401073      4889442418     mov qword [rsp + 0x18], rax
|           0x00401078      31c0           xor eax, eax
|           0x0040107a      e89c020000     call sym.string_length
|           0x0040107f      83f806         cmp eax, 6
|       ,=&lt; 0x00401082      744e           je 0x4010d2                
|       |   0x00401084      e8b1030000     call sym.explode_bomb
|      ,==&lt; 0x00401089      eb47           jmp 0x4010d2               
|      ||   ; JMP XREF from 0x004010d7 (sym.phase_5)
|      ||   ; JMP XREF from 0x004010ac (sym.phase_5)
|    ..---> 0x0040108b      0fb60c03       movzx ecx, byte [rbx + rax]
|    ||||   0x0040108f      880c24         mov byte [rsp], cl
|    ||||   0x00401092      488b1424       mov rdx, qword [rsp]
|    ||||   0x00401096      83e20f         and edx, 0xf
|    ||||   0x00401099      0fb692b02440.  movzx edx, byte [rdx + str.maduiersnfotvbylSo_you_think_you_can_stop_the_bomb_with_ctrl_c__do_you_] ; [0x4024b0:1]=109 LEA obj.array.3449 ; "maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?" @ 0x4024b0
|    ||||   0x004010a0      88540410       mov byte [rsp + rax + 0x10], dl
|    ||||   0x004010a4      4883c001       add rax, 1
|    ||||   0x004010a8      4883f806       cmp rax, 6
|    `====&lt; 0x004010ac      75dd           jne 0x40108b               
|     |||   0x004010ae      c644241600     mov byte [rsp + 0x16], 0
|     |||   0x004010b3      be5e244000     mov esi, str.flyers         ; "flyers" @ 0x40245e
|     |||   0x004010b8      488d7c2410     lea rdi, [rsp + 0x10]       ; 0x10 
|     |||   0x004010bd      e876020000     call sym.strings_not_equal
|     |||   0x004010c2      85c0           test eax, eax
|    ,====&lt; 0x004010c4      7413           je 0x4010d9                
|    ||||   0x004010c6      e86f030000     call sym.explode_bomb
|    ||||   0x004010cb      0f1f440000     nop dword [rax + rax]
|   ,=====&lt; 0x004010d0      eb07           jmp 0x4010d9               
|   |||||   ; JMP XREF from 0x00401089 (sym.phase_5)
|   |||||   ; JMP XREF from 0x00401082 (sym.phase_5)
|   |||``-> 0x004010d2      b800000000     mov eax, 0
|   ||`===&lt; 0x004010d7      ebb2           jmp 0x40108b               
|   ||      ; JMP XREF from 0x004010d0 (sym.phase_5)
|   ||      ; JMP XREF from 0x004010c4 (sym.phase_5)
|   ``----> 0x004010d9      488b442418     mov rax, qword [rsp + 0x18] ; [0x18:8]=0x400c90 section..text
|           0x004010de      644833042528.  xor rax, qword fs:[0x28]
|       ,=&lt; 0x004010e7      7405           je 0x4010ee                
|       |   0x004010e9      e842faffff     call sym.imp.__stack_chk_fail
|       |   ; JMP XREF from 0x004010e7 (sym.phase_5)
|       `-> 0x004010ee      4883c420       add rsp, 0x20
|           0x004010f2      5b             pop rbx
\           0x004010f3      c3             ret
[0x00401062]>
</code></pre>
<p>这题要求输入一个长度为6的字符串，经过一定的变换要得到<code>0x40245e</code>指向的字符串<code>flyers</code>。通过上述的代码，会敏感的发现待转换的字符串在<code>obj.array.3449</code>中，使用如下代码来找到偏移量</p>
<pre class=" language-html"><code class="language-html">[0x00401062]> px 16@obj.array.3449
- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF
0x004024b0  6d61 6475 6965 7273 6e66 6f74 7662 796c  maduiersnfotvbyl
</code></pre>
<p>上面的一个偏移量对应下面的2个字符。</p>
<p>下面将flyers转化为十六进制ascii</p>
<pre class=" language-html"><code class="language-html">[0x00401062]> !rax2 -S flyers
666c79657273
</code></pre>
<p>得到的<code>666c79657273</code>两个一组，找对应的上面的偏移量，可以得到偏移量list<code>[9, 0xF, 0xE, 5, 6, 7]</code></p>
<p>使用python来计算出结果</p>
<pre class=" language-python"><code class="language-python">off <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0xF</span><span class="token punctuation">,</span> <span class="token number">0xE</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>
result <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> off<span class="token punctuation">:</span>
    result <span class="token operator">+=</span> chr<span class="token punctuation">(</span>c <span class="token operator">+</span> <span class="token number">64</span><span class="token punctuation">)</span>

<span class="token keyword">print</span> result
</code></pre>
<p>所以这题的答案是<code>IONEFG</code></p>
<h2 id="Phase6"><a href="#Phase6" class="headerlink" title="Phase6"></a>Phase6</h2><pre class=" language-html"><code class="language-html">bomb`phase_6:
bomb[0x4010f4] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+0</span><span class="token punctuation">></span></span>:   pushq  %r14
bomb[0x4010f6] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+2</span><span class="token punctuation">></span></span>:   pushq  %r13
bomb[0x4010f8] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+4</span><span class="token punctuation">></span></span>:   pushq  %r12
bomb[0x4010fa] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+6</span><span class="token punctuation">></span></span>:   pushq  %rbp
bomb[0x4010fb] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+7</span><span class="token punctuation">></span></span>:   pushq  %rbx
bomb[0x4010fc] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+8</span><span class="token punctuation">></span></span>:   subq   $0x50, %rsp
bomb[0x401100] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+12</span><span class="token punctuation">></span></span>:  movq   %rsp, %r13
bomb[0x401103] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+15</span><span class="token punctuation">></span></span>:  movq   %rsp, %rsi
bomb[0x401106] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+18</span><span class="token punctuation">></span></span>:  callq  0x40145c                  ; read_six_numbers
bomb[0x40110b] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+23</span><span class="token punctuation">></span></span>:  movq   %rsp, %r14
bomb[0x40110e] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+26</span><span class="token punctuation">></span></span>:  movl   $0x0, %r12d
bomb[0x401114] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+32</span><span class="token punctuation">></span></span>:  movq   %r13, %rbp
bomb[0x401117] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+35</span><span class="token punctuation">></span></span>:  movl   (%r13), %eax
bomb[0x40111b] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+39</span><span class="token punctuation">></span></span>:  subl   $0x1, %eax
bomb[0x40111e] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+42</span><span class="token punctuation">></span></span>:  cmpl   $0x5, %eax
bomb[0x401121] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+45</span><span class="token punctuation">></span></span>:  jbe    0x401128                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+52</span><span class="token punctuation">></span></span>
bomb[0x401123] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+47</span><span class="token punctuation">></span></span>:  callq  0x40143a                  ; explode_bomb
bomb[0x401128] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+52</span><span class="token punctuation">></span></span>:  addl   $0x1, %r12d
bomb[0x40112c] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+56</span><span class="token punctuation">></span></span>:  cmpl   $0x6, %r12d
bomb[0x401130] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+60</span><span class="token punctuation">></span></span>:  je     0x401153                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+95</span><span class="token punctuation">></span></span>
bomb[0x401132] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+62</span><span class="token punctuation">></span></span>:  movl   %r12d, %ebx
bomb[0x401135] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+65</span><span class="token punctuation">></span></span>:  movslq %ebx, %rax
bomb[0x401138] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+68</span><span class="token punctuation">></span></span>:  movl   (%rsp,%rax,4), %eax
bomb[0x40113b] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+71</span><span class="token punctuation">></span></span>:  cmpl   %eax, (%rbp)
bomb[0x40113e] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+74</span><span class="token punctuation">></span></span>:  jne    0x401145                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+81</span><span class="token punctuation">></span></span>
bomb[0x401140] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+76</span><span class="token punctuation">></span></span>:  callq  0x40143a                  ; explode_bomb
bomb[0x401145] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+81</span><span class="token punctuation">></span></span>:  addl   $0x1, %ebx
bomb[0x401148] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+84</span><span class="token punctuation">></span></span>:  cmpl   $0x5, %ebx
bomb[0x40114b] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+87</span><span class="token punctuation">></span></span>:  jle    0x401135                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+65</span><span class="token punctuation">></span></span>
bomb[0x40114d] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+89</span><span class="token punctuation">></span></span>:  addq   $0x4, %r13
bomb[0x401151] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+93</span><span class="token punctuation">></span></span>:  jmp    0x401114                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+32</span><span class="token punctuation">></span></span>
bomb[0x401153] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+95</span><span class="token punctuation">></span></span>:  leaq   0x18(%rsp), %rsi
bomb[0x401158] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+100</span><span class="token punctuation">></span></span>: movq   %r14, %rax
bomb[0x40115b] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+103</span><span class="token punctuation">></span></span>: movl   $0x7, %ecx
bomb[0x401160] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+108</span><span class="token punctuation">></span></span>: movl   %ecx, %edx
bomb[0x401162] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+110</span><span class="token punctuation">></span></span>: subl   (%rax), %edx
bomb[0x401164] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+112</span><span class="token punctuation">></span></span>: movl   %edx, (%rax)
bomb[0x401166] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+114</span><span class="token punctuation">></span></span>: addq   $0x4, %rax
bomb[0x40116a] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+118</span><span class="token punctuation">></span></span>: cmpq   %rsi, %rax
bomb[0x40116d] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+121</span><span class="token punctuation">></span></span>: jne    0x401160                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+108</span><span class="token punctuation">></span></span>
bomb[0x40116f] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+123</span><span class="token punctuation">></span></span>: movl   $0x0, %esi
bomb[0x401174] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+128</span><span class="token punctuation">></span></span>: jmp    0x401197                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+163</span><span class="token punctuation">></span></span>
bomb[0x401176] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+130</span><span class="token punctuation">></span></span>: movq   0x8(%rdx), %rdx
bomb[0x40117a] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+134</span><span class="token punctuation">></span></span>: addl   $0x1, %eax
bomb[0x40117d] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+137</span><span class="token punctuation">></span></span>: cmpl   %ecx, %eax
bomb[0x40117f] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+139</span><span class="token punctuation">></span></span>: jne    0x401176                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+130</span><span class="token punctuation">></span></span>
bomb[0x401181] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+141</span><span class="token punctuation">></span></span>: jmp    0x401188                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+148</span><span class="token punctuation">></span></span>
bomb[0x401183] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+143</span><span class="token punctuation">></span></span>: movl   $0x6032d0, %edx
bomb[0x401188] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+148</span><span class="token punctuation">></span></span>: movq   %rdx, 0x20(%rsp,%rsi,2)
bomb[0x40118d] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+153</span><span class="token punctuation">></span></span>: addq   $0x4, %rsi
bomb[0x401191] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+157</span><span class="token punctuation">></span></span>: cmpq   $0x18, %rsi
bomb[0x401195] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+161</span><span class="token punctuation">></span></span>: je     0x4011ab                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+183</span><span class="token punctuation">></span></span>
bomb[0x401197] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+163</span><span class="token punctuation">></span></span>: movl   (%rsp,%rsi), %ecx
bomb[0x40119a] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+166</span><span class="token punctuation">></span></span>: cmpl   $0x1, %ecx
bomb[0x40119d] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+169</span><span class="token punctuation">></span></span>: jle    0x401183                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+143</span><span class="token punctuation">></span></span>
bomb[0x40119f] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+171</span><span class="token punctuation">></span></span>: movl   $0x1, %eax
bomb[0x4011a4] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+176</span><span class="token punctuation">></span></span>: movl   $0x6032d0, %edx
bomb[0x4011a9] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+181</span><span class="token punctuation">></span></span>: jmp    0x401176                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+130</span><span class="token punctuation">></span></span>
bomb[0x4011ab] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+183</span><span class="token punctuation">></span></span>: movq   0x20(%rsp), %rbx
bomb[0x4011b0] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+188</span><span class="token punctuation">></span></span>: leaq   0x28(%rsp), %rax
bomb[0x4011b5] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+193</span><span class="token punctuation">></span></span>: leaq   0x50(%rsp), %rsi
bomb[0x4011ba] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+198</span><span class="token punctuation">></span></span>: movq   %rbx, %rcx
bomb[0x4011bd] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+201</span><span class="token punctuation">></span></span>: movq   (%rax), %rdx
bomb[0x4011c0] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+204</span><span class="token punctuation">></span></span>: movq   %rdx, 0x8(%rcx)
bomb[0x4011c4] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+208</span><span class="token punctuation">></span></span>: addq   $0x8, %rax
bomb[0x4011c8] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+212</span><span class="token punctuation">></span></span>: cmpq   %rsi, %rax
bomb[0x4011cb] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+215</span><span class="token punctuation">></span></span>: je     0x4011d2                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+222</span><span class="token punctuation">></span></span>
bomb[0x4011cd] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+217</span><span class="token punctuation">></span></span>: movq   %rdx, %rcx
bomb[0x4011d0] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+220</span><span class="token punctuation">></span></span>: jmp    0x4011bd                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+201</span><span class="token punctuation">></span></span>
bomb[0x4011d2] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+222</span><span class="token punctuation">></span></span>: movq   $0x0, 0x8(%rdx)
bomb[0x4011da] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+230</span><span class="token punctuation">></span></span>: movl   $0x5, %ebp
bomb[0x4011df] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+235</span><span class="token punctuation">></span></span>: movq   0x8(%rbx), %rax
bomb[0x4011e3] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+239</span><span class="token punctuation">></span></span>: movl   (%rax), %eax
bomb[0x4011e5] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+241</span><span class="token punctuation">></span></span>: cmpl   %eax, (%rbx)
bomb[0x4011e7] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+243</span><span class="token punctuation">></span></span>: jge    0x4011ee                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+250</span><span class="token punctuation">></span></span>
bomb[0x4011e9] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+245</span><span class="token punctuation">></span></span>: callq  0x40143a                  ; explode_bomb
bomb[0x4011ee] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+250</span><span class="token punctuation">></span></span>: movq   0x8(%rbx), %rbx
bomb[0x4011f2] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+254</span><span class="token punctuation">></span></span>: subl   $0x1, %ebp
bomb[0x4011f5] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+257</span><span class="token punctuation">></span></span>: jne    0x4011df                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+235</span><span class="token punctuation">></span></span>
bomb[0x4011f7] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+259</span><span class="token punctuation">></span></span>: addq   $0x50, %rsp
bomb[0x4011fb] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+263</span><span class="token punctuation">></span></span>: popq   %rbx
bomb[0x4011fc] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+264</span><span class="token punctuation">></span></span>: popq   %rbp
bomb[0x4011fd] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+265</span><span class="token punctuation">></span></span>: popq   %r12
bomb[0x4011ff] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+267</span><span class="token punctuation">></span></span>: popq   %r13
bomb[0x401201] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+269</span><span class="token punctuation">></span></span>: popq   %r14
bomb[0x401203] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+271</span><span class="token punctuation">></span></span>: retq
</code></pre>
<p>代码虽然很长，其实使用<code>stepi</code>还是挺容易弄懂的。首先读取6个数字，并且各不相同。然后，在<code>0x6032d0</code>位置有一个链表，读取这链表的值。</p>
<pre class=" language-html"><code class="language-html">(gdb)x/32wx 0x6032d0
</code></pre>
<p>当然使用radare2很容易发现这里的链表，</p>
<pre class=" language-html"><code class="language-html">[0x004010f4]> pxw 96@obj.node1
0x006032d0  0x0000014c 0x00000001 0x006032e0 0x00000000  L........2`.....
0x006032e0  0x000000a8 0x00000002 0x006032f0 0x00000000  .........2`.....
0x006032f0  0x0000039c 0x00000003 0x00603300 0x00000000  .........3`.....
0x00603300  0x000002b3 0x00000004 0x00603310 0x00000000  .........3`.....
0x00603310  0x000001dd 0x00000005 0x00603320 0x00000000  ........ 3`.....
0x00603320  0x000001bb 0x00000006 0x00000000 0x00000000  ................
</code></pre>
<p>另外，对于读入的数，这里存在一个操作</p>
<pre class=" language-html"><code class="language-html">bomb[0x40115b] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+103</span><span class="token punctuation">></span></span>: movl   $0x7, %ecx
bomb[0x401160] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+108</span><span class="token punctuation">></span></span>: movl   %ecx, %edx
bomb[0x401162] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+110</span><span class="token punctuation">></span></span>: subl   (%rax), %edx
</code></pre>
<p>是的，用7来减每个数并保存。</p>
<p>在这个地方</p>
<pre class=" language-html"><code class="language-html">bomb[0x4011e5] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+241</span><span class="token punctuation">></span></span>: cmpl   %eax, (%rbx)
bomb[0x4011e7] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+243</span><span class="token punctuation">></span></span>: jge    0x4011ee                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+250</span><span class="token punctuation">></span></span>
</code></pre>
<p>这里暗示节点顺序需要时递减。</p>
<p>所以节点重排应该是<code>3 4 5 6 1 2</code>,考虑之前的7减操作，最终的答案是<code>4 3 2 1 6 5</code></p>
<h2 id="Secret_phase"><a href="#Secret_phase" class="headerlink" title="Secret phase"></a>Secret phase</h2><p>这时候说Congratulations!还稍微早了些，这个还暗藏了一个秘密关卡，藏在了phase_defused中。</p>
<p>首先要在phase_defused函数打断点， 另外反汇编出<code>phase_defused</code>，可以发现</p>
<pre class=" language-html"><code class="language-html">Dump of assembler code for function phase_defused:
   0x00000000004015c4 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+0</span><span class="token punctuation">></span></span>:    sub    $0x78,%rsp
   0x00000000004015c8 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+4</span><span class="token punctuation">></span></span>:    mov    %fs:0x28,%rax
   0x00000000004015d1 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+13</span><span class="token punctuation">></span></span>:    mov    %rax,0x68(%rsp)
   0x00000000004015d6 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+18</span><span class="token punctuation">></span></span>:    xor    %eax,%eax
   0x00000000004015d8 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+20</span><span class="token punctuation">></span></span>:    cmpl   $0x6,0x202181(%rip)        # 0x603760 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>num_input_strings</span><span class="token punctuation">></span></span>
   0x00000000004015df <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+27</span><span class="token punctuation">></span></span>:    jne    0x40163f <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase_defused+123</span><span class="token punctuation">></span></span>
   0x00000000004015e1 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+29</span><span class="token punctuation">></span></span>:    lea    0x10(%rsp),%r8
   0x00000000004015e6 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+34</span><span class="token punctuation">></span></span>:    lea    0xc(%rsp),%rcx
   0x00000000004015eb <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+39</span><span class="token punctuation">></span></span>:    lea    0x8(%rsp),%rdx
   0x00000000004015f0 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+44</span><span class="token punctuation">></span></span>:    mov    $0x402619,%esi
   0x00000000004015f5 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+49</span><span class="token punctuation">></span></span>:    mov    $0x603870,%edi
   0x00000000004015fa <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+54</span><span class="token punctuation">></span></span>:    callq  0x400bf0 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>__isoc99_sscanf@plt</span><span class="token punctuation">></span></span>
   0x00000000004015ff <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+59</span><span class="token punctuation">></span></span>:    cmp    $0x3,%eax
   0x0000000000401602 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+62</span><span class="token punctuation">></span></span>:    jne    0x401635 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase_defused+113</span><span class="token punctuation">></span></span>
   0x0000000000401604 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+64</span><span class="token punctuation">></span></span>:    mov    $0x402622,%esi
   0x0000000000401609 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+69</span><span class="token punctuation">></span></span>:    lea    0x10(%rsp),%rdi
   0x000000000040160e <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+74</span><span class="token punctuation">></span></span>:    callq  0x401338 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strings_not_equal</span><span class="token punctuation">></span></span>
   0x0000000000401613 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+79</span><span class="token punctuation">></span></span>:    test   %eax,%eax
   0x0000000000401615 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+81</span><span class="token punctuation">></span></span>:    jne    0x401635 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase_defused+113</span><span class="token punctuation">></span></span>
   0x0000000000401617 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+83</span><span class="token punctuation">></span></span>:    mov    $0x4024f8,%edi
   0x000000000040161c <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+88</span><span class="token punctuation">></span></span>:    callq  0x400b10 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>puts@plt</span><span class="token punctuation">></span></span>
   0x0000000000401621 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+93</span><span class="token punctuation">></span></span>:    mov    $0x402520,%edi
   0x0000000000401626 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+98</span><span class="token punctuation">></span></span>:    callq  0x400b10 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>puts@plt</span><span class="token punctuation">></span></span>
   0x000000000040162b <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+103</span><span class="token punctuation">></span></span>:    mov    $0x0,%eax
   0x0000000000401630 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+108</span><span class="token punctuation">></span></span>:    callq  0x401242 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>secret_phase</span><span class="token punctuation">></span></span>
   0x0000000000401635 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+113</span><span class="token punctuation">></span></span>:    mov    $0x402558,%edi
   0x000000000040163a <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+118</span><span class="token punctuation">></span></span>:    callq  0x400b10 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>puts@plt</span><span class="token punctuation">></span></span>
   0x000000000040163f <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+123</span><span class="token punctuation">></span></span>:    mov    0x68(%rsp),%rax
   0x0000000000401644 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+128</span><span class="token punctuation">></span></span>:    xor    %fs:0x28,%rax
   0x000000000040164d <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+137</span><span class="token punctuation">></span></span>:    je     0x401654 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase_defused+144</span><span class="token punctuation">></span></span>
   0x000000000040164f <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+139</span><span class="token punctuation">></span></span>:    callq  0x400b30 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>__stack_chk_fail@plt</span><span class="token punctuation">></span></span>
   0x0000000000401654 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+144</span><span class="token punctuation">></span></span>:    add    $0x78,%rsp
   0x0000000000401658 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+148</span><span class="token punctuation">></span></span>:    retq
</code></pre>
<p>其中<code>secret_phase</code>的源码</p>
<pre class=" language-html"><code class="language-html">Dump of assembler code for function secret_phase:
=> 0x0000000000401242 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+0</span><span class="token punctuation">></span></span>:    push   %rbx
   0x0000000000401243 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+1</span><span class="token punctuation">></span></span>:    callq  0x40149e <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>read_line</span><span class="token punctuation">></span></span>
   0x0000000000401248 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+6</span><span class="token punctuation">></span></span>:    mov    $0xa,%edx
   0x000000000040124d <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+11</span><span class="token punctuation">></span></span>:    mov    $0x0,%esi
   0x0000000000401252 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+16</span><span class="token punctuation">></span></span>:    mov    %rax,%rdi
   0x0000000000401255 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+19</span><span class="token punctuation">></span></span>:    callq  0x400bd0 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strtol@plt</span><span class="token punctuation">></span></span>
   0x000000000040125a <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+24</span><span class="token punctuation">></span></span>:    mov    %rax,%rbx
   0x000000000040125d <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+27</span><span class="token punctuation">></span></span>:    lea    -0x1(%rax),%eax
   0x0000000000401260 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+30</span><span class="token punctuation">></span></span>:    cmp    $0x3e8,%eax
   0x0000000000401265 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+35</span><span class="token punctuation">></span></span>:    jbe    0x40126c <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>secret_phase+42</span><span class="token punctuation">></span></span>
   0x0000000000401267 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+37</span><span class="token punctuation">></span></span>:    callq  0x40143a <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>explode_bomb</span><span class="token punctuation">></span></span>
   0x000000000040126c <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+42</span><span class="token punctuation">></span></span>:    mov    %ebx,%esi
   0x000000000040126e <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+44</span><span class="token punctuation">></span></span>:    mov    $0x6030f0,%edi
   0x0000000000401273 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+49</span><span class="token punctuation">></span></span>:    callq  0x401204 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fun7</span><span class="token punctuation">></span></span>
   0x0000000000401278 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+54</span><span class="token punctuation">></span></span>:    cmp    $0x2,%eax
   0x000000000040127b <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+57</span><span class="token punctuation">></span></span>:    je     0x401282 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>secret_phase+64</span><span class="token punctuation">></span></span>
   0x000000000040127d <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+59</span><span class="token punctuation">></span></span>:    callq  0x40143a <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>explode_bomb</span><span class="token punctuation">></span></span>
   0x0000000000401282 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+64</span><span class="token punctuation">></span></span>:    mov    $0x402438,%edi
   0x0000000000401287 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+69</span><span class="token punctuation">></span></span>:    callq  0x400b10 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>puts@plt</span><span class="token punctuation">></span></span>
   0x000000000040128c <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+74</span><span class="token punctuation">></span></span>:    callq  0x4015c4 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase_defused</span><span class="token punctuation">></span></span>
   0x0000000000401291 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+79</span><span class="token punctuation">></span></span>:    pop    %rbx
   0x0000000000401292 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+80</span><span class="token punctuation">></span></span>:    retq
</code></pre>
<p>其中，<code>fun7</code>的返回值和2进行了比较，相等则正确，所以可以确定<code>fun7</code>一定要返回2。跳转到<code>fun7</code></p>
<pre class=" language-html"><code class="language-html">bomb`fun7:
bomb[0x401204] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+0</span><span class="token punctuation">></span></span>:  subq   $0x8, %rsp
bomb[0x401208] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+4</span><span class="token punctuation">></span></span>:  testq  %rdi, %rdi
bomb[0x40120b] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+7</span><span class="token punctuation">></span></span>:  je     0x401238                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+52</span><span class="token punctuation">></span></span>
bomb[0x40120d] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+9</span><span class="token punctuation">></span></span>:  movl   (%rdi), %edx
bomb[0x40120f] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+11</span><span class="token punctuation">></span></span>: cmpl   %esi, %edx
bomb[0x401211] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+13</span><span class="token punctuation">></span></span>: jle    0x401220                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+28</span><span class="token punctuation">></span></span>
bomb[0x401213] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+15</span><span class="token punctuation">></span></span>: movq   0x8(%rdi), %rdi
bomb[0x401217] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+19</span><span class="token punctuation">></span></span>: callq  0x401204                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+0</span><span class="token punctuation">></span></span>
bomb[0x40121c] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+24</span><span class="token punctuation">></span></span>: addl   %eax, %eax
bomb[0x40121e] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+26</span><span class="token punctuation">></span></span>: jmp    0x40123d                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+57</span><span class="token punctuation">></span></span>
bomb[0x401220] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+28</span><span class="token punctuation">></span></span>: movl   $0x0, %eax
bomb[0x401225] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+33</span><span class="token punctuation">></span></span>: cmpl   %esi, %edx
bomb[0x401227] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+35</span><span class="token punctuation">></span></span>: je     0x40123d                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+57</span><span class="token punctuation">></span></span>
bomb[0x401229] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+37</span><span class="token punctuation">></span></span>: movq   0x10(%rdi), %rdi
bomb[0x40122d] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+41</span><span class="token punctuation">></span></span>: callq  0x401204                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+0</span><span class="token punctuation">></span></span>
bomb[0x401232] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+46</span><span class="token punctuation">></span></span>: leal   0x1(%rax,%rax), %eax
bomb[0x401236] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+50</span><span class="token punctuation">></span></span>: jmp    0x40123d                  ; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+57</span><span class="token punctuation">></span></span>
bomb[0x401238] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+52</span><span class="token punctuation">></span></span>: movl   $0xffffffff, %eax
bomb[0x40123d] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+57</span><span class="token punctuation">></span></span>: addq   $0x8, %rsp
bomb[0x401241] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>+61</span><span class="token punctuation">></span></span>: retq
</code></pre>
<p>可以根据上面的代码，写出C语言的递归函数:</p>
<pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">//这里假设%rdi为x, %esi为y</span>

<span class="token keyword">int</span> <span class="token function">fun7</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>x <span class="token operator">-</span> y <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ret <span class="token operator">=</span> <span class="token function">fun7</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ret <span class="token operator">=</span> ret <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>x <span class="token operator">==</span> y<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        ret <span class="token operator">=</span> <span class="token function">fun7</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">0x8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ret <span class="token operator">*</span><span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>那么，为了让fun7返回得到2，需要执行三次递归。</p>
<pre class=" language-html"><code class="language-html">2 = 2 * 1
1 = 2 * 0 + 1
0 = 0
</code></pre>
<p>所以可以得知%rdi也就是0x6030f0这个地址进行了2次增加。递归最深处得到(%rdi)和%rsi相等。用0x6030f0增加(0x8+0x10),得到<code>0x16</code>,转化为十进制就是答案<code>22</code>.</p>
<p><img src="suc.png" alt=""></p>
<h1 id="u6700_u540E"><a href="#u6700_u540E" class="headerlink" title="最后"></a>最后</h1><p>通过不到两天的思考，虽然不是很容易，经过各种查资料和思考，最终完成了这个lab。第三章节的结束，也是第四章的开始，路漫漫其修远兮，吾将上下而求索。</p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    


    <!-- 使用 DISQUS -->
    <div id="disqus-comment">
        <div id="disqus_thread"></div>
<script>
    queue.offer(function() {
            var disqus_config = function () {
                this.page.url = 'http://xinqiu.me/2016/02/10/csapp-lab2-bomb/index.html';  // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
            };

            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document;
                var s = d.createElement('script');
                s.src = '//xinqiu.disqus.com/embed.js';
                s.setAttribute('data-timestamp', + new Date());
                (d.head || d.body).appendChild(s);
            })();
        });
</script>

    </div>
    <style>
        #disqus-comment{
            background-color: #eee;
            padding: 2pc;
        }
    </style>



                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2016/03/12/csi-start/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            Newer
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2016/01/01/Dairy-5/" id="post_nav-older" class="next-content">
            Older
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/snow_square.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Xin Qiu's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        xinqiu.94@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                Home
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    Archives
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/03/">March 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">February 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">January 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">December 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">October 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">August 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">July 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">June 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">May 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">April 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">March 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/02/">February 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">January 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/12/">December 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/11/">November 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/10/">October 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/09/">September 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/08/">August 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/07/">July 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">June 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/05/">May 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/03/">March 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/02/">February 2015<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/01/">January 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/12/">December 2014<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    
        <li>
            <a href="/about" title="About">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                About
            </a>
        </li>
        
    
        <li>
            <a href="/projects" title="Projects">
                
                    <i class="material-icons sidebar-material-icons">build</i>
                
                Projects
            </a>
        </li>
        
    
        <li>
            <a href="/reading-list" title="Reading">
                
                    <i class="material-icons sidebar-material-icons">book</i>
                
                Reading
            </a>
        </li>
        
    
        <li>
            <a href="/timeline" title="Timeline">
                
                    <i class="material-icons sidebar-material-icons">timeline</i>
                
                Timeline
            </a>
        </li>
        
    
        <li>
            <a href="/tags" title="Tags">
                
                    <i class="material-icons sidebar-material-icons">bookmark border</i>
                
                Tags
            </a>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                Number of articles
                <span class="sidebar-badge">44</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/xinqiu" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;一人Code
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->
<script src="/js/lazyload.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>





    <!-- Leancloud -->
    <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
    <script>
        AV.initialize('wNFmCWTd6GAdUBwK4C35gD2G-gzGzoHsz', 'fkjBgbCuEaEEKpksFNIkGYsk');
    </script>
    <script>
    function showTime(Counter) {
        var query = new AV.Query(Counter);
        $('.leancloud-views_num').each(function() {
            var url = $(this).attr('id').trim();
            query.equalTo('url', url);
            query.find({
                success: function(results) {
                    if (results.length === 0) {
                        var content = '0 ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                        return;
                    }
                    for (var i = 0; i < results.length; i++) {
                        var object = results[i];
                        var content = object.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    }
                },
                error: function(object, error) {
                    console.log('Error: ' + error.code + ' ' + error.message);
                }
            });
        });
    }

    function addCount(Counter) {
      var Counter = AV.Object.extend('Counter');
      url = $('.leancloud-views_num').attr('id').trim();
      title = $('.leancloud-views_num').attr('data-flag-title').trim();
      var query = new AV.Query(Counter);
      query.equalTo('url', url);
      query.find({
          success: function(results) {
            if (results.length > 0) {
                var counter = results[0];
                counter.fetchWhenSave(true);
                counter.increment('time');
                counter.save(null, {
                    success: function(counter) {
                        var content =  counter.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    },
                    error: function(counter, error) {
                        console.log('Failed to save Visitor num, with error message: ' + error.message);
                    }
                });
            } else {
              var newcounter = new Counter();
              newcounter.set('title', title);
              newcounter.set('url', url);
              newcounter.set('time', 1);
              newcounter.save(null, {
                  success: function(newcounter) {
                      console.log('newcounter.get(\'time\')='+newcounter.get('time'));
                      var content = newcounter.get('time') + ' ' + $(document.getElementById(url)).text();
                      $(document.getElementById(url)).text(content);
                  },
                  error: function(newcounter, error) {
                      console.log('Failed to create');
                  }
              });
            }
        },
        error: function(error) {
            console.log('Error:' + error.code + ' ' + error.message);
        }
      });
    }
    $(function() {
        var Counter = AV.Object.extend('Counter');
        if ($('.leancloud-views_num').length === 1) {
            addCount(Counter);
        } else if ($('.post-title-link').length > 1) {
            showTime(Counter);
        }
    });
</script>








    <!-- 使用 DISQUS js 代码 -->
    <script id="dsq-count-scr" src="//xinqiu.disqus.com/count.js" async></script>



<!-- Swiftye -->


<!-- Local Search-->

    <script>
    var searchFunc = function(path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: 'xml',
            success: function( xmlResponse ) {
                // get the contents from search data
                var datas = $( 'entry', xmlResponse ).map(function() {
                    return {
                        title: $( 'title', this ).text(),
                        content: $('content',this).text(),
                        url: $( 'url' , this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function() {
                    var str='<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = '';
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function(data) {
                        var isMatch = true;
                        var content_index = [];
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g,'').toLowerCase();
                        var data_url = data.url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if(data_title !== '' && data_content !== '') {
                            keywords.forEach(function(keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if( index_title < 0 && index_content < 0 ) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += '<li><a href="'+ data_url +'" class="search-result-title" target="_blank">'+ data_title;
                            var content = data.content.trim().replace(/<[^>]+>/g, '');
                            if (first_occur >= 0) {
                                // cut out characters
                                var start = first_occur - 6;
                                var end = first_occur + 6;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 10;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, 'gi');
                                    match_content = match_content.replace(regS, '<em class="search-keyword">'+keyword+'</em>');
                                })
                                str += '<p class="search-result">' + match_content + '...</p>' +'</a>';
                            }
                        }
                    });
                    $resultContent.innerHTML = str;
                });
            }
        });
    }
</script>


    <script>
        var inputArea = document.querySelector('#search');
        var getSearchFile = function() {
            var path = 'search.xml';
            searchFunc(path, 'search', 'local-search-result');
        }

        if(inputArea) {
            inputArea.onfocus = function() {
                getSearchFile();
            }
        }
    </script>


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->


                </main>
            </div>
        </body>
    
</html>
