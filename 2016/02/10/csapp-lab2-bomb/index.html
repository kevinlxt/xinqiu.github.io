<!DOCTYPE html>
<html>
    <head>
    <!-- Title -->
    
    <title>
        CSAPP Lab2 解题分析 | 一人Code
    </title>
    
    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">
    
    <!-- Meta & INfo -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Xin Qiu">
    <meta name="description" content="写给自己的Blog">
    <meta name="keywords" content="null">
    
    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">
    
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="一人Code">
    
    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://xinqiu.me">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="CSAPP Lab2 解题分析 | 一人Code">
    <meta property="og:description" content="写给自己的Blog">
    
     <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">
        
        
            <script src="/js/ie-blocker.en.js"></script>
        
    <![endif]-->
    
    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
	body, html{
		font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
	}
	
    a{
        color: #00838F
    }
    
    .mdl-card__media,
    #search-label,
    #search-form-label:after,
    #scheme-Paradox .hot_tags-count,
    #scheme-Paradox .sidebar_archives-count,
    #scheme-Paradox .sidebar-colored .sidebar-header,
    #scheme-Paradox .sidebar-colored .sidebar-badge{
        background-color: #0097A7 !important
    }
    
	/* Sidebar User Drop Down Menu Text Color */
	#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
    #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus{
        color: #0097A7 !important
    }
    
    #post_entry-right-info,
    .sidebar-colored .sidebar-nav li:hover > a,
    .sidebar-colored .sidebar-nav li:hover > a i,
    .sidebar-colored .sidebar-nav li > a:hover,
    .sidebar-colored .sidebar-nav li > a:hover i,
    .sidebar-colored .sidebar-nav li > a:focus i,
    .sidebar-colored .sidebar-nav > .open > a,
    .sidebar-colored .sidebar-nav > .open > a:hover,
    .sidebar-colored .sidebar-nav > .open > a:focus,
    #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a{
        color: #0097A7 !important
    }
    
    .toTop{
        background: #757575 !important
    }
		
	.material-layout .material-post>.material-nav,
	.material-layout .material-index>.material-nav,
	.material-nav a{
		color: #757575;
	}
		
	#scheme-Paradox .MD-burger-layer {
		background-color: #757575;
	}

	#scheme-Paradox #post-toc-trigger-btn{
		color: #757575;
	}
	
	.post-toc a:hover{
		color: #00838F;
		text-decoration: underline;
	}
</style>


<!-- Theme Background Related-->

    <style>
        body{
            background-color: #F5F5F5
        }
		
		/* blog_info bottom background */
        #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
            background-color: #fff;
        }
    </style>




<!-- Fade Effect -->

    <style>
        .fade {
            transition: all 800ms linear;
            -webkit-transform: translate3d(0,0,0);
            -moz-transform: translate3d(0,0,0);
            -ms-transform: translate3d(0,0,0);
            -o-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
            opacity: 1;
        }

        .fade.out{
            opacity: 0;
        }
    </style>

	<script src="/js/jquery.min.js"></script>
	
	<!-- UC Browser Compatible-->
	<script>
		var agent = navigator.userAgent.toLowerCase();
		if(agent.indexOf('ucbrowser')>0) {
			document.write('<link rel="stylesheet" href="/css/uc.css">');
		   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
		}
	</script>
    
    <!-- Custom Head -->
    
</head>
	
	

    <body id="scheme-Paradox">

		
        <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
				
			
			
            <!-- Main Container -->
            <main class="material-layout__content" id="main">
				
                <!-- Top Anchor -->
                <div id="top"></div>
				
				
                <!-- Hamburger Button -->
                <button class="MD-burger-icon sidebar-toggle">
                    <span class="MD-burger-layer"></span>
                </button>
				
				
                
	<!-- Back Button -->
<!--
	<div class="material-back" id="backhome-div" tabindex="0">
		<a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" href="#" onclick="window.history.back();return false;" target="_self" role="button" data-upgraded=",MaterialButton,MaterialRipple">
			<i class="material-icons" role="presentation">arrow_back</i>
			<span class="mdl-button__ripple-container">
				<span class="mdl-ripple"></span>
			</span>
		</a>
	</div>			
-->
	<!-- Left aligned menu below button -->
	<button id="post-toc-trigger-btn"
			class="mdl-button mdl-js-button mdl-button--icon">
	  <i class="material-icons">format_list_numbered</i>
	</button>

	<ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect"
		for="post-toc-trigger-btn">
			
			<ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Phase1"><span class="post-toc-number">1.</span> <span class="post-toc-text">Phase1</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Phase2"><span class="post-toc-number">2.</span> <span class="post-toc-text">Phase2</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Phase3"><span class="post-toc-number">3.</span> <span class="post-toc-text">Phase3</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Phase4"><span class="post-toc-number">4.</span> <span class="post-toc-text">Phase4</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Phase5"><span class="post-toc-number">5.</span> <span class="post-toc-text">Phase5</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Phase6"><span class="post-toc-number">6.</span> <span class="post-toc-text">Phase6</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Secret_phase"><span class="post-toc-number">7.</span> <span class="post-toc-text">Secret phase</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#u6700_u540E"><span class="post-toc-number"></span> <span class="post-toc-text">最后</span></a>
		
<!--			<li class="mdl-menu__item">Some Action</li>-->
	</ul>


<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">
		
        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
	<!-- Paradox Post Header -->
	
		
			<!-- Random Thumbnail -->
			<div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
				<script>
    
    var randomNum;
    randomNum = Math.floor(Math.random() * 5 + 1);
    
    $(".post_thumbnail-random").css('background-image', 'url(' + '/img/random/' + randomNum + '.png' + ')');
    
</script>

		
	
        <p class="article-headline-p">
            CSAPP Lab2 解题分析
        </p>
    </div>

	

				
				
					<!-- Paradox Post Info -->
					<div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
    
    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Xin Qiu</strong>
        <span>Feb 10, 2016</span>
    </div>
    
    <div class="section-spacer"></div>
	
    <!-- Favorite -->
<!--
    <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
        <i class="material-icons" role="presentation">favorite</i>
        <span class="visuallyhidden">favorites</span>
    </button>
-->
    
    <!-- Tags (bookmark) -->
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/csapp/">csapp</a>
    </ul>
    
    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    
    <!-- Leancloud Views -->
    <a class="post_share-link" href="#">
        <li class="mdl-menu__item">
            <span id="/2016/02/10/csapp-lab2-bomb/" class="leancloud-views_num" data-flag-title="CSAPP Lab2 解题分析">
     &nbsp;Views
</span>
        </li>
    </a>
    
    
    
    
    <!-- Share Twitter -->
    <a class="post_share-link" href="https://twitter.com/intent/tweet?text=CSAPP Lab2 解题分析&url=http://xinqiu.me//2016/02/10/csapp-lab2-bomb/index.html&via=Xin Qiu" target="_blank">
        <li class="mdl-menu__item">
            Share to Twitter
        </li>
    </a>
    
    <!-- Share Google+ -->
    <a class="post_share-link" href="https://plus.google.com/share?url=http://xinqiu.me//2016/02/10/csapp-lab2-bomb/index.html" target="_blank">
        <li class="mdl-menu__item">
            Share to Google+
        </li>
    </a>
    
    <!-- Share Weibo -->
    <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=CSAPP Lab2 解题分析&url=http://xinqiu.me//2016/02/10/csapp-lab2-bomb/index.html&pic=&searchPic=false&style=simple" target="_blank">
        <li class="mdl-menu__item">
            Share to Weibo
        </li>
    </a>
</ul>
</div>
				

                <!-- Post Content -->
                <div id="post-content" class="markdown-Github mdl-color-text--grey-700 mdl-card__supporting-text fade out">
	
		<p>Lab2 的 Bomb是个非常有意思的实验，比起之前耗脑的Lab1，这个Lab主要是学习反汇编。</p>
<p>这里我的环境是OS X EI Capitan，Lab2是[Updated 1/12/16].</p>
<!--toc-->
<h2 id="Phase1"><a href="#Phase1" class="headerlink" title="Phase1"></a>Phase1</h2><p>在Mac上是默认没有GDB的，可以使用LLDB来代替。</p>
<p>进入lldb</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lldb bomb</div></pre></td></tr></table></figure>
<p>使用<code>disassemble</code>进行反汇编,参考<code>bomb.c</code>文件，可以知道主要的几个函数名。</p>
<p>首先是Phase_1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(lldb) disas -n phase_1</div></pre></td></tr></table></figure>
<p>得到以下汇编代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">bomb`phase_1:</div><div class="line">bomb[0x400ee0] <span class="tag">&lt;<span class="name">+0</span>&gt;</span>:  subq   $0x8, %rsp</div><div class="line">bomb[0x400ee4] <span class="tag">&lt;<span class="name">+4</span>&gt;</span>:  movl   $0x402400, %esi</div><div class="line">bomb[0x400ee9] <span class="tag">&lt;<span class="name">+9</span>&gt;</span>:  callq  0x401338                  ; strings_not_equal</div><div class="line">bomb[0x400eee] <span class="tag">&lt;<span class="name">+14</span>&gt;</span>: testl  %eax, %eax</div><div class="line">bomb[0x400ef0] <span class="tag">&lt;<span class="name">+16</span>&gt;</span>: je     0x400ef7                  ; <span class="tag">&lt;<span class="name">+23</span>&gt;</span></div><div class="line">bomb[0x400ef2] <span class="tag">&lt;<span class="name">+18</span>&gt;</span>: callq  0x40143a                  ; explode_bomb</div><div class="line">bomb[0x400ef7] <span class="tag">&lt;<span class="name">+23</span>&gt;</span>: addq   $0x8, %rsp</div><div class="line">bomb[0x400efb] <span class="tag">&lt;<span class="name">+27</span>&gt;</span>: retq</div></pre></td></tr></table></figure>
<p>这段代码还是挺好理解的，保存<code>Stack pointer</code>,将<code>$0x402400</code>传给<code>%esi</code>,调用位于<code>0x401338</code>的<code>strings_not_equal</code>函数，比较<code>%eax</code>是否为0，不为零则调用<code>explode_bomb</code>函数，为零则返回。</p>
<p>所以关键要找出字符串是什么。根据上述的汇编代码，可以发现字符串被保存在<code>0x402400</code>这个内存里，所以使用<code>x/s</code>来查看。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(lldb) x/s 0x402400</div></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">0x00402400: "Border relations with Canada have never been better."</div></pre></td></tr></table></figure>
<p>所以第一关的答案是<code>Strings_Not_Equal</code></p>
<a id="more"></a>
<h2 id="Phase2"><a href="#Phase2" class="headerlink" title="Phase2"></a>Phase2</h2><p>同样，还是先反汇编出代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">bomb`phase_2:</div><div class="line">bomb[0x400efc] <span class="tag">&lt;<span class="name">+0</span>&gt;</span>:  pushq  %rbp</div><div class="line">bomb[0x400efd] <span class="tag">&lt;<span class="name">+1</span>&gt;</span>:  pushq  %rbx</div><div class="line">bomb[0x400efe] <span class="tag">&lt;<span class="name">+2</span>&gt;</span>:  subq   $0x28, %rsp</div><div class="line">bomb[0x400f02] <span class="tag">&lt;<span class="name">+6</span>&gt;</span>:  movq   %rsp, %rsi</div><div class="line">bomb[0x400f05] <span class="tag">&lt;<span class="name">+9</span>&gt;</span>:  callq  0x40145c                  ; read_six_numbers</div><div class="line">bomb[0x400f0a] <span class="tag">&lt;<span class="name">+14</span>&gt;</span>: cmpl   $0x1, (%rsp)</div><div class="line">bomb[0x400f0e] <span class="tag">&lt;<span class="name">+18</span>&gt;</span>: je     0x400f30                  ; <span class="tag">&lt;<span class="name">+52</span>&gt;</span></div><div class="line">bomb[0x400f10] <span class="tag">&lt;<span class="name">+20</span>&gt;</span>: callq  0x40143a                  ; explode_bomb</div><div class="line">bomb[0x400f15] <span class="tag">&lt;<span class="name">+25</span>&gt;</span>: jmp    0x400f30                  ; <span class="tag">&lt;<span class="name">+52</span>&gt;</span></div><div class="line">bomb[0x400f17] <span class="tag">&lt;<span class="name">+27</span>&gt;</span>: movl   -0x4(%rbx), %eax</div><div class="line">bomb[0x400f1a] <span class="tag">&lt;<span class="name">+30</span>&gt;</span>: addl   %eax, %eax</div><div class="line">bomb[0x400f1c] <span class="tag">&lt;<span class="name">+32</span>&gt;</span>: cmpl   %eax, (%rbx)</div><div class="line">bomb[0x400f1e] <span class="tag">&lt;<span class="name">+34</span>&gt;</span>: je     0x400f25                  ; <span class="tag">&lt;<span class="name">+41</span>&gt;</span></div><div class="line">bomb[0x400f20] <span class="tag">&lt;<span class="name">+36</span>&gt;</span>: callq  0x40143a                  ; explode_bomb</div><div class="line">bomb[0x400f25] <span class="tag">&lt;<span class="name">+41</span>&gt;</span>: addq   $0x4, %rbx</div><div class="line">bomb[0x400f29] <span class="tag">&lt;<span class="name">+45</span>&gt;</span>: cmpq   %rbp, %rbx</div><div class="line">bomb[0x400f2c] <span class="tag">&lt;<span class="name">+48</span>&gt;</span>: jne    0x400f17                  ; <span class="tag">&lt;<span class="name">+27</span>&gt;</span></div><div class="line">bomb[0x400f2e] <span class="tag">&lt;<span class="name">+50</span>&gt;</span>: jmp    0x400f3c                  ; <span class="tag">&lt;<span class="name">+64</span>&gt;</span></div><div class="line">bomb[0x400f30] <span class="tag">&lt;<span class="name">+52</span>&gt;</span>: leaq   0x4(%rsp), %rbx</div><div class="line">bomb[0x400f35] <span class="tag">&lt;<span class="name">+57</span>&gt;</span>: leaq   0x18(%rsp), %rbp</div><div class="line">bomb[0x400f3a] <span class="tag">&lt;<span class="name">+62</span>&gt;</span>: jmp    0x400f17                  ; <span class="tag">&lt;<span class="name">+27</span>&gt;</span></div><div class="line">bomb[0x400f3c] <span class="tag">&lt;<span class="name">+64</span>&gt;</span>: addq   $0x28, %rsp</div><div class="line">bomb[0x400f40] <span class="tag">&lt;<span class="name">+68</span>&gt;</span>: popq   %rbx</div><div class="line">bomb[0x400f41] <span class="tag">&lt;<span class="name">+69</span>&gt;</span>: popq   %rbp</div><div class="line">bomb[0x400f42] <span class="tag">&lt;<span class="name">+70</span>&gt;</span>: retq</div></pre></td></tr></table></figure>
<p>从上述汇编中，可以发现从%rsp位置开始保存数字。</p>
<p>反汇编<code>read_six_numbers</code>得到</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">bomb`read_six_numbers:</div><div class="line">bomb[0x40145c] <span class="tag">&lt;<span class="name">+0</span>&gt;</span>:  subq   $0x18, %rsp</div><div class="line">bomb[0x401460] <span class="tag">&lt;<span class="name">+4</span>&gt;</span>:  movq   %rsi, %rdx</div><div class="line">bomb[0x401463] <span class="tag">&lt;<span class="name">+7</span>&gt;</span>:  leaq   0x4(%rsi), %rcx</div><div class="line">bomb[0x401467] <span class="tag">&lt;<span class="name">+11</span>&gt;</span>: leaq   0x14(%rsi), %rax</div><div class="line">bomb[0x40146b] <span class="tag">&lt;<span class="name">+15</span>&gt;</span>: movq   %rax, 0x8(%rsp)</div><div class="line">bomb[0x401470] <span class="tag">&lt;<span class="name">+20</span>&gt;</span>: leaq   0x10(%rsi), %rax</div><div class="line">bomb[0x401474] <span class="tag">&lt;<span class="name">+24</span>&gt;</span>: movq   %rax, (%rsp)</div><div class="line">bomb[0x401478] <span class="tag">&lt;<span class="name">+28</span>&gt;</span>: leaq   0xc(%rsi), %r9</div><div class="line">bomb[0x40147c] <span class="tag">&lt;<span class="name">+32</span>&gt;</span>: leaq   0x8(%rsi), %r8</div><div class="line">bomb[0x401480] <span class="tag">&lt;<span class="name">+36</span>&gt;</span>: movl   $0x4025c3, %esi</div><div class="line">bomb[0x401485] <span class="tag">&lt;<span class="name">+41</span>&gt;</span>: movl   $0x0, %eax</div><div class="line">bomb[0x40148a] <span class="tag">&lt;<span class="name">+46</span>&gt;</span>: callq  0x400bf0                  ; symbol stub for: __isoc99_sscanf</div><div class="line">bomb[0x40148f] <span class="tag">&lt;<span class="name">+51</span>&gt;</span>: cmpl   $0x5, %eax</div><div class="line">bomb[0x401492] <span class="tag">&lt;<span class="name">+54</span>&gt;</span>: jg     0x401499                  ; <span class="tag">&lt;<span class="name">+61</span>&gt;</span></div><div class="line">bomb[0x401494] <span class="tag">&lt;<span class="name">+56</span>&gt;</span>: callq  0x40143a                  ; explode_bomb</div><div class="line">bomb[0x401499] <span class="tag">&lt;<span class="name">+61</span>&gt;</span>: addq   $0x18, %rsp</div><div class="line">bomb[0x40149d] <span class="tag">&lt;<span class="name">+65</span>&gt;</span>: retq</div></pre></td></tr></table></figure>
<p>根据Phase1,很敏感的会发现<code>movl   $0x4025c3, %esi</code>这行。通过之前一样的方法，得到<code>0x4025c3</code>内存里的字符串，</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">0x004025c3: "%d %d %d %d %d %d"</div></pre></td></tr></table></figure>
<p>再根据<code>bomb[0x40148a] &lt;+46&gt;: callq  0x400bf0                  ; symbol stub for: __isoc99_sscanf</code>这句，猜一下，立马就能联想到<code>scanf(&quot;%d %d %d %d %d %d&quot;,a,b,c,d,e,f);</code>，也就是说，输入的格式已经确定了。</p>
<p><code>bomb[0x40145c] &lt;+0&gt;:  subq   $0x18, %rsp</code>这行也暗示了之前<code>bomb[0x400f35] &lt;+57&gt;: leaq   0x18(%rsp), %rbp</code>为什么是0x18(%rsp)。</p>
<p>回到<code>phase_2</code>，根据<code>cmpl   $0x1, (%rsp)</code>和下一行汇编语句，很容易知道第一个数是1.<br>接着跳到了<code>&lt;+52&gt;</code>,将0x4(%rsp)指向内存里的值传给%rbx,将0x18(%rsp)指向内存里的值传给%rbp。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">bomb[0x400f17] <span class="tag">&lt;<span class="name">+27</span>&gt;</span>: movl   -0x4(%rbx), %eax</div><div class="line">bomb[0x400f1a] <span class="tag">&lt;<span class="name">+30</span>&gt;</span>: addl   %eax, %eax</div><div class="line">bomb[0x400f1c] <span class="tag">&lt;<span class="name">+32</span>&gt;</span>: cmpl   %eax, (%rbx)</div><div class="line">bomb[0x400f1e] <span class="tag">&lt;<span class="name">+34</span>&gt;</span>: je     0x400f25</div></pre></td></tr></table></figure>
<p>这段代码是循环里的部分</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">bomb[0x400f25] <span class="tag">&lt;<span class="name">+41</span>&gt;</span>: addq   $0x4, %rbx</div><div class="line">bomb[0x400f29] <span class="tag">&lt;<span class="name">+45</span>&gt;</span>: cmpq   %rbp, %rbx</div><div class="line">bomb[0x400f2c] <span class="tag">&lt;<span class="name">+48</span>&gt;</span>: jne    0x400f17                  ; <span class="tag">&lt;<span class="name">+27</span>&gt;</span></div><div class="line">bomb[0x400f2e] <span class="tag">&lt;<span class="name">+50</span>&gt;</span>: jmp    0x400f3c                  ; <span class="tag">&lt;<span class="name">+64</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这是循环条件</p>
<p>所以可以得出这6个数是等比数列<code>1 2 4 8 16 32</code></p>
<h2 id="Phase3"><a href="#Phase3" class="headerlink" title="Phase3"></a>Phase3</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">bomb`phase_3:</div><div class="line">bomb[0x400f43] <span class="tag">&lt;<span class="name">+0</span>&gt;</span>:   subq   $0x18, %rsp</div><div class="line">bomb[0x400f47] <span class="tag">&lt;<span class="name">+4</span>&gt;</span>:   leaq   0xc(%rsp), %rcx</div><div class="line">bomb[0x400f4c] <span class="tag">&lt;<span class="name">+9</span>&gt;</span>:   leaq   0x8(%rsp), %rdx</div><div class="line">bomb[0x400f51] <span class="tag">&lt;<span class="name">+14</span>&gt;</span>:  movl   $0x4025cf, %esi</div><div class="line">bomb[0x400f56] <span class="tag">&lt;<span class="name">+19</span>&gt;</span>:  movl   $0x0, %eax</div><div class="line">bomb[0x400f5b] <span class="tag">&lt;<span class="name">+24</span>&gt;</span>:  callq  0x400bf0                  ; symbol stub for: __isoc99_sscanf</div><div class="line">bomb[0x400f60] <span class="tag">&lt;<span class="name">+29</span>&gt;</span>:  cmpl   $0x1, %eax</div><div class="line">bomb[0x400f63] <span class="tag">&lt;<span class="name">+32</span>&gt;</span>:  jg     0x400f6a                  ; <span class="tag">&lt;<span class="name">+39</span>&gt;</span></div><div class="line">bomb[0x400f65] <span class="tag">&lt;<span class="name">+34</span>&gt;</span>:  callq  0x40143a                  ; explode_bomb</div><div class="line">bomb[0x400f6a] <span class="tag">&lt;<span class="name">+39</span>&gt;</span>:  cmpl   $0x7, 0x8(%rsp)</div><div class="line">bomb[0x400f6f] <span class="tag">&lt;<span class="name">+44</span>&gt;</span>:  ja     0x400fad                  ; <span class="tag">&lt;<span class="name">+106</span>&gt;</span></div><div class="line">bomb[0x400f71] <span class="tag">&lt;<span class="name">+46</span>&gt;</span>:  movl   0x8(%rsp), %eax</div><div class="line">bomb[0x400f75] <span class="tag">&lt;<span class="name">+50</span>&gt;</span>:  jmpq   *0x402470(,%rax,8)</div><div class="line">bomb[0x400f7c] <span class="tag">&lt;<span class="name">+57</span>&gt;</span>:  movl   $0xcf, %eax</div><div class="line">bomb[0x400f81] <span class="tag">&lt;<span class="name">+62</span>&gt;</span>:  jmp    0x400fbe                  ; <span class="tag">&lt;<span class="name">+123</span>&gt;</span></div><div class="line">bomb[0x400f83] <span class="tag">&lt;<span class="name">+64</span>&gt;</span>:  movl   $0x2c3, %eax</div><div class="line">bomb[0x400f88] <span class="tag">&lt;<span class="name">+69</span>&gt;</span>:  jmp    0x400fbe                  ; <span class="tag">&lt;<span class="name">+123</span>&gt;</span></div><div class="line">bomb[0x400f8a] <span class="tag">&lt;<span class="name">+71</span>&gt;</span>:  movl   $0x100, %eax</div><div class="line">bomb[0x400f8f] <span class="tag">&lt;<span class="name">+76</span>&gt;</span>:  jmp    0x400fbe                  ; <span class="tag">&lt;<span class="name">+123</span>&gt;</span></div><div class="line">bomb[0x400f91] <span class="tag">&lt;<span class="name">+78</span>&gt;</span>:  movl   $0x185, %eax</div><div class="line">bomb[0x400f96] <span class="tag">&lt;<span class="name">+83</span>&gt;</span>:  jmp    0x400fbe                  ; <span class="tag">&lt;<span class="name">+123</span>&gt;</span></div><div class="line">bomb[0x400f98] <span class="tag">&lt;<span class="name">+85</span>&gt;</span>:  movl   $0xce, %eax</div><div class="line">bomb[0x400f9d] <span class="tag">&lt;<span class="name">+90</span>&gt;</span>:  jmp    0x400fbe                  ; <span class="tag">&lt;<span class="name">+123</span>&gt;</span></div><div class="line">bomb[0x400f9f] <span class="tag">&lt;<span class="name">+92</span>&gt;</span>:  movl   $0x2aa, %eax</div><div class="line">bomb[0x400fa4] <span class="tag">&lt;<span class="name">+97</span>&gt;</span>:  jmp    0x400fbe                  ; <span class="tag">&lt;<span class="name">+123</span>&gt;</span></div><div class="line">bomb[0x400fa6] <span class="tag">&lt;<span class="name">+99</span>&gt;</span>:  movl   $0x147, %eax</div><div class="line">bomb[0x400fab] <span class="tag">&lt;<span class="name">+104</span>&gt;</span>: jmp    0x400fbe                  ; <span class="tag">&lt;<span class="name">+123</span>&gt;</span></div><div class="line">bomb[0x400fad] <span class="tag">&lt;<span class="name">+106</span>&gt;</span>: callq  0x40143a                  ; explode_bomb</div><div class="line">bomb[0x400fb2] <span class="tag">&lt;<span class="name">+111</span>&gt;</span>: movl   $0x0, %eax</div><div class="line">bomb[0x400fb7] <span class="tag">&lt;<span class="name">+116</span>&gt;</span>: jmp    0x400fbe                  ; <span class="tag">&lt;<span class="name">+123</span>&gt;</span></div><div class="line">bomb[0x400fb9] <span class="tag">&lt;<span class="name">+118</span>&gt;</span>: movl   $0x137, %eax</div><div class="line">bomb[0x400fbe] <span class="tag">&lt;<span class="name">+123</span>&gt;</span>: cmpl   0xc(%rsp), %eax</div><div class="line">bomb[0x400fc2] <span class="tag">&lt;<span class="name">+127</span>&gt;</span>: je     0x400fc9                  ; <span class="tag">&lt;<span class="name">+134</span>&gt;</span></div><div class="line">bomb[0x400fc4] <span class="tag">&lt;<span class="name">+129</span>&gt;</span>: callq  0x40143a                  ; explode_bomb</div><div class="line">bomb[0x400fc9] <span class="tag">&lt;<span class="name">+134</span>&gt;</span>: addq   $0x18, %rsp</div><div class="line">bomb[0x400fcd] <span class="tag">&lt;<span class="name">+138</span>&gt;</span>: retq</div></pre></td></tr></table></figure>
<p>代码还挺长。</p>
<p>同样，根据<code>bomb[0x400f51] &lt;+14&gt;:  movl   $0x4025cf, %esi</code>可以得到<code>%d %d</code>这个格式，代表要输入两个整数。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">bomb[0x400f47] <span class="tag">&lt;<span class="name">+4</span>&gt;</span>:   leaq   0xc(%rsp), %rcx</div><div class="line">bomb[0x400f4c] <span class="tag">&lt;<span class="name">+9</span>&gt;</span>:   leaq   0x8(%rsp), %rdx</div></pre></td></tr></table></figure>
<p>这两行代表了两个数存的位置。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">bomb[0x400f6a] <span class="tag">&lt;<span class="name">+39</span>&gt;</span>:  cmpl   $0x7, 0x8(%rsp)</div><div class="line">bomb[0x400f6f] <span class="tag">&lt;<span class="name">+44</span>&gt;</span>:  ja     0x400fad                  ; <span class="tag">&lt;<span class="name">+106</span>&gt;</span></div></pre></td></tr></table></figure>
<p>由这两行，可知第一个数要不能大于7,<code>ja</code>是<code>unsigned &gt;</code>，所以第一个数还要是正数。</p>
<p>关键的一行是这个<code>bomb[0x400f75] &lt;+50&gt;:  jmpq   *0x402470(,%rax,8)</code>,这是一个switch跳转语句，跳转到<code>0x402470+ %rax * 8</code>的位置。使用<code>p/x</code>来确定跳转的目的地址。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">(gdb) p/x *(0x402470)</div><div class="line">$1 = 0x400f7c</div><div class="line">(gdb) p/x *(0x402470+8)</div><div class="line">$2 = 0x400fb9</div><div class="line">(gdb) p/x *(0x402470+16)</div><div class="line">$3 = 0x400f83</div><div class="line">(gdb) p/x *(0x402470+24)</div><div class="line">$4 = 0x400f8a</div><div class="line">(gdb) p/x *(0x402470+32)</div><div class="line">$5 = 0x400f91</div><div class="line">(gdb) p/x *(0x402470+40)</div><div class="line">$6 = 0x400f98</div><div class="line">(gdb) p/x *(0x402470+48)</div><div class="line">$7 = 0x400f9f</div><div class="line">(gdb) p/x *(0x402470+56)</div><div class="line">$8 = 0x400fa6</div></pre></td></tr></table></figure>
<p>通过这个跳转表，可得得到8个解</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">0 207</div><div class="line">1 311</div><div class="line">2 707</div><div class="line">3 256</div><div class="line">4 389</div><div class="line">5 206</div><div class="line">6 682</div><div class="line">7 327</div></pre></td></tr></table></figure>
<h2 id="Phase4"><a href="#Phase4" class="headerlink" title="Phase4"></a>Phase4</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">bomb`phase_4:</div><div class="line">bomb[0x40100c] <span class="tag">&lt;<span class="name">+0</span>&gt;</span>:  subq   $0x18, %rsp</div><div class="line">bomb[0x401010] <span class="tag">&lt;<span class="name">+4</span>&gt;</span>:  leaq   0xc(%rsp), %rcx</div><div class="line">bomb[0x401015] <span class="tag">&lt;<span class="name">+9</span>&gt;</span>:  leaq   0x8(%rsp), %rdx</div><div class="line">bomb[0x40101a] <span class="tag">&lt;<span class="name">+14</span>&gt;</span>: movl   $0x4025cf, %esi</div><div class="line">bomb[0x40101f] <span class="tag">&lt;<span class="name">+19</span>&gt;</span>: movl   $0x0, %eax</div><div class="line">bomb[0x401024] <span class="tag">&lt;<span class="name">+24</span>&gt;</span>: callq  0x400bf0                  ; symbol stub for: __isoc99_sscanf</div><div class="line">bomb[0x401029] <span class="tag">&lt;<span class="name">+29</span>&gt;</span>: cmpl   $0x2, %eax</div><div class="line">bomb[0x40102c] <span class="tag">&lt;<span class="name">+32</span>&gt;</span>: jne    0x401035                  ; <span class="tag">&lt;<span class="name">+41</span>&gt;</span></div><div class="line">bomb[0x40102e] <span class="tag">&lt;<span class="name">+34</span>&gt;</span>: cmpl   $0xe, 0x8(%rsp)</div><div class="line">bomb[0x401033] <span class="tag">&lt;<span class="name">+39</span>&gt;</span>: jbe    0x40103a                  ; <span class="tag">&lt;<span class="name">+46</span>&gt;</span></div><div class="line">bomb[0x401035] <span class="tag">&lt;<span class="name">+41</span>&gt;</span>: callq  0x40143a                  ; explode_bomb</div><div class="line">bomb[0x40103a] <span class="tag">&lt;<span class="name">+46</span>&gt;</span>: movl   $0xe, %edx</div><div class="line">bomb[0x40103f] <span class="tag">&lt;<span class="name">+51</span>&gt;</span>: movl   $0x0, %esi</div><div class="line">bomb[0x401044] <span class="tag">&lt;<span class="name">+56</span>&gt;</span>: movl   0x8(%rsp), %edi</div><div class="line">bomb[0x401048] <span class="tag">&lt;<span class="name">+60</span>&gt;</span>: callq  0x400fce                  ; func4</div><div class="line">bomb[0x40104d] <span class="tag">&lt;<span class="name">+65</span>&gt;</span>: testl  %eax, %eax</div><div class="line">bomb[0x40104f] <span class="tag">&lt;<span class="name">+67</span>&gt;</span>: jne    0x401058                  ; <span class="tag">&lt;<span class="name">+76</span>&gt;</span></div><div class="line">bomb[0x401051] <span class="tag">&lt;<span class="name">+69</span>&gt;</span>: cmpl   $0x0, 0xc(%rsp)</div><div class="line">bomb[0x401056] <span class="tag">&lt;<span class="name">+74</span>&gt;</span>: je     0x40105d                  ; <span class="tag">&lt;<span class="name">+81</span>&gt;</span></div><div class="line">bomb[0x401058] <span class="tag">&lt;<span class="name">+76</span>&gt;</span>: callq  0x40143a                  ; explode_bomb</div><div class="line">bomb[0x40105d] <span class="tag">&lt;<span class="name">+81</span>&gt;</span>: addq   $0x18, %rsp</div><div class="line">bomb[0x401061] <span class="tag">&lt;<span class="name">+85</span>&gt;</span>: retq</div></pre></td></tr></table></figure>
<p>同样的方式，可以确定第一个整数小于等于14，第二个数为0。</p>
<p>第一个数具体值，需要执行func4。</p>
<p>所以func4的代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">bomb`func4:</div><div class="line">bomb[0x400fce] <span class="tag">&lt;<span class="name">+0</span>&gt;</span>:  subq   $0x8, %rsp</div><div class="line">bomb[0x400fd2] <span class="tag">&lt;<span class="name">+4</span>&gt;</span>:  movl   %edx, %eax</div><div class="line">bomb[0x400fd4] <span class="tag">&lt;<span class="name">+6</span>&gt;</span>:  subl   %esi, %eax</div><div class="line">bomb[0x400fd6] <span class="tag">&lt;<span class="name">+8</span>&gt;</span>:  movl   %eax, %ecx</div><div class="line">bomb[0x400fd8] <span class="tag">&lt;<span class="name">+10</span>&gt;</span>: shrl   $0x1f, %ecx</div><div class="line">bomb[0x400fdb] <span class="tag">&lt;<span class="name">+13</span>&gt;</span>: addl   %ecx, %eax</div><div class="line">bomb[0x400fdd] <span class="tag">&lt;<span class="name">+15</span>&gt;</span>: sarl   %eax</div><div class="line">bomb[0x400fdf] <span class="tag">&lt;<span class="name">+17</span>&gt;</span>: leal   (%rax,%rsi), %ecx</div><div class="line">bomb[0x400fe2] <span class="tag">&lt;<span class="name">+20</span>&gt;</span>: cmpl   %edi, %ecx</div><div class="line">bomb[0x400fe4] <span class="tag">&lt;<span class="name">+22</span>&gt;</span>: jle    0x400ff2                  ; <span class="tag">&lt;<span class="name">+36</span>&gt;</span></div><div class="line">bomb[0x400fe6] <span class="tag">&lt;<span class="name">+24</span>&gt;</span>: leal   -0x1(%rcx), %edx</div><div class="line">bomb[0x400fe9] <span class="tag">&lt;<span class="name">+27</span>&gt;</span>: callq  0x400fce                  ; <span class="tag">&lt;<span class="name">+0</span>&gt;</span></div><div class="line">bomb[0x400fee] <span class="tag">&lt;<span class="name">+32</span>&gt;</span>: addl   %eax, %eax</div><div class="line">bomb[0x400ff0] <span class="tag">&lt;<span class="name">+34</span>&gt;</span>: jmp    0x401007                  ; <span class="tag">&lt;<span class="name">+57</span>&gt;</span></div><div class="line">bomb[0x400ff2] <span class="tag">&lt;<span class="name">+36</span>&gt;</span>: movl   $0x0, %eax</div><div class="line">bomb[0x400ff7] <span class="tag">&lt;<span class="name">+41</span>&gt;</span>: cmpl   %edi, %ecx</div><div class="line">bomb[0x400ff9] <span class="tag">&lt;<span class="name">+43</span>&gt;</span>: jge    0x401007                  ; <span class="tag">&lt;<span class="name">+57</span>&gt;</span></div><div class="line">bomb[0x400ffb] <span class="tag">&lt;<span class="name">+45</span>&gt;</span>: leal   0x1(%rcx), %esi</div><div class="line">bomb[0x400ffe] <span class="tag">&lt;<span class="name">+48</span>&gt;</span>: callq  0x400fce                  ; <span class="tag">&lt;<span class="name">+0</span>&gt;</span></div><div class="line">bomb[0x401003] <span class="tag">&lt;<span class="name">+53</span>&gt;</span>: leal   0x1(%rax,%rax), %eax</div><div class="line">bomb[0x401007] <span class="tag">&lt;<span class="name">+57</span>&gt;</span>: addq   $0x8, %rsp</div><div class="line">bomb[0x40100b] <span class="tag">&lt;<span class="name">+61</span>&gt;</span>: retq</div></pre></td></tr></table></figure>
<p>仔细看会发现<code>&lt;+20&gt;</code>和<code>&lt;+41&gt;</code>是一样的，而他们的下一行判断正好相反。注意<code>&lt;+24&gt;</code>和<code>&lt;+45&gt;</code>,以及他们的下一行，都很类似。其实就是递归逼近答案。<br>好吧，随便带入一个0,结果发现正好就正确了。所以输入<code>0 0</code>。倒是测试了一下，发现输入<code>1 0</code>或者<code>3 0</code>或者<code>7 0</code>都正确，果然<code>func4</code>还要细看。只能带入func4慢慢推导，这里就不细写了。</p>
<h2 id="Phase5"><a href="#Phase5" class="headerlink" title="Phase5"></a>Phase5</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">bomb`phase_5:</div><div class="line">bomb[0x401062] <span class="tag">&lt;<span class="name">+0</span>&gt;</span>:   pushq  %rbx</div><div class="line">bomb[0x401063] <span class="tag">&lt;<span class="name">+1</span>&gt;</span>:   subq   $0x20, %rsp</div><div class="line">bomb[0x401067] <span class="tag">&lt;<span class="name">+5</span>&gt;</span>:   movq   %rdi, %rbx</div><div class="line">bomb[0x40106a] <span class="tag">&lt;<span class="name">+8</span>&gt;</span>:   movq   %fs:0x28, %rax</div><div class="line">bomb[0x401073] <span class="tag">&lt;<span class="name">+17</span>&gt;</span>:  movq   %rax, 0x18(%rsp)</div><div class="line">bomb[0x401078] <span class="tag">&lt;<span class="name">+22</span>&gt;</span>:  xorl   %eax, %eax</div><div class="line">bomb[0x40107a] <span class="tag">&lt;<span class="name">+24</span>&gt;</span>:  callq  0x40131b                  ; string_length</div><div class="line">bomb[0x40107f] <span class="tag">&lt;<span class="name">+29</span>&gt;</span>:  cmpl   $0x6, %eax</div><div class="line">bomb[0x401082] <span class="tag">&lt;<span class="name">+32</span>&gt;</span>:  je     0x4010d2                  ; <span class="tag">&lt;<span class="name">+112</span>&gt;</span></div><div class="line">bomb[0x401084] <span class="tag">&lt;<span class="name">+34</span>&gt;</span>:  callq  0x40143a                  ; explode_bomb</div><div class="line">bomb[0x401089] <span class="tag">&lt;<span class="name">+39</span>&gt;</span>:  jmp    0x4010d2                  ; <span class="tag">&lt;<span class="name">+112</span>&gt;</span></div><div class="line">bomb[0x40108b] <span class="tag">&lt;<span class="name">+41</span>&gt;</span>:  movzbl (%rbx,%rax), %ecx</div><div class="line">bomb[0x40108f] <span class="tag">&lt;<span class="name">+45</span>&gt;</span>:  movb   %cl, (%rsp)</div><div class="line">bomb[0x401092] <span class="tag">&lt;<span class="name">+48</span>&gt;</span>:  movq   (%rsp), %rdx</div><div class="line">bomb[0x401096] <span class="tag">&lt;<span class="name">+52</span>&gt;</span>:  andl   $0xf, %edx</div><div class="line">bomb[0x401099] <span class="tag">&lt;<span class="name">+55</span>&gt;</span>:  movzbl 0x4024b0(%rdx), %edx</div><div class="line">bomb[0x4010a0] <span class="tag">&lt;<span class="name">+62</span>&gt;</span>:  movb   %dl, 0x10(%rsp,%rax)</div><div class="line">bomb[0x4010a4] <span class="tag">&lt;<span class="name">+66</span>&gt;</span>:  addq   $0x1, %rax</div><div class="line">bomb[0x4010a8] <span class="tag">&lt;<span class="name">+70</span>&gt;</span>:  cmpq   $0x6, %rax</div><div class="line">bomb[0x4010ac] <span class="tag">&lt;<span class="name">+74</span>&gt;</span>:  jne    0x40108b                  ; <span class="tag">&lt;<span class="name">+41</span>&gt;</span></div><div class="line">bomb[0x4010ae] <span class="tag">&lt;<span class="name">+76</span>&gt;</span>:  movb   $0x0, 0x16(%rsp)</div><div class="line">bomb[0x4010b3] <span class="tag">&lt;<span class="name">+81</span>&gt;</span>:  movl   $0x40245e, %esi</div><div class="line">bomb[0x4010b8] <span class="tag">&lt;<span class="name">+86</span>&gt;</span>:  leaq   0x10(%rsp), %rdi</div><div class="line">bomb[0x4010bd] <span class="tag">&lt;<span class="name">+91</span>&gt;</span>:  callq  0x401338                  ; strings_not_equal</div><div class="line">bomb[0x4010c2] <span class="tag">&lt;<span class="name">+96</span>&gt;</span>:  testl  %eax, %eax</div><div class="line">bomb[0x4010c4] <span class="tag">&lt;<span class="name">+98</span>&gt;</span>:  je     0x4010d9                  ; <span class="tag">&lt;<span class="name">+119</span>&gt;</span></div><div class="line">bomb[0x4010c6] <span class="tag">&lt;<span class="name">+100</span>&gt;</span>: callq  0x40143a                  ; explode_bomb</div><div class="line">bomb[0x4010cb] <span class="tag">&lt;<span class="name">+105</span>&gt;</span>: nopl   (%rax,%rax)</div><div class="line">bomb[0x4010d0] <span class="tag">&lt;<span class="name">+110</span>&gt;</span>: jmp    0x4010d9                  ; <span class="tag">&lt;<span class="name">+119</span>&gt;</span></div><div class="line">bomb[0x4010d2] <span class="tag">&lt;<span class="name">+112</span>&gt;</span>: movl   $0x0, %eax</div><div class="line">bomb[0x4010d7] <span class="tag">&lt;<span class="name">+117</span>&gt;</span>: jmp    0x40108b                  ; <span class="tag">&lt;<span class="name">+41</span>&gt;</span></div><div class="line">bomb[0x4010d9] <span class="tag">&lt;<span class="name">+119</span>&gt;</span>: movq   0x18(%rsp), %rax</div><div class="line">bomb[0x4010de] <span class="tag">&lt;<span class="name">+124</span>&gt;</span>: xorq   %fs:0x28, %rax</div><div class="line">bomb[0x4010e7] <span class="tag">&lt;<span class="name">+133</span>&gt;</span>: je     0x4010ee                  ; <span class="tag">&lt;<span class="name">+140</span>&gt;</span></div><div class="line">bomb[0x4010e9] <span class="tag">&lt;<span class="name">+135</span>&gt;</span>: callq  0x400b30                  ; symbol stub for: __stack_chk_fail</div><div class="line">bomb[0x4010ee] <span class="tag">&lt;<span class="name">+140</span>&gt;</span>: addq   $0x20, %rsp</div><div class="line">bomb[0x4010f2] <span class="tag">&lt;<span class="name">+144</span>&gt;</span>: popq   %rbx</div><div class="line">bomb[0x4010f3] <span class="tag">&lt;<span class="name">+145</span>&gt;</span>: retq</div></pre></td></tr></table></figure>
<p>这道题挺让人头大的，只能参考一些资料。这里用到了一个逆向工具——radare2。</p>
<p><code>r2 bomb</code></p>
<p>进入radare2</p>
<p>首先执行<code>aaa</code>来初始化。</p>
<p><code>afl</code>是用来标示函数的， 所以使用<code>afl~phase</code>来寻找反汇编中的phase，得到</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[0x00400c90]&gt; afl~phase</div><div class="line">0x004015c4  149  8  sym.phase_defused</div><div class="line">0x00401062  146  9  sym.phase_5</div><div class="line">0x00400f43  139  8  sym.phase_3</div><div class="line">0x00400ee0  28  3  sym.phase_1</div><div class="line">0x004012f6  37  1  sym.invalid_phase</div><div class="line">0x00401242  81  5  sym.secret_phase</div><div class="line">0x0040100c  86  7  sym.phase_4</div><div class="line">0x004010f4  272  26  sym.phase_6</div><div class="line">0x00400efc  71  8  sym.phase_2</div></pre></td></tr></table></figure>
<p>使用<code>seek</code>来选择函数,<code>pdf</code>来打印反汇编的函数:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">[0x00400c90]&gt; s sym.phase_5</div><div class="line">[0x00401062]&gt; pdf</div><div class="line">/ (fcn) sym.phase_5 146</div><div class="line">|           ; CALL XREF from 0x00400eaa (sym.phase_5)</div><div class="line">|           0x00401062      53             push rbx</div><div class="line">|           0x00401063      4883ec20       sub rsp, 0x20</div><div class="line">|           0x00401067      4889fb         mov rbx, rdi</div><div class="line">|           0x0040106a      64488b042528.  mov rax, qword fs:[0x28]    ; [0x28:8]=0x48b8  ; '('</div><div class="line">|           0x00401073      4889442418     mov qword [rsp + 0x18], rax</div><div class="line">|           0x00401078      31c0           xor eax, eax</div><div class="line">|           0x0040107a      e89c020000     call sym.string_length</div><div class="line">|           0x0040107f      83f806         cmp eax, 6</div><div class="line">|       ,=&lt; 0x00401082      744e           je 0x4010d2                </div><div class="line">|       |   0x00401084      e8b1030000     call sym.explode_bomb</div><div class="line">|      ,==&lt; 0x00401089      eb47           jmp 0x4010d2               </div><div class="line">|      ||   ; JMP XREF from 0x004010d7 (sym.phase_5)</div><div class="line">|      ||   ; JMP XREF from 0x004010ac (sym.phase_5)</div><div class="line">|    ..---&gt; 0x0040108b      0fb60c03       movzx ecx, byte [rbx + rax]</div><div class="line">|    ||||   0x0040108f      880c24         mov byte [rsp], cl</div><div class="line">|    ||||   0x00401092      488b1424       mov rdx, qword [rsp]</div><div class="line">|    ||||   0x00401096      83e20f         and edx, 0xf</div><div class="line">|    ||||   0x00401099      0fb692b02440.  movzx edx, byte [rdx + str.maduiersnfotvbylSo_you_think_you_can_stop_the_bomb_with_ctrl_c__do_you_] ; [0x4024b0:1]=109 LEA obj.array.3449 ; "maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?" @ 0x4024b0</div><div class="line">|    ||||   0x004010a0      88540410       mov byte [rsp + rax + 0x10], dl</div><div class="line">|    ||||   0x004010a4      4883c001       add rax, 1</div><div class="line">|    ||||   0x004010a8      4883f806       cmp rax, 6</div><div class="line">|    `====&lt; 0x004010ac      75dd           jne 0x40108b               </div><div class="line">|     |||   0x004010ae      c644241600     mov byte [rsp + 0x16], 0</div><div class="line">|     |||   0x004010b3      be5e244000     mov esi, str.flyers         ; "flyers" @ 0x40245e</div><div class="line">|     |||   0x004010b8      488d7c2410     lea rdi, [rsp + 0x10]       ; 0x10 </div><div class="line">|     |||   0x004010bd      e876020000     call sym.strings_not_equal</div><div class="line">|     |||   0x004010c2      85c0           test eax, eax</div><div class="line">|    ,====&lt; 0x004010c4      7413           je 0x4010d9                </div><div class="line">|    ||||   0x004010c6      e86f030000     call sym.explode_bomb</div><div class="line">|    ||||   0x004010cb      0f1f440000     nop dword [rax + rax]</div><div class="line">|   ,=====&lt; 0x004010d0      eb07           jmp 0x4010d9               </div><div class="line">|   |||||   ; JMP XREF from 0x00401089 (sym.phase_5)</div><div class="line">|   |||||   ; JMP XREF from 0x00401082 (sym.phase_5)</div><div class="line">|   |||``-&gt; 0x004010d2      b800000000     mov eax, 0</div><div class="line">|   ||`===&lt; 0x004010d7      ebb2           jmp 0x40108b               </div><div class="line">|   ||      ; JMP XREF from 0x004010d0 (sym.phase_5)</div><div class="line">|   ||      ; JMP XREF from 0x004010c4 (sym.phase_5)</div><div class="line">|   ``----&gt; 0x004010d9      488b442418     mov rax, qword [rsp + 0x18] ; [0x18:8]=0x400c90 section..text</div><div class="line">|           0x004010de      644833042528.  xor rax, qword fs:[0x28]</div><div class="line">|       ,=&lt; 0x004010e7      7405           je 0x4010ee                </div><div class="line">|       |   0x004010e9      e842faffff     call sym.imp.__stack_chk_fail</div><div class="line">|       |   ; JMP XREF from 0x004010e7 (sym.phase_5)</div><div class="line">|       `-&gt; 0x004010ee      4883c420       add rsp, 0x20</div><div class="line">|           0x004010f2      5b             pop rbx</div><div class="line">\           0x004010f3      c3             ret</div><div class="line">[0x00401062]&gt;</div></pre></td></tr></table></figure>
<p>这题要求输入一个长度为6的字符串，经过一定的变换要得到<code>0x40245e</code>指向的字符串<code>flyers</code>。通过上述的代码，会敏感的发现待转换的字符串在<code>obj.array.3449</code>中，使用如下代码来找到偏移量<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[0x00401062]&gt; px 16@obj.array.3449</div><div class="line">- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF</div><div class="line">0x004024b0  6d61 6475 6965 7273 6e66 6f74 7662 796c  maduiersnfotvbyl</div></pre></td></tr></table></figure></p>
<p>上面的一个偏移量对应下面的2个字符。</p>
<p>下面将flyers转化为十六进制ascii</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[0x00401062]&gt; !rax2 -S flyers</div><div class="line">666c79657273</div></pre></td></tr></table></figure>
<p>得到的<code>666c79657273</code>两个一组，找对应的上面的偏移量，可以得到偏移量list<code>[9, 0xF, 0xE, 5, 6, 7]</code></p>
<p>使用python来计算出结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">off = [<span class="number">9</span>, <span class="number">0xF</span>, <span class="number">0xE</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</div><div class="line">result = <span class="string">""</span></div><div class="line"><span class="keyword">for</span> c <span class="keyword">in</span> off:</div><div class="line">    result += chr(c + <span class="number">64</span>)</div><div class="line"></div><div class="line"><span class="keyword">print</span> result</div></pre></td></tr></table></figure>
<p>所以这题的答案是<code>IONEFG</code></p>
<h2 id="Phase6"><a href="#Phase6" class="headerlink" title="Phase6"></a>Phase6</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line">bomb`phase_6:</div><div class="line">bomb[0x4010f4] <span class="tag">&lt;<span class="name">+0</span>&gt;</span>:   pushq  %r14</div><div class="line">bomb[0x4010f6] <span class="tag">&lt;<span class="name">+2</span>&gt;</span>:   pushq  %r13</div><div class="line">bomb[0x4010f8] <span class="tag">&lt;<span class="name">+4</span>&gt;</span>:   pushq  %r12</div><div class="line">bomb[0x4010fa] <span class="tag">&lt;<span class="name">+6</span>&gt;</span>:   pushq  %rbp</div><div class="line">bomb[0x4010fb] <span class="tag">&lt;<span class="name">+7</span>&gt;</span>:   pushq  %rbx</div><div class="line">bomb[0x4010fc] <span class="tag">&lt;<span class="name">+8</span>&gt;</span>:   subq   $0x50, %rsp</div><div class="line">bomb[0x401100] <span class="tag">&lt;<span class="name">+12</span>&gt;</span>:  movq   %rsp, %r13</div><div class="line">bomb[0x401103] <span class="tag">&lt;<span class="name">+15</span>&gt;</span>:  movq   %rsp, %rsi</div><div class="line">bomb[0x401106] <span class="tag">&lt;<span class="name">+18</span>&gt;</span>:  callq  0x40145c                  ; read_six_numbers</div><div class="line">bomb[0x40110b] <span class="tag">&lt;<span class="name">+23</span>&gt;</span>:  movq   %rsp, %r14</div><div class="line">bomb[0x40110e] <span class="tag">&lt;<span class="name">+26</span>&gt;</span>:  movl   $0x0, %r12d</div><div class="line">bomb[0x401114] <span class="tag">&lt;<span class="name">+32</span>&gt;</span>:  movq   %r13, %rbp</div><div class="line">bomb[0x401117] <span class="tag">&lt;<span class="name">+35</span>&gt;</span>:  movl   (%r13), %eax</div><div class="line">bomb[0x40111b] <span class="tag">&lt;<span class="name">+39</span>&gt;</span>:  subl   $0x1, %eax</div><div class="line">bomb[0x40111e] <span class="tag">&lt;<span class="name">+42</span>&gt;</span>:  cmpl   $0x5, %eax</div><div class="line">bomb[0x401121] <span class="tag">&lt;<span class="name">+45</span>&gt;</span>:  jbe    0x401128                  ; <span class="tag">&lt;<span class="name">+52</span>&gt;</span></div><div class="line">bomb[0x401123] <span class="tag">&lt;<span class="name">+47</span>&gt;</span>:  callq  0x40143a                  ; explode_bomb</div><div class="line">bomb[0x401128] <span class="tag">&lt;<span class="name">+52</span>&gt;</span>:  addl   $0x1, %r12d</div><div class="line">bomb[0x40112c] <span class="tag">&lt;<span class="name">+56</span>&gt;</span>:  cmpl   $0x6, %r12d</div><div class="line">bomb[0x401130] <span class="tag">&lt;<span class="name">+60</span>&gt;</span>:  je     0x401153                  ; <span class="tag">&lt;<span class="name">+95</span>&gt;</span></div><div class="line">bomb[0x401132] <span class="tag">&lt;<span class="name">+62</span>&gt;</span>:  movl   %r12d, %ebx</div><div class="line">bomb[0x401135] <span class="tag">&lt;<span class="name">+65</span>&gt;</span>:  movslq %ebx, %rax</div><div class="line">bomb[0x401138] <span class="tag">&lt;<span class="name">+68</span>&gt;</span>:  movl   (%rsp,%rax,4), %eax</div><div class="line">bomb[0x40113b] <span class="tag">&lt;<span class="name">+71</span>&gt;</span>:  cmpl   %eax, (%rbp)</div><div class="line">bomb[0x40113e] <span class="tag">&lt;<span class="name">+74</span>&gt;</span>:  jne    0x401145                  ; <span class="tag">&lt;<span class="name">+81</span>&gt;</span></div><div class="line">bomb[0x401140] <span class="tag">&lt;<span class="name">+76</span>&gt;</span>:  callq  0x40143a                  ; explode_bomb</div><div class="line">bomb[0x401145] <span class="tag">&lt;<span class="name">+81</span>&gt;</span>:  addl   $0x1, %ebx</div><div class="line">bomb[0x401148] <span class="tag">&lt;<span class="name">+84</span>&gt;</span>:  cmpl   $0x5, %ebx</div><div class="line">bomb[0x40114b] <span class="tag">&lt;<span class="name">+87</span>&gt;</span>:  jle    0x401135                  ; <span class="tag">&lt;<span class="name">+65</span>&gt;</span></div><div class="line">bomb[0x40114d] <span class="tag">&lt;<span class="name">+89</span>&gt;</span>:  addq   $0x4, %r13</div><div class="line">bomb[0x401151] <span class="tag">&lt;<span class="name">+93</span>&gt;</span>:  jmp    0x401114                  ; <span class="tag">&lt;<span class="name">+32</span>&gt;</span></div><div class="line">bomb[0x401153] <span class="tag">&lt;<span class="name">+95</span>&gt;</span>:  leaq   0x18(%rsp), %rsi</div><div class="line">bomb[0x401158] <span class="tag">&lt;<span class="name">+100</span>&gt;</span>: movq   %r14, %rax</div><div class="line">bomb[0x40115b] <span class="tag">&lt;<span class="name">+103</span>&gt;</span>: movl   $0x7, %ecx</div><div class="line">bomb[0x401160] <span class="tag">&lt;<span class="name">+108</span>&gt;</span>: movl   %ecx, %edx</div><div class="line">bomb[0x401162] <span class="tag">&lt;<span class="name">+110</span>&gt;</span>: subl   (%rax), %edx</div><div class="line">bomb[0x401164] <span class="tag">&lt;<span class="name">+112</span>&gt;</span>: movl   %edx, (%rax)</div><div class="line">bomb[0x401166] <span class="tag">&lt;<span class="name">+114</span>&gt;</span>: addq   $0x4, %rax</div><div class="line">bomb[0x40116a] <span class="tag">&lt;<span class="name">+118</span>&gt;</span>: cmpq   %rsi, %rax</div><div class="line">bomb[0x40116d] <span class="tag">&lt;<span class="name">+121</span>&gt;</span>: jne    0x401160                  ; <span class="tag">&lt;<span class="name">+108</span>&gt;</span></div><div class="line">bomb[0x40116f] <span class="tag">&lt;<span class="name">+123</span>&gt;</span>: movl   $0x0, %esi</div><div class="line">bomb[0x401174] <span class="tag">&lt;<span class="name">+128</span>&gt;</span>: jmp    0x401197                  ; <span class="tag">&lt;<span class="name">+163</span>&gt;</span></div><div class="line">bomb[0x401176] <span class="tag">&lt;<span class="name">+130</span>&gt;</span>: movq   0x8(%rdx), %rdx</div><div class="line">bomb[0x40117a] <span class="tag">&lt;<span class="name">+134</span>&gt;</span>: addl   $0x1, %eax</div><div class="line">bomb[0x40117d] <span class="tag">&lt;<span class="name">+137</span>&gt;</span>: cmpl   %ecx, %eax</div><div class="line">bomb[0x40117f] <span class="tag">&lt;<span class="name">+139</span>&gt;</span>: jne    0x401176                  ; <span class="tag">&lt;<span class="name">+130</span>&gt;</span></div><div class="line">bomb[0x401181] <span class="tag">&lt;<span class="name">+141</span>&gt;</span>: jmp    0x401188                  ; <span class="tag">&lt;<span class="name">+148</span>&gt;</span></div><div class="line">bomb[0x401183] <span class="tag">&lt;<span class="name">+143</span>&gt;</span>: movl   $0x6032d0, %edx</div><div class="line">bomb[0x401188] <span class="tag">&lt;<span class="name">+148</span>&gt;</span>: movq   %rdx, 0x20(%rsp,%rsi,2)</div><div class="line">bomb[0x40118d] <span class="tag">&lt;<span class="name">+153</span>&gt;</span>: addq   $0x4, %rsi</div><div class="line">bomb[0x401191] <span class="tag">&lt;<span class="name">+157</span>&gt;</span>: cmpq   $0x18, %rsi</div><div class="line">bomb[0x401195] <span class="tag">&lt;<span class="name">+161</span>&gt;</span>: je     0x4011ab                  ; <span class="tag">&lt;<span class="name">+183</span>&gt;</span></div><div class="line">bomb[0x401197] <span class="tag">&lt;<span class="name">+163</span>&gt;</span>: movl   (%rsp,%rsi), %ecx</div><div class="line">bomb[0x40119a] <span class="tag">&lt;<span class="name">+166</span>&gt;</span>: cmpl   $0x1, %ecx</div><div class="line">bomb[0x40119d] <span class="tag">&lt;<span class="name">+169</span>&gt;</span>: jle    0x401183                  ; <span class="tag">&lt;<span class="name">+143</span>&gt;</span></div><div class="line">bomb[0x40119f] <span class="tag">&lt;<span class="name">+171</span>&gt;</span>: movl   $0x1, %eax</div><div class="line">bomb[0x4011a4] <span class="tag">&lt;<span class="name">+176</span>&gt;</span>: movl   $0x6032d0, %edx</div><div class="line">bomb[0x4011a9] <span class="tag">&lt;<span class="name">+181</span>&gt;</span>: jmp    0x401176                  ; <span class="tag">&lt;<span class="name">+130</span>&gt;</span></div><div class="line">bomb[0x4011ab] <span class="tag">&lt;<span class="name">+183</span>&gt;</span>: movq   0x20(%rsp), %rbx</div><div class="line">bomb[0x4011b0] <span class="tag">&lt;<span class="name">+188</span>&gt;</span>: leaq   0x28(%rsp), %rax</div><div class="line">bomb[0x4011b5] <span class="tag">&lt;<span class="name">+193</span>&gt;</span>: leaq   0x50(%rsp), %rsi</div><div class="line">bomb[0x4011ba] <span class="tag">&lt;<span class="name">+198</span>&gt;</span>: movq   %rbx, %rcx</div><div class="line">bomb[0x4011bd] <span class="tag">&lt;<span class="name">+201</span>&gt;</span>: movq   (%rax), %rdx</div><div class="line">bomb[0x4011c0] <span class="tag">&lt;<span class="name">+204</span>&gt;</span>: movq   %rdx, 0x8(%rcx)</div><div class="line">bomb[0x4011c4] <span class="tag">&lt;<span class="name">+208</span>&gt;</span>: addq   $0x8, %rax</div><div class="line">bomb[0x4011c8] <span class="tag">&lt;<span class="name">+212</span>&gt;</span>: cmpq   %rsi, %rax</div><div class="line">bomb[0x4011cb] <span class="tag">&lt;<span class="name">+215</span>&gt;</span>: je     0x4011d2                  ; <span class="tag">&lt;<span class="name">+222</span>&gt;</span></div><div class="line">bomb[0x4011cd] <span class="tag">&lt;<span class="name">+217</span>&gt;</span>: movq   %rdx, %rcx</div><div class="line">bomb[0x4011d0] <span class="tag">&lt;<span class="name">+220</span>&gt;</span>: jmp    0x4011bd                  ; <span class="tag">&lt;<span class="name">+201</span>&gt;</span></div><div class="line">bomb[0x4011d2] <span class="tag">&lt;<span class="name">+222</span>&gt;</span>: movq   $0x0, 0x8(%rdx)</div><div class="line">bomb[0x4011da] <span class="tag">&lt;<span class="name">+230</span>&gt;</span>: movl   $0x5, %ebp</div><div class="line">bomb[0x4011df] <span class="tag">&lt;<span class="name">+235</span>&gt;</span>: movq   0x8(%rbx), %rax</div><div class="line">bomb[0x4011e3] <span class="tag">&lt;<span class="name">+239</span>&gt;</span>: movl   (%rax), %eax</div><div class="line">bomb[0x4011e5] <span class="tag">&lt;<span class="name">+241</span>&gt;</span>: cmpl   %eax, (%rbx)</div><div class="line">bomb[0x4011e7] <span class="tag">&lt;<span class="name">+243</span>&gt;</span>: jge    0x4011ee                  ; <span class="tag">&lt;<span class="name">+250</span>&gt;</span></div><div class="line">bomb[0x4011e9] <span class="tag">&lt;<span class="name">+245</span>&gt;</span>: callq  0x40143a                  ; explode_bomb</div><div class="line">bomb[0x4011ee] <span class="tag">&lt;<span class="name">+250</span>&gt;</span>: movq   0x8(%rbx), %rbx</div><div class="line">bomb[0x4011f2] <span class="tag">&lt;<span class="name">+254</span>&gt;</span>: subl   $0x1, %ebp</div><div class="line">bomb[0x4011f5] <span class="tag">&lt;<span class="name">+257</span>&gt;</span>: jne    0x4011df                  ; <span class="tag">&lt;<span class="name">+235</span>&gt;</span></div><div class="line">bomb[0x4011f7] <span class="tag">&lt;<span class="name">+259</span>&gt;</span>: addq   $0x50, %rsp</div><div class="line">bomb[0x4011fb] <span class="tag">&lt;<span class="name">+263</span>&gt;</span>: popq   %rbx</div><div class="line">bomb[0x4011fc] <span class="tag">&lt;<span class="name">+264</span>&gt;</span>: popq   %rbp</div><div class="line">bomb[0x4011fd] <span class="tag">&lt;<span class="name">+265</span>&gt;</span>: popq   %r12</div><div class="line">bomb[0x4011ff] <span class="tag">&lt;<span class="name">+267</span>&gt;</span>: popq   %r13</div><div class="line">bomb[0x401201] <span class="tag">&lt;<span class="name">+269</span>&gt;</span>: popq   %r14</div><div class="line">bomb[0x401203] <span class="tag">&lt;<span class="name">+271</span>&gt;</span>: retq</div></pre></td></tr></table></figure>
<p>代码虽然很长，其实使用<code>stepi</code>还是挺容易弄懂的。首先读取6个数字，并且各不相同。然后，在<code>0x6032d0</code>位置有一个链表，读取这链表的值。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(gdb)x/32wx 0x6032d0</div></pre></td></tr></table></figure>
<p>当然使用radare2很容易发现这里的链表，</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[0x004010f4]&gt; pxw 96@obj.node1</div><div class="line">0x006032d0  0x0000014c 0x00000001 0x006032e0 0x00000000  L........2`.....</div><div class="line">0x006032e0  0x000000a8 0x00000002 0x006032f0 0x00000000  .........2`.....</div><div class="line">0x006032f0  0x0000039c 0x00000003 0x00603300 0x00000000  .........3`.....</div><div class="line">0x00603300  0x000002b3 0x00000004 0x00603310 0x00000000  .........3`.....</div><div class="line">0x00603310  0x000001dd 0x00000005 0x00603320 0x00000000  ........ 3`.....</div><div class="line">0x00603320  0x000001bb 0x00000006 0x00000000 0x00000000  ................</div></pre></td></tr></table></figure>
<p>另外，对于读入的数，这里存在一个操作</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">bomb[0x40115b] <span class="tag">&lt;<span class="name">+103</span>&gt;</span>: movl   $0x7, %ecx</div><div class="line">bomb[0x401160] <span class="tag">&lt;<span class="name">+108</span>&gt;</span>: movl   %ecx, %edx</div><div class="line">bomb[0x401162] <span class="tag">&lt;<span class="name">+110</span>&gt;</span>: subl   (%rax), %edx</div></pre></td></tr></table></figure>
<p>是的，用7来减每个数并保存。</p>
<p>在这个地方</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">bomb[0x4011e5] <span class="tag">&lt;<span class="name">+241</span>&gt;</span>: cmpl   %eax, (%rbx)</div><div class="line">bomb[0x4011e7] <span class="tag">&lt;<span class="name">+243</span>&gt;</span>: jge    0x4011ee                  ; <span class="tag">&lt;<span class="name">+250</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这里暗示节点顺序需要时递减。</p>
<p>所以节点重排应该是<code>3 4 5 6 1 2</code>,考虑之前的7减操作，最终的答案是<code>4 3 2 1 6 5</code></p>
<h2 id="Secret_phase"><a href="#Secret_phase" class="headerlink" title="Secret phase"></a>Secret phase</h2><p>这时候说Congratulations!还稍微早了些，这个还暗藏了一个秘密关卡，藏在了phase_defused中。</p>
<p>首先要在phase_defused函数打断点， 另外反汇编出<code>phase_defused</code>，可以发现</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">Dump of assembler code for function phase_defused:</div><div class="line">   0x00000000004015c4 <span class="tag">&lt;<span class="name">+0</span>&gt;</span>:	sub    $0x78,%rsp</div><div class="line">   0x00000000004015c8 <span class="tag">&lt;<span class="name">+4</span>&gt;</span>:	mov    %fs:0x28,%rax</div><div class="line">   0x00000000004015d1 <span class="tag">&lt;<span class="name">+13</span>&gt;</span>:	mov    %rax,0x68(%rsp)</div><div class="line">   0x00000000004015d6 <span class="tag">&lt;<span class="name">+18</span>&gt;</span>:	xor    %eax,%eax</div><div class="line">   0x00000000004015d8 <span class="tag">&lt;<span class="name">+20</span>&gt;</span>:	cmpl   $0x6,0x202181(%rip)        # 0x603760 <span class="tag">&lt;<span class="name">num_input_strings</span>&gt;</span></div><div class="line">   0x00000000004015df <span class="tag">&lt;<span class="name">+27</span>&gt;</span>:	jne    0x40163f <span class="tag">&lt;<span class="name">phase_defused+123</span>&gt;</span></div><div class="line">   0x00000000004015e1 <span class="tag">&lt;<span class="name">+29</span>&gt;</span>:	lea    0x10(%rsp),%r8</div><div class="line">   0x00000000004015e6 <span class="tag">&lt;<span class="name">+34</span>&gt;</span>:	lea    0xc(%rsp),%rcx</div><div class="line">   0x00000000004015eb <span class="tag">&lt;<span class="name">+39</span>&gt;</span>:	lea    0x8(%rsp),%rdx</div><div class="line">   0x00000000004015f0 <span class="tag">&lt;<span class="name">+44</span>&gt;</span>:	mov    $0x402619,%esi</div><div class="line">   0x00000000004015f5 <span class="tag">&lt;<span class="name">+49</span>&gt;</span>:	mov    $0x603870,%edi</div><div class="line">   0x00000000004015fa <span class="tag">&lt;<span class="name">+54</span>&gt;</span>:	callq  0x400bf0 <span class="tag">&lt;<span class="name">__isoc99_sscanf@plt</span>&gt;</span></div><div class="line">   0x00000000004015ff <span class="tag">&lt;<span class="name">+59</span>&gt;</span>:	cmp    $0x3,%eax</div><div class="line">   0x0000000000401602 <span class="tag">&lt;<span class="name">+62</span>&gt;</span>:	jne    0x401635 <span class="tag">&lt;<span class="name">phase_defused+113</span>&gt;</span></div><div class="line">   0x0000000000401604 <span class="tag">&lt;<span class="name">+64</span>&gt;</span>:	mov    $0x402622,%esi</div><div class="line">   0x0000000000401609 <span class="tag">&lt;<span class="name">+69</span>&gt;</span>:	lea    0x10(%rsp),%rdi</div><div class="line">   0x000000000040160e <span class="tag">&lt;<span class="name">+74</span>&gt;</span>:	callq  0x401338 <span class="tag">&lt;<span class="name">strings_not_equal</span>&gt;</span></div><div class="line">   0x0000000000401613 <span class="tag">&lt;<span class="name">+79</span>&gt;</span>:	test   %eax,%eax</div><div class="line">   0x0000000000401615 <span class="tag">&lt;<span class="name">+81</span>&gt;</span>:	jne    0x401635 <span class="tag">&lt;<span class="name">phase_defused+113</span>&gt;</span></div><div class="line">   0x0000000000401617 <span class="tag">&lt;<span class="name">+83</span>&gt;</span>:	mov    $0x4024f8,%edi</div><div class="line">   0x000000000040161c <span class="tag">&lt;<span class="name">+88</span>&gt;</span>:	callq  0x400b10 <span class="tag">&lt;<span class="name">puts@plt</span>&gt;</span></div><div class="line">   0x0000000000401621 <span class="tag">&lt;<span class="name">+93</span>&gt;</span>:	mov    $0x402520,%edi</div><div class="line">   0x0000000000401626 <span class="tag">&lt;<span class="name">+98</span>&gt;</span>:	callq  0x400b10 <span class="tag">&lt;<span class="name">puts@plt</span>&gt;</span></div><div class="line">   0x000000000040162b <span class="tag">&lt;<span class="name">+103</span>&gt;</span>:	mov    $0x0,%eax</div><div class="line">   0x0000000000401630 <span class="tag">&lt;<span class="name">+108</span>&gt;</span>:	callq  0x401242 <span class="tag">&lt;<span class="name">secret_phase</span>&gt;</span></div><div class="line">   0x0000000000401635 <span class="tag">&lt;<span class="name">+113</span>&gt;</span>:	mov    $0x402558,%edi</div><div class="line">   0x000000000040163a <span class="tag">&lt;<span class="name">+118</span>&gt;</span>:	callq  0x400b10 <span class="tag">&lt;<span class="name">puts@plt</span>&gt;</span></div><div class="line">   0x000000000040163f <span class="tag">&lt;<span class="name">+123</span>&gt;</span>:	mov    0x68(%rsp),%rax</div><div class="line">   0x0000000000401644 <span class="tag">&lt;<span class="name">+128</span>&gt;</span>:	xor    %fs:0x28,%rax</div><div class="line">   0x000000000040164d <span class="tag">&lt;<span class="name">+137</span>&gt;</span>:	je     0x401654 <span class="tag">&lt;<span class="name">phase_defused+144</span>&gt;</span></div><div class="line">   0x000000000040164f <span class="tag">&lt;<span class="name">+139</span>&gt;</span>:	callq  0x400b30 <span class="tag">&lt;<span class="name">__stack_chk_fail@plt</span>&gt;</span></div><div class="line">   0x0000000000401654 <span class="tag">&lt;<span class="name">+144</span>&gt;</span>:	add    $0x78,%rsp</div><div class="line">   0x0000000000401658 <span class="tag">&lt;<span class="name">+148</span>&gt;</span>:	retq</div></pre></td></tr></table></figure>
<p>其中<code>secret_phase</code>的源码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">Dump of assembler code for function secret_phase:</div><div class="line">=&gt; 0x0000000000401242 <span class="tag">&lt;<span class="name">+0</span>&gt;</span>:	push   %rbx</div><div class="line">   0x0000000000401243 <span class="tag">&lt;<span class="name">+1</span>&gt;</span>:	callq  0x40149e <span class="tag">&lt;<span class="name">read_line</span>&gt;</span></div><div class="line">   0x0000000000401248 <span class="tag">&lt;<span class="name">+6</span>&gt;</span>:	mov    $0xa,%edx</div><div class="line">   0x000000000040124d <span class="tag">&lt;<span class="name">+11</span>&gt;</span>:	mov    $0x0,%esi</div><div class="line">   0x0000000000401252 <span class="tag">&lt;<span class="name">+16</span>&gt;</span>:	mov    %rax,%rdi</div><div class="line">   0x0000000000401255 <span class="tag">&lt;<span class="name">+19</span>&gt;</span>:	callq  0x400bd0 <span class="tag">&lt;<span class="name">strtol@plt</span>&gt;</span></div><div class="line">   0x000000000040125a <span class="tag">&lt;<span class="name">+24</span>&gt;</span>:	mov    %rax,%rbx</div><div class="line">   0x000000000040125d <span class="tag">&lt;<span class="name">+27</span>&gt;</span>:	lea    -0x1(%rax),%eax</div><div class="line">   0x0000000000401260 <span class="tag">&lt;<span class="name">+30</span>&gt;</span>:	cmp    $0x3e8,%eax</div><div class="line">   0x0000000000401265 <span class="tag">&lt;<span class="name">+35</span>&gt;</span>:	jbe    0x40126c <span class="tag">&lt;<span class="name">secret_phase+42</span>&gt;</span></div><div class="line">   0x0000000000401267 <span class="tag">&lt;<span class="name">+37</span>&gt;</span>:	callq  0x40143a <span class="tag">&lt;<span class="name">explode_bomb</span>&gt;</span></div><div class="line">   0x000000000040126c <span class="tag">&lt;<span class="name">+42</span>&gt;</span>:	mov    %ebx,%esi</div><div class="line">   0x000000000040126e <span class="tag">&lt;<span class="name">+44</span>&gt;</span>:	mov    $0x6030f0,%edi</div><div class="line">   0x0000000000401273 <span class="tag">&lt;<span class="name">+49</span>&gt;</span>:	callq  0x401204 <span class="tag">&lt;<span class="name">fun7</span>&gt;</span></div><div class="line">   0x0000000000401278 <span class="tag">&lt;<span class="name">+54</span>&gt;</span>:	cmp    $0x2,%eax</div><div class="line">   0x000000000040127b <span class="tag">&lt;<span class="name">+57</span>&gt;</span>:	je     0x401282 <span class="tag">&lt;<span class="name">secret_phase+64</span>&gt;</span></div><div class="line">   0x000000000040127d <span class="tag">&lt;<span class="name">+59</span>&gt;</span>:	callq  0x40143a <span class="tag">&lt;<span class="name">explode_bomb</span>&gt;</span></div><div class="line">   0x0000000000401282 <span class="tag">&lt;<span class="name">+64</span>&gt;</span>:	mov    $0x402438,%edi</div><div class="line">   0x0000000000401287 <span class="tag">&lt;<span class="name">+69</span>&gt;</span>:	callq  0x400b10 <span class="tag">&lt;<span class="name">puts@plt</span>&gt;</span></div><div class="line">   0x000000000040128c <span class="tag">&lt;<span class="name">+74</span>&gt;</span>:	callq  0x4015c4 <span class="tag">&lt;<span class="name">phase_defused</span>&gt;</span></div><div class="line">   0x0000000000401291 <span class="tag">&lt;<span class="name">+79</span>&gt;</span>:	pop    %rbx</div><div class="line">   0x0000000000401292 <span class="tag">&lt;<span class="name">+80</span>&gt;</span>:	retq</div></pre></td></tr></table></figure>
<p>其中，<code>fun7</code>的返回值和2进行了比较，相等则正确，所以可以确定<code>fun7</code>一定要返回2。跳转到<code>fun7</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">bomb`fun7:</div><div class="line">bomb[0x401204] <span class="tag">&lt;<span class="name">+0</span>&gt;</span>:  subq   $0x8, %rsp</div><div class="line">bomb[0x401208] <span class="tag">&lt;<span class="name">+4</span>&gt;</span>:  testq  %rdi, %rdi</div><div class="line">bomb[0x40120b] <span class="tag">&lt;<span class="name">+7</span>&gt;</span>:  je     0x401238                  ; <span class="tag">&lt;<span class="name">+52</span>&gt;</span></div><div class="line">bomb[0x40120d] <span class="tag">&lt;<span class="name">+9</span>&gt;</span>:  movl   (%rdi), %edx</div><div class="line">bomb[0x40120f] <span class="tag">&lt;<span class="name">+11</span>&gt;</span>: cmpl   %esi, %edx</div><div class="line">bomb[0x401211] <span class="tag">&lt;<span class="name">+13</span>&gt;</span>: jle    0x401220                  ; <span class="tag">&lt;<span class="name">+28</span>&gt;</span></div><div class="line">bomb[0x401213] <span class="tag">&lt;<span class="name">+15</span>&gt;</span>: movq   0x8(%rdi), %rdi</div><div class="line">bomb[0x401217] <span class="tag">&lt;<span class="name">+19</span>&gt;</span>: callq  0x401204                  ; <span class="tag">&lt;<span class="name">+0</span>&gt;</span></div><div class="line">bomb[0x40121c] <span class="tag">&lt;<span class="name">+24</span>&gt;</span>: addl   %eax, %eax</div><div class="line">bomb[0x40121e] <span class="tag">&lt;<span class="name">+26</span>&gt;</span>: jmp    0x40123d                  ; <span class="tag">&lt;<span class="name">+57</span>&gt;</span></div><div class="line">bomb[0x401220] <span class="tag">&lt;<span class="name">+28</span>&gt;</span>: movl   $0x0, %eax</div><div class="line">bomb[0x401225] <span class="tag">&lt;<span class="name">+33</span>&gt;</span>: cmpl   %esi, %edx</div><div class="line">bomb[0x401227] <span class="tag">&lt;<span class="name">+35</span>&gt;</span>: je     0x40123d                  ; <span class="tag">&lt;<span class="name">+57</span>&gt;</span></div><div class="line">bomb[0x401229] <span class="tag">&lt;<span class="name">+37</span>&gt;</span>: movq   0x10(%rdi), %rdi</div><div class="line">bomb[0x40122d] <span class="tag">&lt;<span class="name">+41</span>&gt;</span>: callq  0x401204                  ; <span class="tag">&lt;<span class="name">+0</span>&gt;</span></div><div class="line">bomb[0x401232] <span class="tag">&lt;<span class="name">+46</span>&gt;</span>: leal   0x1(%rax,%rax), %eax</div><div class="line">bomb[0x401236] <span class="tag">&lt;<span class="name">+50</span>&gt;</span>: jmp    0x40123d                  ; <span class="tag">&lt;<span class="name">+57</span>&gt;</span></div><div class="line">bomb[0x401238] <span class="tag">&lt;<span class="name">+52</span>&gt;</span>: movl   $0xffffffff, %eax</div><div class="line">bomb[0x40123d] <span class="tag">&lt;<span class="name">+57</span>&gt;</span>: addq   $0x8, %rsp</div><div class="line">bomb[0x401241] <span class="tag">&lt;<span class="name">+61</span>&gt;</span>: retq</div></pre></td></tr></table></figure>
<p>可以根据上面的代码，写出C语言的递归函数:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//这里假设%rdi为x, %esi为y</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">fun7</span><span class="params">(<span class="keyword">int</span> *x, <span class="keyword">int</span> y)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span> (x == <span class="literal">NULL</span>)</div><div class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">	<span class="keyword">if</span> (*x - y &lt; <span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		ret = fun7(*(x + <span class="number">0x10</span>), y);</div><div class="line">		ret = ret * <span class="number">2</span> + <span class="number">1</span>;</div><div class="line">	&#125;	</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (*x == y)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		ret = fun7(*(x + <span class="number">0x8</span>), b);</div><div class="line">		ret *= <span class="number">2</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>那么，为了让fun7返回得到2，需要执行三次递归。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">2 = 2 * 1</div><div class="line">1 = 2 * 0 + 1</div><div class="line">0 = 0</div></pre></td></tr></table></figure>
<p>所以可以得知%rdi也就是0x6030f0这个地址进行了2次增加。递归最深处得到(%rdi)和%rsi相等。用0x6030f0增加(0x8+0x10),得到<code>0x16</code>,转化为十进制就是答案<code>22</code>.</p>
<p><img src="suc.png" alt=""></p>
<h1 id="u6700_u540E"><a href="#u6700_u540E" class="headerlink" title="最后"></a>最后</h1><p>通过不到两天的思考，虽然不是很容易，经过各种查资料和思考，最终完成了这个lab。第三章节的结束，也是第四章的开始，路漫漫其修远兮，吾将上下而求索。</p>

	
	
	
	
</div>
				
				

                <!-- Post Comments -->
                


    <!-- 使用 DISQUS -->
	<div id="disqus-comment">
		<div id="disqus_thread"></div>
<script>
	var disqus_config = function () {
		this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
		this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
	};

	(function() { // DON'T EDIT BELOW THIS LINE
		var d = document, s = d.createElement('script');
		s.src = '//xinqiu.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
	})();
</script>
	</div>
	<style>
		#disqus-comment{
			background-color:#eee;
			padding:2pc;
		}
	</style>

            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    
    <!-- Prev Nav -->
    
        <a href="/2016/03/12/csi-start/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            Newer
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2016/01/01/Dairy-5/" id="post_nav-older" class="next-content">
            Older
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>
        </div>
    </div>

				
				
					<!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay "></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored  sidebar-fixed-left" role="navigation">
	<div id="sidebar-main">
	    <!-- Sidebar Header -->
		<div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
    <i class="material-icons">clear_all</i>
    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Xin Qiu's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        xinqiu.94@gmial.com
        <b class="caret"></b>
    </a>
</div>

		<!-- Sidebar Navigation  -->
		<ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
			
                <li>
                    <a href="mailto:xinqiu.94@mail.com" target="_blank" title="Email Me">
						<i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    <li id="sidebar-first-li">
        <a href="/" target="_self">
            <i class="material-icons sidebar-material-icons">home</i>
             Home
        </a>
    </li>

    <!-- I'm Feeling Lucky -->
<!--
    <li class="dropdown">
        <a href="" target="_self">
            <i class="material-icons sidebar-material-icons">explore</i>
             sidebar.imlucky
        </a>
    </li>
-->

	
    <!-- Archives  -->
    <li class="dropdown">
        <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
            <i class="material-icons sidebar-material-icons">inbox</i>
             Archives
            <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
            <li>
            <a class="sidebar_archives-link" href="/archives/2016/10/">October 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">August 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">July 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">June 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">May 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">April 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">March 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/02/">February 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">January 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/12/">December 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/11/">November 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/10/">October 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/09/">September 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/08/">August 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/07/">July 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">June 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/05/">May 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/03/">March 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/02/">February 2015<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/01/">January 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/12/">December 2014<span class="sidebar_archives-count">1</span></a>
        </ul>
    </li>

    <!-- Divider -->
    <li class="divider"></li>


    <!-- Pages  -->
	
		<li>
			<a href="/projects" title="Projects">
				Projects
			</a>
		</li>
	
		<li>
			<a href="/reading-list" title="Reading">
				Reading
			</a>
		</li>
	
		<li>
			<a href="/timeline" title="Timeline">
				Timeline
			</a>
		</li>
	

    <!-- Article Numebr  -->
    <li>
        <a href="#">
             Article Number
             <span class="sidebar-badge">38</span>
        </a>
    </li>
</ul>

		<!-- Sidebar Divider -->
		<div class="sidebar-divider"></div>

		<!-- Sidebar Footer -->
		<!-- 
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持。 :) 
-->

<!-- Theme Material -->
<a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
	<div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		Theme - Material
		<span class="sidebar-badge badge-circle">i</span>
	</div>
</a>

<!-- Help & Support -->
<!--
<a href="mailto:hiviosey@gmail.com" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		sidebar.help
		<span class="mdl-button__ripple-container">
			<span class="mdl-ripple"></span>
		</span>
	</div>
</a>
-->

<!-- Feedback -->
<!--
<a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.feedback
                    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>
-->

<!-- Abount Theme -->
<!--
<a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.about_theme
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>-->

	</div>
    
    <!-- Sidebar Sponsor -->
    


</aside>

				
				
				
					<!-- Footer Top Button -->
					<div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>
				
				
				<!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
	
	
		<!-- Paradox Footer Left Section -->
		<div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
    <a href="https://twitter.com/twitter" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.png);">
        <span class="visuallyhidden">Twitter</span>
    </button></a>
    
    
    <!-- Facebook -->
    
    <a href="https://www.facebook.com/facebook" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.png);">
        <span class="visuallyhidden">Facebook</span>
    </button></a>
    
    
    <!-- Google + -->
    
    <a href="https://www.google.com/" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-gplus.png);">
        <span class="visuallyhidden">Google Plus</span>
    </button></a>
    
    
    <!-- Weibo -->
    
    
    
    <!-- Instagram -->
    
    
    
    <!-- Tumblr -->
    
    
    
    <!-- Github -->
    
    <a href="https://github.com/xinqiu" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
        <span class="visuallyhidden">Github</span>
    </button></a>
    
</div>


		<!--Copyright-->
		<div id="copyright">Copyright&nbsp;©&nbsp;<script type="text/javascript">var fd = new Date();document.write(fd.getFullYear());</script>&nbsp;一人Code</div>

		<!-- Paradox Footer Right Section -->

		<!-- 
		I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright.
		It will not impact the appearance and can give developers a lot of support :)

		很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
		它不会影响美观并可以给开发者很大的支持。 :) 
		-->

		<div class="mdl-mini-footer--right-section">
			<div>
				<div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
				<div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
			</div>
		</div>
	
    
</footer>
                
				<!-- Import File -->
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    
    $('#nprogress .bar').css({
        'background': '#FF4081'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #FF4081, 0 0 15px #FF4081'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#FF4081',
        'border-left-color': '#FF4081'
    });
    
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>




    <!-- Leancloud -->
	<script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
	<script>
		AV.initialize("wNFmCWTd6GAdUBwK4C35gD2G-gzGzoHsz", "fkjBgbCuEaEEKpksFNIkGYsk");
	</script>
    <script>
	function showTime(Counter) {
		var query = new AV.Query(Counter);
		$(".leancloud-views_num").each(function() {
			var url = $(this).attr("id").trim();
			query.equalTo("url", url);
			query.find({
				success: function(results) {
					if (results.length == 0) {
						var content = '0 ' + $(document.getElementById(url)).text();
						$(document.getElementById(url)).text(content);
						return;
					}
					for (var i = 0; i < results.length; i++) {
						var object = results[i];
						var content = object.get('time') + ' ' + $(document.getElementById(url)).text();
						$(document.getElementById(url)).text(content);
					}
				},
				error: function(object, error) {
					console.log("Error: " + error.code + " " + error.message);
				}
			});

		});
	}

	function addCount(Counter) {
		var Counter = AV.Object.extend("Counter");
		url = $(".leancloud-views_num").attr('id').trim();
		title = $(".leancloud-views_num").attr('data-flag-title').trim();
		var query = new AV.Query(Counter);
		query.equalTo("url", url);
		query.find({
			success: function(results) {
				if (results.length > 0) {
					var counter = results[0];
					counter.fetchWhenSave(true);
					counter.increment("time");
					counter.save(null, {
						success: function(counter) {
							var content =  counter.get('time') + ' ' + $(document.getElementById(url)).text();
							$(document.getElementById(url)).text(content);
						},
						error: function(counter, error) {
							console.log('Failed to save Visitor num, with error message: ' + error.message);
						}
					});
				} else {
					var newcounter = new Counter();
					newcounter.set("title", title);
					newcounter.set("url", url);
					newcounter.set("time", 1);
					newcounter.save(null, {
						success: function(newcounter) {
							console.log("newcounter.get('time')="+newcounter.get('time'));
							var content = newcounter.get('time') + ' ' + $(document.getElementById(url)).text();
							$(document.getElementById(url)).text(content);
						},
						error: function(newcounter, error) {
							console.log('Failed to create');
						}
					});
				}
			},
			error: function(error) {
				console.log('Error:' + error.code + " " + error.message);
			}
		});
	}
	$(function() {
		var Counter = AV.Object.extend("Counter");
		if ($('.leancloud-views_num').length == 1) {
			addCount(Counter);
		} else if ($('.post-title-link').length > 1) {
			showTime(Counter);
		}
	}); 
</script>







    <!-- 使用 DISQUS js 代码 -->
	<script id="dsq-count-scr" src="//xinqiu.disqus.com/count.js" async></script>


<!-- Swiftye -->


<!-- Local Search-->

	<script>
	var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        success: function( xmlResponse ) {
            // get the contents from search data
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length <= 0) {
                    return;
                }
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        str += "<li><a href='"+ data_url +"' class='search-result-title' target='_blank'>"+ data_title;
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out characters
                            var start = first_occur - 6;
                            var end = first_occur + 6;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 10;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substr(start, end); 
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<em class=\"search-keyword\">"+keyword+"</em>");
                            })
                            str += "<p class=\"search-result\">" + match_content +"...</p>" +"</a>";
                        }
                    }
                })
                $resultContent.innerHTML = str;
            })
        }
    })
}
</script>

	<script>
		var search_path = "search.xml";
		if (search_path.length == 0) {
		search_path = "search.xml";
		}
		var path = "/" + search_path;
		searchFunc(path, 'search', 'local-search-result');
        
        
	</script>


<!-- Window Load-->
<script>
    // Post_Toc parent position fixed
    $(window).load(function() {
        $(".post-toc-wrap").parent(".mdl-menu__container").css("position", "fixed");
    });
</script>
            </main>
        </div>
		
    </body>
		
	
</html>
